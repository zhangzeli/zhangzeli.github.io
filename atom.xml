<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>泽泽Plus+搬砖师傅</title>
  
  
  <link href="http://www.zeze.info/atom.xml" rel="self"/>
  
  <link href="http://www.zeze.info/"/>
  <updated>2021-08-10T01:23:42.994Z</updated>
  <id>http://www.zeze.info/</id>
  
  <author>
    <name>泽泽853089986@qq.com</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Yarn</title>
    <link href="http://www.zeze.info/bigdata/hadoop/yarn_1/"/>
    <id>http://www.zeze.info/bigdata/hadoop/yarn_1/</id>
    <published>2021-08-09T23:36:58.000Z</published>
    <updated>2021-08-10T01:23:42.994Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="修改yarn-配置"><a href="#修改yarn-配置" class="headerlink" title="修改yarn 配置"></a>修改yarn 配置</h1><p>yarn-site.xml</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>&#123;hostname&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>mapred-site.xml</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/opt/bigdata/hadoop-3.3.1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/opt/bigdata/hadoop-3.3.1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/opt/bigdata/hadoop-3.3.1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">官网学习hadoop,yarn 笔记</summary>
    
    
    
    <category term="-[大数据, hadoop,yarn]" scheme="http://www.zeze.info/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-hadoop-yarn/"/>
    
    
    <category term="大数据" scheme="http://www.zeze.info/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
  </entry>
  
  <entry>
    <title>Post</title>
    <link href="http://www.zeze.info/bigdata/hadoop/hadoop_2/"/>
    <id>http://www.zeze.info/bigdata/hadoop/hadoop_2/</id>
    <published>2021-08-08T21:53:32.000Z</published>
    <updated>2021-08-10T01:23:42.994Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="简单的word-count"><a href="#简单的word-count" class="headerlink" title="简单的word count"></a>简单的word count</h1><p>maven 依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-client --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>map</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountMap</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>,<span class="title">LongWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LongWritable ONE =<span class="keyword">new</span> LongWritable(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Text WORD = <span class="keyword">new</span> Text();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Mapper&lt;Object, Text, Text, LongWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        StringTokenizer st = <span class="keyword">new</span> StringTokenizer(value.toString());</span><br><span class="line">        <span class="keyword">while</span> (st.hasMoreTokens())&#123;</span><br><span class="line">            WORD.set(st.nextToken());</span><br><span class="line">            context.write(WORD,ONE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>reduce </p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountReduce</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">LongWritable</span>, <span class="title">Text</span>,<span class="title">LongWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LongWritable RESULT = <span class="keyword">new</span> LongWritable();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text word, Iterable&lt;LongWritable&gt; values, Reducer&lt;Text, LongWritable, Text, LongWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum =<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (LongWritable value : values) &#123;</span><br><span class="line">            sum +=value.get();</span><br><span class="line">        &#125;</span><br><span class="line">        RESULT.set(sum);</span><br><span class="line">        context.write(word,RESULT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>client</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        Job job = Job.getInstance(conf, <span class="string">"word count"</span>);</span><br><span class="line">        job.setJarByClass(Client<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapperClass(WordCountMap<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setCombinerClass(WordCountReduce<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass(WordCountReduce<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputKeyClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(LongWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(args[<span class="number">0</span>]));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(args[<span class="number">1</span>]));</span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="简单的word-count排序"><a href="#简单的word-count排序" class="headerlink" title="简单的word count排序"></a>简单的word count排序</h1><p>将上一步的输出作为这次的输入</p><p>SortMap</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortMap</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>,<span class="title">LongWritable</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LongWritable KEY =<span class="keyword">new</span> LongWritable(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Text VALUE = <span class="keyword">new</span> Text();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Mapper&lt;Object, Text, LongWritable, Text&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        String s = value.toString();</span><br><span class="line">        String[] s1 = s.split(<span class="string">"\t"</span>);</span><br><span class="line">        KEY.set(Integer.valueOf(s1[<span class="number">1</span>]));</span><br><span class="line">        VALUE.set(s1[<span class="number">0</span>]);</span><br><span class="line">        context.write(KEY,VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SortReduce</p><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">LongWritable</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">Text</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.<span class="type">Reducer</span>;</span><br><span class="line"><span class="keyword">import</span> java.io.<span class="type">IOException</span>;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">SortReduce</span> <span class="keyword">extends</span> <span class="title">Reducer&lt;LongWritable</span>, <span class="title">Text</span>,<span class="title">LongWritable</span>, <span class="title">Text&gt;</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void reduce(<span class="type">LongWritable</span> key, <span class="type">Iterable</span>&lt;<span class="type">Text</span>&gt; values, <span class="type">Reducer</span>&lt;<span class="type">LongWritable</span>, <span class="type">Text</span>, <span class="type">LongWritable</span>, <span class="type">Text</span>&gt;.<span class="type">Context</span> context) <span class="keyword">throws</span> <span class="type">IOException</span>, <span class="type">InterruptedException</span> &#123;</span><br><span class="line">        context.write(key,values.iterator().next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SortClient</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> E`xception </span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        Job job = Job.getInstance(conf, <span class="string">" sort word count"</span>);</span><br><span class="line">        job.setJarByClass(SortClient<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setMapperClass(SortMap<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setCombinerClass(SortReduce<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setReducerClass(SortReduce<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputKeyClass(LongWritable<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        job.setOutputValueClass(Text<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(args[<span class="number">0</span>]));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(args[<span class="number">1</span>]));</span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">官网学习hadoop</summary>
    
    
    
    <category term="-[大数据, hadoop]" scheme="http://www.zeze.info/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-hadoop/"/>
    
    
    <category term="大数据" scheme="http://www.zeze.info/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
  </entry>
  
  <entry>
    <title>Hadoop</title>
    <link href="http://www.zeze.info/bigdata/hadoop/hadoop_1/"/>
    <id>http://www.zeze.info/bigdata/hadoop/hadoop_1/</id>
    <published>2021-08-08T14:53:10.000Z</published>
    <updated>2021-08-10T01:23:42.994Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p><a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html" target="_blank" rel="external nofollow noopener noreferrer">apache hadoop </a></p><p>Setup passphraseless ssh</p><figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh-keygen -t rsa -P <span class="string">''</span> -f ~<span class="regexp">/.ssh/id</span>_rsa</span><br><span class="line"><span class="variable">$ </span>cat ~<span class="regexp">/.ssh/id</span>_rsa.pub &gt;&gt; ~<span class="regexp">/.ssh/authorized</span>_keys</span><br><span class="line"><span class="variable">$ </span>chmod 0600 ~<span class="regexp">/.ssh/authorized</span>_keys</span><br></pre></td></tr></table></figure><h2 id="stand-alone"><a href="#stand-alone" class="headerlink" title="stand-alone"></a>stand-alone</h2><p>不用启动hadoop 进程 可以直接运行</p><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> <span class="built_in">input</span></span><br><span class="line">$ <span class="keyword">cp</span> etc/hadoop/*.xml <span class="built_in">input</span></span><br><span class="line">$ bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-<span class="number">3.3</span>.<span class="number">1</span>.jar <span class="keyword">grep</span> <span class="built_in">input</span> output <span class="string">'dfs[a-z.]+'</span></span><br><span class="line">$ <span class="keyword">cat</span> output/*</span><br></pre></td></tr></table></figure><h2 id="Pseudo-Distributed-Operation"><a href="#Pseudo-Distributed-Operation" class="headerlink" title="Pseudo-Distributed Operation"></a>Pseudo-Distributed Operation</h2><p>伪集群部署</p><p>etc/hadoop/core-site.xml:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>etc/hadoop/hdfs-site.xml:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim hadoop-env.sh</span><br><span class="line"><span class="built_in">export</span> HDFS_NAMENODE_USER=root</span><br><span class="line"><span class="built_in">export</span> HDFS_DATANODE_USER=root</span><br><span class="line"><span class="built_in">export</span> HDFS_SECONDARYNAMENODE_USER=root</span><br><span class="line"><span class="built_in">export</span> YARN_RESOURCEMANAGER_USER=root</span><br><span class="line"><span class="built_in">export</span> YARN_NODEMANAGER_USER=root</span><br></pre></td></tr></table></figure><p>Format the filesystem:</p><figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">bin/hdfs </span>namenode -format</span><br></pre></td></tr></table></figure><p>Start NameNode daemon and DataNode daemon:</p><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">sbin/<span class="literal">start</span>-dfs.sh</span><br></pre></td></tr></table></figure><p><a href="./hadoop_2">下一章word count 程序</a></p><p><a href="https://activity.huaweicloud.com/828_promotion/index.html?fromacct=32419f0e-871e-4fe8-b461-cff4dfe872a0&utm_source=enpsMTUzMTE0ODQzNTc==&utm_medium=cps&utm_campaign=201905" target="_blank" rel="external nofollow noopener noreferrer">828企业上云节，多款产品限时特价</a></p><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">官网学习hadoop</summary>
    
    
    
    <category term="-[大数据, hadoop]" scheme="http://www.zeze.info/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE-hadoop/"/>
    
    
    <category term="大数据" scheme="http://www.zeze.info/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
  </entry>
  
  <entry>
    <title>Java并发编程：CountDownLatch、CyclicBarrier和Semaphore</title>
    <link href="http://www.zeze.info/java/concurrent/concurrent/"/>
    <id>http://www.zeze.info/java/concurrent/concurrent/</id>
    <published>2021-01-13T11:43:23.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Java并发编程：CountDownLatch、CyclicBarrier和Semaphor-转载"><a href="#Java并发编程：CountDownLatch、CyclicBarrier和Semaphor-转载" class="headerlink" title="Java并发编程：CountDownLatch、CyclicBarrier和Semaphor(转载)"></a>Java并发编程：CountDownLatch、CyclicBarrier和Semaphor(转载)</h1><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">一<span class="selector-class">.CountDownLatch</span>用法</span><br><span class="line">二<span class="selector-class">.CyclicBarrier</span>用法</span><br><span class="line">三<span class="selector-class">.Semaphore</span>用法</span><br></pre></td></tr></table></figure><p><a href="http://www.cnblogs.com/dolphin0520/p/3920397.html" target="_blank" rel="external nofollow noopener noreferrer">原文链接</a></p><h1 id="一-CountDownLatch用法"><a href="#一-CountDownLatch用法" class="headerlink" title="一.CountDownLatch用法"></a>一.CountDownLatch用法</h1><blockquote><p>CountDownLatch类位于java.util.concurrent包下，利用它可以实现类似计数器的功能。比如有一个任务A，它要等待其他4个任务执行完毕之后才能执行，此时就可以利用CountDownLatch来实现这种功能了。CountDownLatch类只提供了一个构造器</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CountDownLatch</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;  &#125;;  <span class="comment">//参数count为计数值</span></span><br></pre></td></tr></table></figure><blockquote><p>然后下面这3个方法是CountDownLatch类中最重要的方法：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//调用await()方法的线程会被挂起，它会等待直到count值为0才继续执行</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123; &#125;;  </span><br><span class="line"><span class="comment">//和await()类似，只不过等待一定的时间后count值还没变为0的话就会继续执行</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">await</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; &#125;;  </span><br><span class="line"> <span class="comment">//将count值减1</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countDown</span><span class="params">()</span> </span>&#123; &#125;;</span><br></pre></td></tr></table></figure><blockquote><p>下面看一个例子大家就清楚CountDownLatch的用法了：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;   </span><br><span class="line">         <span class="keyword">final</span> CountDownLatch latch = <span class="keyword">new</span> CountDownLatch(<span class="number">2</span>);</span><br><span class="line">          </span><br><span class="line">         <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                 <span class="keyword">try</span> &#123;</span><br><span class="line">                     System.out.println(<span class="string">"子线程"</span>+Thread.currentThread().getName()+<span class="string">"正在执行"</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                    System.out.println(<span class="string">"子线程"</span>+Thread.currentThread().getName()+<span class="string">"执行完毕"</span>);</span><br><span class="line">                    latch.countDown();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">             &#125;;</span><br><span class="line">         &#125;.start();</span><br><span class="line">          </span><br><span class="line">         <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                 <span class="keyword">try</span> &#123;</span><br><span class="line">                     System.out.println(<span class="string">"子线程"</span>+Thread.currentThread().getName()+<span class="string">"正在执行"</span>);</span><br><span class="line">                     Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                     System.out.println(<span class="string">"子线程"</span>+Thread.currentThread().getName()+<span class="string">"执行完毕"</span>);</span><br><span class="line">                     latch.countDown();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">             &#125;;</span><br><span class="line">         &#125;.start();</span><br><span class="line">          </span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             System.out.println(<span class="string">"等待2个子线程执行完毕..."</span>);</span><br><span class="line">            latch.await();</span><br><span class="line">            System.out.println(<span class="string">"2个子线程已经执行完毕"</span>);</span><br><span class="line">            System.out.println(<span class="string">"继续执行主线程"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">线程Thread-0正在执行</span><br><span class="line">线程Thread-1正在执行</span><br><span class="line">等待2个子线程执行完毕...</span><br><span class="line">线程Thread-0执行完毕</span><br><span class="line">线程Thread-1执行完毕</span><br><span class="line">2个子线程已经执行完毕</span><br><span class="line">继续执行主线程</span><br></pre></td></tr></table></figure><h1 id="二-CyclicBarrier用"><a href="#二-CyclicBarrier用" class="headerlink" title="二.CyclicBarrier用"></a>二.CyclicBarrier用</h1><blockquote><p>字面意思回环栅栏，通过它可以实现让一组线程等待至某个状态之后再全部同时执行。叫做回环是因为当所有等待线程都被释放以后，CyclicBarrier可以被重用。我们暂且把这个状态就叫做barrier，当调用await()方法之后，线程就处于barrier了。CyclicBarrier类位于java.util.concurrent包下，CyclicBarrier提供2个构造器：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CyclicBarrier</span><span class="params">(<span class="keyword">int</span> parties, Runnable barrierAction)</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CyclicBarrier</span><span class="params">(<span class="keyword">int</span> parties)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>参数parties指让多少个线程或者任务等待至barrier状态；参数barrierAction为当这些线程都达到barrier状态时会执行的内容。<br>然后CyclicBarrier中最重要的方法就是await方法，它有2个重载版本：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, BrokenBarrierException </span>&#123; &#125;;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">await</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span><span class="keyword">throws</span> InterruptedException,BrokenBarrierException,TimeoutException </span>&#123; &#125;;</span><br></pre></td></tr></table></figure><p>第一个版本比较常用，用来挂起当前线程，直至所有线程都到达barrier状态再同时执行后续任务；<br>第二个版本是让这些线程等待至一定的时间，如果还有线程没有到达barrier状态就直接让到达barrier的线程执行后续任务。<br>下面举几个例子就明白了：<br>假若有若干个线程都要进行写数据操作，并且只有所有线程都完成写数据操作之后，这些线程才能继续做后面的事情，此时就可以利用CyclicBarrier了：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = <span class="number">4</span>;</span><br><span class="line">        CyclicBarrier barrier  = <span class="keyword">new</span> CyclicBarrier(N);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">            <span class="keyword">new</span> Writer(barrier).start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Writer</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> CyclicBarrier cyclicBarrier;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Writer</span><span class="params">(CyclicBarrier cyclicBarrier)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.cyclicBarrier = cyclicBarrier;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"线程"</span>+Thread.currentThread().getName()+<span class="string">"正在写入数据..."</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);      <span class="comment">//以睡眠来模拟写入数据操作</span></span><br><span class="line">                System.out.println(<span class="string">"线程"</span>+Thread.currentThread().getName()+<span class="string">"写入数据完毕，等待其他线程写入完毕"</span>);</span><br><span class="line">                cyclicBarrier.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">catch</span>(BrokenBarrierException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"所有线程写入完毕，继续处理其他任务..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">线程Thread-0正在写入数据...</span><br><span class="line">线程Thread-3正在写入数据...</span><br><span class="line">线程Thread-2正在写入数据...</span><br><span class="line">线程Thread-1正在写入数据...</span><br><span class="line">线程Thread-2写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-0写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-3写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-1写入数据完毕，等待其他线程写入完毕</span><br><span class="line">所有线程写入完毕，继续处理其他任务...</span><br><span class="line">所有线程写入完毕，继续处理其他任务...</span><br><span class="line">所有线程写入完毕，继续处理其他任务...</span><br><span class="line">所有线程写入完毕，继续处理其他任务...</span><br></pre></td></tr></table></figure><p>从上面输出结果可以看出，每个写入线程执行完写数据操作之后，就在等待其他线程写入操作完毕。<br>当所有线程线程写入操作完毕之后，所有线程就继续进行后续的操作了。<br>如果说想在所有线程写入操作完之后，进行额外的其他操作可以为CyclicBarrier提供Runnable参数：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = <span class="number">4</span>;</span><br><span class="line">        CyclicBarrier barrier  = <span class="keyword">new</span> CyclicBarrier(N,<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"当前线程"</span>+Thread.currentThread().getName());   </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">            <span class="keyword">new</span> Writer(barrier).start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Writer</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> CyclicBarrier cyclicBarrier;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Writer</span><span class="params">(CyclicBarrier cyclicBarrier)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.cyclicBarrier = cyclicBarrier;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"线程"</span>+Thread.currentThread().getName()+<span class="string">"正在写入数据..."</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);      <span class="comment">//以睡眠来模拟写入数据操作</span></span><br><span class="line">                System.out.println(<span class="string">"线程"</span>+Thread.currentThread().getName()+<span class="string">"写入数据完毕，等待其他线程写入完毕"</span>);</span><br><span class="line">                cyclicBarrier.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">catch</span>(BrokenBarrierException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"所有线程写入完毕，继续处理其他任务..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">线程Thread-0正在写入数据...</span><br><span class="line">线程Thread-1正在写入数据...</span><br><span class="line">线程Thread-2正在写入数据...</span><br><span class="line">线程Thread-3正在写入数据...</span><br><span class="line">线程Thread-0写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-1写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-2写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-3写入数据完毕，等待其他线程写入完毕</span><br><span class="line">当前线程Thread-3</span><br><span class="line">所有线程写入完毕，继续处理其他任务...</span><br><span class="line">所有线程写入完毕，继续处理其他任务...</span><br><span class="line">所有线程写入完毕，继续处理其他任务...</span><br><span class="line">所有线程写入完毕，继续处理其他任务...</span><br></pre></td></tr></table></figure><p>从结果可以看出，当四个线程都到达barrier状态后，会从四个线程中选择一个线程去执行Runnable。<br>下面看一下为await指定时间的效果：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = <span class="number">4</span>;</span><br><span class="line">        CyclicBarrier barrier  = <span class="keyword">new</span> CyclicBarrier(N);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;N-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">new</span> Writer(barrier).start();</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">new</span> Writer(barrier).start();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Writer</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> CyclicBarrier cyclicBarrier;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Writer</span><span class="params">(CyclicBarrier cyclicBarrier)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.cyclicBarrier = cyclicBarrier;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"线程"</span>+Thread.currentThread().getName()+<span class="string">"正在写入数据..."</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);      <span class="comment">//以睡眠来模拟写入数据操作</span></span><br><span class="line">                System.out.println(<span class="string">"线程"</span>+Thread.currentThread().getName()+<span class="string">"写入数据完毕，等待其他线程写入完毕"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cyclicBarrier.await(<span class="number">2000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (TimeoutException e) &#123;</span><br><span class="line">                    <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">catch</span>(BrokenBarrierException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">"所有线程写入完毕，继续处理其他任务..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">线程Thread-0正在写入数据...</span><br><span class="line">线程Thread-2正在写入数据...</span><br><span class="line">线程Thread-1正在写入数据...</span><br><span class="line">线程Thread-2写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-0写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-1写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-3正在写入数据...</span><br><span class="line">java.util.concurrent.TimeoutException</span><br><span class="line">Thread-1所有线程写入完毕，继续处理其他任务...</span><br><span class="line">Thread-0所有线程写入完毕，继续处理其他任务...</span><br><span class="line">    at java.util.concurrent.CyclicBarrier.dowait(Unknown Source)</span><br><span class="line">    at java.util.concurrent.CyclicBarrier.await(Unknown Source)</span><br><span class="line">    at com.cxh.test1.Test$Writer.run(Test.java:58)</span><br><span class="line">java.util.concurrent.BrokenBarrierException</span><br><span class="line">    at java.util.concurrent.CyclicBarrier.dowait(Unknown Source)</span><br><span class="line">    at java.util.concurrent.CyclicBarrier.await(Unknown Source)</span><br><span class="line">    at com.cxh.test1.Test$Writer.run(Test.java:58)</span><br><span class="line">java.util.concurrent.BrokenBarrierException</span><br><span class="line">    at java.util.concurrent.CyclicBarrier.dowait(Unknown Source)</span><br><span class="line">    at java.util.concurrent.CyclicBarrier.await(Unknown Source)</span><br><span class="line">    at com.cxh.test1.Test$Writer.run(Test.java:58)</span><br><span class="line">Thread-2所有线程写入完毕，继续处理其他任务...</span><br><span class="line">java.util.concurrent.BrokenBarrierException</span><br><span class="line">线程Thread-3写入数据完毕，等待其他线程写入完毕</span><br><span class="line">    at java.util.concurrent.CyclicBarrier.dowait(Unknown Source)</span><br><span class="line">    at java.util.concurrent.CyclicBarrier.await(Unknown Source)</span><br><span class="line">    at com.cxh.test1.Test$Writer.run(Test.java:58)</span><br><span class="line">Thread-3所有线程写入完毕，继续处理其他任务...</span><br></pre></td></tr></table></figure><p>上面的代码在main方法的for循环中，故意让最后一个线程启动延迟，因为在前面三个线程都达到barrier之后，等待了指定的时间发现第四个线程还没有达到barrier，就抛出异常并继续执行后面的任务。<br>另外CyclicBarrier是可以重用的，看下面这个例子：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = <span class="number">4</span>;</span><br><span class="line">        CyclicBarrier barrier  = <span class="keyword">new</span> CyclicBarrier(N);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Writer(barrier).start();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">25000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        System.out.println(<span class="string">"CyclicBarrier重用"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Writer(barrier).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Writer</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> CyclicBarrier cyclicBarrier;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Writer</span><span class="params">(CyclicBarrier cyclicBarrier)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.cyclicBarrier = cyclicBarrier;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"线程"</span>+Thread.currentThread().getName()+<span class="string">"正在写入数据..."</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);      <span class="comment">//以睡眠来模拟写入数据操作</span></span><br><span class="line">                System.out.println(<span class="string">"线程"</span>+Thread.currentThread().getName()+<span class="string">"写入数据完毕，等待其他线程写入完毕"</span>);</span><br><span class="line">             </span><br><span class="line">                cyclicBarrier.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">catch</span>(BrokenBarrierException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">"所有线程写入完毕，继续处理其他任务..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">线程Thread-0正在写入数据...</span><br><span class="line">线程Thread-1正在写入数据...</span><br><span class="line">线程Thread-3正在写入数据...</span><br><span class="line">线程Thread-2正在写入数据...</span><br><span class="line">线程Thread-1写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-3写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-2写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-0写入数据完毕，等待其他线程写入完毕</span><br><span class="line">Thread-0所有线程写入完毕，继续处理其他任务...</span><br><span class="line">Thread-3所有线程写入完毕，继续处理其他任务...</span><br><span class="line">Thread-1所有线程写入完毕，继续处理其他任务...</span><br><span class="line">Thread-2所有线程写入完毕，继续处理其他任务...</span><br><span class="line">CyclicBarrier重用</span><br><span class="line">线程Thread-4正在写入数据...</span><br><span class="line">线程Thread-5正在写入数据...</span><br><span class="line">线程Thread-6正在写入数据...</span><br><span class="line">线程Thread-7正在写入数据...</span><br><span class="line">线程Thread-7写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-5写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-6写入数据完毕，等待其他线程写入完毕</span><br><span class="line">线程Thread-4写入数据完毕，等待其他线程写入完毕</span><br><span class="line">Thread-4所有线程写入完毕，继续处理其他任务...</span><br><span class="line">Thread-5所有线程写入完毕，继续处理其他任务...</span><br><span class="line">Thread-6所有线程写入完毕，继续处理其他任务...</span><br><span class="line">Thread-7所有线程写入完毕，继续处理其他任务...</span><br></pre></td></tr></table></figure><p>从执行结果可以看出，在初次的4个线程越过barrier状态后，又可以用来进行新一轮的使用。而CountDownLatch无法进行重复使用。</p><h1 id="三-Semaphore用法"><a href="#三-Semaphore用法" class="headerlink" title="三.Semaphore用法"></a>三.Semaphore用法</h1><p>Semaphore翻译成字面意思为 信号量，Semaphore可以控同时访问的线程个数，通过 acquire() 获取一个许可，如果没有就等待，而 release() 释放一个许可。</p><p>Semaphore类位于java.util.concurrent包下，它提供了2个构造器：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123;          <span class="comment">//参数permits表示许可数目，即同时可以允许多少线程进行访问</span></span><br><span class="line">    sync = <span class="keyword">new</span> NonfairSync(permits);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits, <span class="keyword">boolean</span> fair)</span> </span>&#123;    <span class="comment">//这个多了一个参数fair表示是否是公平的，即等待时间越久的越先获取许可</span></span><br><span class="line">    sync = (fair)? <span class="keyword">new</span> FairSync(permits) : <span class="keyword">new</span> NonfairSync(permits);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面说一下Semaphore类中比较重要的几个方法，首先是acquire()、release()方法：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;  &#125;     <span class="comment">//获取一个许可</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> permits)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; &#125;    <span class="comment">//获取permits个许可</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>&#123; &#125;          <span class="comment">//释放一个许可</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123; &#125;    <span class="comment">//释放permits个许可</span></span><br></pre></td></tr></table></figure><p>acquire()用来获取一个许可，若无许可能够获得，则会一直等待，直到获得许可。<br>release()用来释放许可。注意，在释放许可之前，必须先获获得许可。<br>这4个方法都会被阻塞，如果想立即得到执行结果，可以使用下面几个方法</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">()</span> </span>&#123; &#125;;    <span class="comment">//尝试获取一个许可，若获取成功，则立即返回true，若获取失败，则立即返回false</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; &#125;;  <span class="comment">//尝试获取一个许可，若在指定的时间内获取成功，则立即返回true，否则则立即返回false</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123; &#125;; <span class="comment">//尝试获取permits个许可，若获取成功，则立即返回true，若获取失败，则立即返回false</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> permits, <span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123; &#125;; <span class="comment">//尝试获取permits个许可，若在指定的时间内获取成功，则立即返回true，否则则立即返回false</span></span><br></pre></td></tr></table></figure><p>另外还可以通过availablePermits()方法得到可用的许可数目。<br>下面通过一个例子来看一下Semaphore的具体使用：<br>假若一个工厂有5台机器，但是有8个工人，一台机器同时只能被一个工人使用，只有使用完了，其他工人才能继续使用。那么我们就可以通过Semaphore来实现:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = <span class="number">8</span>;            <span class="comment">//工人数</span></span><br><span class="line">        Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">5</span>); <span class="comment">//机器数目</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">            <span class="keyword">new</span> Worker(i,semaphore).start();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line">        <span class="keyword">private</span> Semaphore semaphore;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Worker</span><span class="params">(<span class="keyword">int</span> num,Semaphore semaphore)</span></span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.num = num;</span><br><span class="line">            <span class="keyword">this</span>.semaphore = semaphore;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                semaphore.acquire();</span><br><span class="line">                System.out.println(<span class="string">"工人"</span>+<span class="keyword">this</span>.num+<span class="string">"占用一个机器在生产..."</span>);</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                System.out.println(<span class="string">"工人"</span>+<span class="keyword">this</span>.num+<span class="string">"释放出机器"</span>);</span><br><span class="line">                semaphore.release();           </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">工人<span class="number">0</span>占用一个机器在生产...</span><br><span class="line">工人<span class="number">1</span>占用一个机器在生产...</span><br><span class="line">工人<span class="number">2</span>占用一个机器在生产...</span><br><span class="line">工人<span class="number">4</span>占用一个机器在生产...</span><br><span class="line">工人<span class="number">5</span>占用一个机器在生产...</span><br><span class="line">工人<span class="number">0</span>释放出机器</span><br><span class="line">工人<span class="number">2</span>释放出机器</span><br><span class="line">工人<span class="number">3</span>占用一个机器在生产...</span><br><span class="line">工人<span class="number">7</span>占用一个机器在生产...</span><br><span class="line">工人<span class="number">4</span>释放出机器</span><br><span class="line">工人<span class="number">5</span>释放出机器</span><br><span class="line">工人<span class="number">1</span>释放出机器</span><br><span class="line">工人<span class="number">6</span>占用一个机器在生产...</span><br><span class="line">工人<span class="number">3</span>释放出机器</span><br><span class="line">工人<span class="number">7</span>释放出机器</span><br><span class="line">工人<span class="number">6</span>释放出机器</span><br></pre></td></tr></table></figure><p>下面对上面说的三个辅助类进行一个总结：<br>　　1）CountDownLatch和CyclicBarrier都能够实现线程之间的等待，只不过它们侧重点不同：<br>　　　　CountDownLatch一般用于某个线程A等待若干个其他线程执行完任务之后，它才执行；<br>　　　　而CyclicBarrier一般用于一组线程互相等待至某个状态，然后这一组线程再同时执行；<br>　　　　另外，CountDownLatch是不能够重用的，而CyclicBarrier是可以重用的。<br>　　2）Semaphore其实和锁有点类似，它一般用于控制对某组资源的访问权限。</p><h1 id="例如这样场景：文件每一行是个url，记录有多少个返回结果是200成功，有多少是其他状态码。"><a href="#例如这样场景：文件每一行是个url，记录有多少个返回结果是200成功，有多少是其他状态码。" class="headerlink" title="例如这样场景：文件每一行是个url，记录有多少个返回结果是200成功，有多少是其他状态码。"></a>例如这样场景：文件每一行是个url，记录有多少个返回结果是200成功，有多少是其他状态码。</h1><ul><li>文件很大，还可能经常更换，不知道文件一共有多少行。</li><li>需要尽快完成任务，单线程就很拉胯，需要用多线程。<br>一个重点是线程池该如何定制参数，另一个重点则是如何知道所有任务结束了。</li></ul><h2 id="线程池参数设定"><a href="#线程池参数设定" class="headerlink" title="线程池参数设定"></a>线程池参数设定</h2><figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">用<span class="keyword">new</span><span class="type">CacheThreadPool</span>或者<span class="keyword">new</span><span class="type">FixedThreadPool</span>都是不合适的，前者会一直创建新线程直到创建int最大值个线程，之后再有线程就会抛异常然后程序就炸了。后者可以创建固定的线程数，但是如果超过这个数就会扔到队列LinkedBlockingQueue，这个队列也是最大只能int最大值个，仍有上面的问题。</span><br><span class="line"></span><br><span class="line">在当前场景下，我们可以对<span class="keyword">new</span><span class="type">CacheThreadPool</span>或者<span class="keyword">new</span><span class="type">FixedThreadPool</span>进行结合，模仿后者创建固定个数的线程，但是队列我们采用前者的空队列，这时候会在到达指定个数后reject，对于reject策略我们可以使用ThreadPoolExecutor.CallerRunsPolicy。这样在超出线程个数的时候，就会由创建线程的线程(我们这里就是主线程)来执行当前任务，因为<span class="string">"生产者"</span>去帮忙<span class="string">"消费"</span>了，所以生产任务就暂停了，这样起到一个负反馈的作用，使在工作的线程使用不超过<span class="number">101</span>个，如下。</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ThreadPoolExecutor threadPool =</span><br><span class="line"> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">100</span>,<span class="number">100</span>,<span class="number">0</span>, TimeUnit.SECONDS,<span class="keyword">new</span> SynchronousQueue&lt;&gt;(),<span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy())</span><br></pre></td></tr></table></figure><h2 id="如何知道所有任务结束"><a href="#如何知道所有任务结束" class="headerlink" title="如何知道所有任务结束"></a>如何知道所有任务结束</h2><p>即整个程序大概是这样：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 用于记录200状态码，和其他状态码的数量</span></span><br><span class="line">AtomicInteger okCount = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">AtomicInteger otherCount = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">String line = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>( (line = readLine(file)) !=<span class="keyword">null</span>)&#123;</span><br><span class="line">    String tmp = line;</span><br><span class="line"></span><br><span class="line">    threadPool.execute(()-&gt;&#123;</span><br><span class="line">        <span class="comment">// 对每一行进行处理</span></span><br><span class="line">        process(tmp,okCount,otherCount );</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"ok个数"</span>+okCount.get()+<span class="string">" 不ok的个数"</span>+otherCount);</span><br></pre></td></tr></table></figure><p>但打印结果这一行可能有问题，例如最后100个url的请求时间超级长，这100个线程创建完之后，就到了打印这一行了但是还没执行完，这样结果就是错的。常规思路下，计数器CountDownLatch是最佳选择，但是当前题目无法获知文件大小，而计数器必须一开始就指定计数的大小。这怎么解决呢？</p><p>当然思路是很多的，例如最简单的能想到的，就是在打印前判断线程池中活跃线程&gt;0，就sleep。</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(threadPool.get<span class="constructor">ActiveCount()</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样做不是特别的好，首先是这个getActiveCount拿到的个数是个大约的值，不保证准确，其次sleep的时长如何设定是恰当的有待商榷。我比较喜欢的做法是利用相位器Phaser。代码如下，有注释，但是可能也不太好理解，建议看下相位器那期视频。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AtomicInteger okCount = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">AtomicInteger otherCount = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">String line = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建数为1的相位器，不设置为0，是因为如果相位器总数从1减到0时，会导致阶段变为负数。1是个保护屏障。</span></span><br><span class="line">Phaser phaser = <span class="keyword">new</span> Phaser(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>( (line = readLine(file)) !=<span class="keyword">null</span>)&#123;</span><br><span class="line">    String tmp = line;</span><br><span class="line">    <span class="comment">// 每一行内容读出来时相位器总数+1</span></span><br><span class="line">    phaser.register();</span><br><span class="line">    threadPool.execute(()-&gt;&#123;</span><br><span class="line">        <span class="comment">// 对每一行进行处理</span></span><br><span class="line">        process(tmp,okCount,otherCount );</span><br><span class="line">        <span class="comment">// 处理完一行相位器总数-1</span></span><br><span class="line">        phaser.arriveAndDeregister();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为初值设为1，所以最后需要arrive一次</span></span><br><span class="line">phaser.arrive();</span><br><span class="line">phaser.awaitAdvance(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"ok个数"</span>+okCount.get()+<span class="string">" 不ok的个数"</span>+otherCount);</span><br></pre></td></tr></table></figure><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">Java并发编程：CountDownLatch、CyclicBarrier和Semaphore</summary>
    
    
    
    <category term="java" scheme="http://www.zeze.info/categories/java/"/>
    
    
    <category term="java" scheme="http://www.zeze.info/tags/java/"/>
    
    <category term="java高并发编程" scheme="http://www.zeze.info/tags/java%E9%AB%98%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>这是一场修行</title>
    <link href="http://www.zeze.info/life/index/"/>
    <id>http://www.zeze.info/life/index/</id>
    <published>2020-10-09T10:50:45.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="一场修行"><a href="#一场修行" class="headerlink" title="一场修行"></a>一场修行</h1><p>&emsp;我很焦虑,每当听到周围有个朋友有个项目,总是想着沾光,能跟着一起混。这样的想法让总是让我思想混乱。我得承认,确实有很多牛逼又赚钱的生意,但是我赚不来,既然赚不了的钱为何不果断放弃呢？何必让自己那么难受。</p><p>&emsp;每天间歇性地焦虑、意淫式地渴望暴富,只会让我心情更加浮躁,感觉现在的自己已经寸步难行甚至影响到自己的工作了，真的是罪恶。没有清晰地规划，至于怎么一步步解决问题等都没有思考、规划过。这种漫无目的地焦虑是最没有价值的，是负面的。适当的焦虑使人进步，但是我要想清楚自己想要什么，以及怎么解决。明确地目标、清晰地规划、适度地焦虑能够让我走的更远！</p><p>&emsp;赚钱是一场道长且阻的修行，我现在最需要的是磨砺心性，也需要目标明确、步步为营。从现在开始我要明确自己的目标，至少不能被朋友所说的那些“项目”所影响，自己不适合，就永远不要去想，不以物喜不以己悲。不去关心别人赚了多少钱，别人做了什么项目，要关心自己，与自己的内心对话，明白自己具备哪些能力，能做哪些事情，以及如何把事情做到极致！。千万不要为了赚钱而赚钱。要不断地为社会创造长期价值,而现在我能为别人创造价值的唯一途径就是自己的本质工作,作为一名程序员，我一定要认真对待自己的工作,努力学习专业知识,提供更加优质的专业服务，如果公司成功，那对于公司的员工，我觉得我也是成功的，所以目前工作对我意义也非常大。</p><p>&emsp;我很喜欢编程，当时我还很担心就业前景问题。我记得当时我19岁老师给我说过的一句话“种一棵树最好的时间是十年前,其次就是现在”，而如今我都已经有3年多的工作经验了，想那么多最后连自己的工作都做不好，那岂不是让人笑话。所以我现在有一个很明确的目标，就是不断学习专业知识，满足工作需求，甚至出色的完成自己的工作，在业界也要留下好的口碑，在工作遇到的问题，和很多常用的技术，自己能归纳总结好。我坚信人生没有白走的路，每一步都算数。</p><p>&emsp;2020年李克强总理说：中国有6亿人月收入就1000元,年人均收入3万元。这么来看,年入百万是不是比登天还难？没有规划却意淫暴富,就是掩耳盗铃,自欺欺人。无论是打工上班,还是创业做生意,必须有目标,有阶段性规划,然后一步步实现财富增长。我从来不相信暴富,财富都是一点一滴积累的。《过秦论》有言：奋六世之余烈,振长策而御宇内。秦国能一统天下也是六代人不断积累的结果。那些拆迁、中奖等因运气暴富的人有多少能守住财富并富足地过一生？我还很年轻才25岁，还有很多时间。我相信自己可以孵化出属于自己的项目。现在我相信时间的力量，相信日复一日的力量，别人赚多少钱，引多少流量，和我一点关系没有，收心，把心收回自己的身体，身心合一。</p><p>&emsp;今年25岁，在这里给自己定个5年目标。</p><p>第一、重视健康，锻炼身体<br>第二、做好职业规划，让自己不被所在打的行业淘汰<br>第三、学会演讲。</p><p>人生路上，要保持持续的激情、明确地目标，步步为营地创造长期价值！</p><h1 id="我坚信人生没有白走的路，每一步都算数。"><a href="#我坚信人生没有白走的路，每一步都算数。" class="headerlink" title="我坚信人生没有白走的路，每一步都算数。"></a>我坚信人生没有白走的路，每一步都算数。</h1><p>欣然面对困难，坦然面对每一天，不浮躁！</p><h1 id="但行好事，莫问前程"><a href="#但行好事，莫问前程" class="headerlink" title="但行好事，莫问前程"></a>但行好事，莫问前程</h1><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">这是一场修行,但行好事,莫问前程</summary>
    
    
    
    <category term="生活" scheme="http://www.zeze.info/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="生活" scheme="http://www.zeze.info/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>CSS里常见的块级元素</title>
    <link href="http://www.zeze.info/css/index2/"/>
    <id>http://www.zeze.info/css/index2/</id>
    <published>2020-07-29T18:26:49.000Z</published>
    <updated>2021-08-10T01:23:42.994Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="CSS里常见的块级元素"><a href="#CSS里常见的块级元素" class="headerlink" title="CSS里常见的块级元素"></a>CSS里常见的块级元素</h1><blockquote><p>根据CSS规范的规定，每一个网页元素都有一个display属性，用于确定该元素的类型，每一个元素都有默认的display属性值，比如div元素，它的默认display属性值为“block”，成为“块级”元素(block-level)；而span元素的默认display属性值为“inline”，称为“行内”元素。</p></blockquote><blockquote><p>div这样的块级元素，就会自动占据一定矩形空间，可以通过设置高度、宽度、内外边距等属性，来调整的这个矩形的样子；与之相反，像“span”“a”这样的行内元素，则没有自己的独立空间，它是依附于其他块级元素存在的，因此，对行内元素设置高度、宽度、内外边距等属性，都是无效的。</p></blockquote><h2 id="内联元素（行内元素）内联元素-inline-element"><a href="#内联元素（行内元素）内联元素-inline-element" class="headerlink" title="内联元素（行内元素）内联元素(inline element)"></a>内联元素（行内元素）内联元素(inline element)</h2><ul><li>a - 锚点</li><li>abbr - 缩写</li><li>acronym - 首字</li><li>b - 粗体(不推荐)</li><li>bdo - bidi override</li><li>big - 大字体</li><li>br - 换行</li><li>cite - 引用</li><li>code - 计算机代码(在引用源码的时候需要)</li><li>dfn - 定义字段</li><li>em - 强调</li><li>font - 字体设定(不推荐)</li><li>i - 斜体</li><li>img - 图片</li><li>input - 输入框</li><li>kbd - 定义键盘文本</li><li>label - 表格标签</li><li>q - 短引用</li><li>s - 中划线(不推荐)</li><li>samp - 定义范例计算机代码</li><li>select - 项目选择</li><li>small - 小字体文本</li><li>span - 常用内联容器，定义文本内区块</li><li>strike - 中划线</li><li>strong - 粗体强调</li><li>sub - 下标</li><li>sup - 上标</li><li>textarea - 多行文本输入框</li><li>tt - 电传文本</li><li>u - 下划线</li><li>var - 定义变量</li></ul><h2 id="块元素-block-element"><a href="#块元素-block-element" class="headerlink" title="块元素(block element)"></a>块元素(block element)</h2><ul><li>address - 地址</li><li>blockquote - 块引用</li><li>center - 举中对齐块</li><li>dir - 目录列表</li><li>div - 常用块级容易，也是css layout的主要标签</li><li>dl - 定义列表</li><li>fieldset - form控制组</li><li>form - 交互表单</li><li>h1 - 大标题</li><li>h2 - 副标题</li><li>h3 - 3级标题</li><li>h4 - 4级标题</li><li>h5 - 5级标题</li><li>h6 - 6级标题</li><li>hr - 水平分隔线</li><li>isindex - input prompt</li><li>menu - 菜单列表</li><li>noframes - frames可选内容，（对于不支持frame的浏览器显示此区块内容</li><li>noscript - ）可选脚本内容（对于不支持script的浏览器显示此内容）</li><li>ol - 排序表单</li><li>p - 段落</li><li>pre - 格式化文本</li><li>table - 表格</li><li>ul - 非排序列表</li></ul><h2 id="可变元素"><a href="#可变元素" class="headerlink" title="可变元素"></a>可变元素</h2><p>可变元素为根据上下文语境决定该元素为块元素或者内联元素。</p><ul><li>applet - java applet</li><li>button - 按钮</li><li>del - 删除文本</li><li>iframe - inline frame</li><li>ins - 插入的文本</li><li>map - 图片区块(map)</li><li>object - object对象</li><li>script - 客户端脚本</li></ul><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">CSS里常见的块级元素</summary>
    
    
    
    <category term="css" scheme="http://www.zeze.info/categories/css/"/>
    
    <category term="前端" scheme="http://www.zeze.info/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="css" scheme="http://www.zeze.info/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>深入学习Css伪类和伪元素及其用法</title>
    <link href="http://www.zeze.info/css/index1/"/>
    <id>http://www.zeze.info/css/index1/</id>
    <published>2020-07-27T17:22:03.000Z</published>
    <updated>2021-08-10T01:23:42.994Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote><p>CSS的伪类和伪元素在平时的代码中经常会出现，可是一旦别人问你，什么是伪类，什么是伪元素，可能还是不能完整的表述出来，下面我们来一探究竟。</p></blockquote><h1 id="伪类和伪元素定义"><a href="#伪类和伪元素定义" class="headerlink" title="伪类和伪元素定义"></a>伪类和伪元素定义</h1><blockquote><p>伪类用于在页面中的元素处于某个状态时，为其添加指定的样式。</p></blockquote><blockquote><p>伪元素会创建一个抽象的伪元素，这个元素不是DOM中的真实元素，但是会存在于最终的渲染树中，我们可以为其添加样式。</p></blockquote><p><strong>重点:</strong>最常规的区分伪类和伪元素的方法是：实现伪类的效果可以通过添加类来实现，但是想要实现伪元素的等价效果只能创建实际的DOM节点。</p><p><strong>注意:</strong>伪类使用单冒号 “:” ; 伪元素使用双冒号 “::”</p><h1 id="伪元素"><a href="#伪元素" class="headerlink" title="伪元素"></a>伪元素</h1><blockquote><p>伪元素可以分为排版伪元素、突出显示伪元素、树中伪元素三类。</p></blockquote><h2 id="排版伪元素"><a href="#排版伪元素" class="headerlink" title="排版伪元素"></a>排版伪元素</h2><div class="note default"> 设置元素中第一行文本的样式[::first-line]</div><p><strong>注意:</strong>只有当选择器部分和左大括号之间有空格时，IE6-浏览器才支持。因为first-line中存在连接符的原因</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.firstLine</span><span class="selector-pseudo">::first-line</span> &#123;</span></span><br><span class="line">    width: 200px;</span><br><span class="line">    text-transform: uppercase;</span><br><span class="line"><span class="css">    <span class="selector-tag">background</span>: <span class="selector-id">#f3f3f3</span>;</span></span><br><span class="line"> &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"firstLine"</span>&gt;</span>hello world hello worldhello worldhello worldhello worldhello worldhello worldhello worldhello worldhello worldhello worldhello worldhello worldhello worldhello worldhello world <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/css/index1/20200727184822.png!www.zeze.info" alt="first-line"><br>虽然在DOM中看不到，但实际上，上面的这段HTML代码会通过添加虚拟标签的方式进行修改。</p><div class="note default">指定一个元素第一个字母的样式[::first-letter]</div><ul><li>注意1:所有前导标点符号应与第一个字母一同应用该样式</li><li>注意2:只能与块级元素关联</li><li>注意3:只有当选择器部分和左大括号之间有空格时，IE6-浏览器才支持。因为first-letter中存在连接符的原因</li></ul><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/css/index1/20200728110442.png!www.zeze.info" alt="first-letter"></p><h2 id="突出显示伪元素"><a href="#突出显示伪元素" class="headerlink" title="突出显示伪元素"></a>突出显示伪元素</h2><blockquote><p>突出显示伪元素表示文档中特定状态的部分，通常采用不同的样式展示该状态。如页面内容的选中。突出显示伪元素不需要在元素树中有体现，并且可以任意跨越元素边界而不考虑其嵌套结构。</p></blockquote><div class="note default">匹配被用户选择的部分[::selection]</div><p><a href="#">注意1:</a>firefox浏览器需要添加-moz-前缀<br><a href="#">注意2:</a>只支持双冒号写法<br><a href="#">注意3:</a>只支持颜色和背景颜色两个样式</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">div::selection&#123;color: red;&#125;</span><br></pre></td></tr></table></figure><h2 id="树中伪元素"><a href="#树中伪元素" class="headerlink" title="树中伪元素"></a>树中伪元素</h2><div class="note default">::before & ::after::before是在源元素的实际内容前添加伪元素。::after是在源元素的实际内容后添加伪元素。当::before/::after伪元素的content属性不为'none'时，这两类伪元素就会生成一个元素，作为源元素的子元素，可以和DOM树中的元素一样定义样式。</div><p>注意默认这个伪元素是行内元素，且继承元素可继承的属性；IE7-浏览器中必须声明!DOCTYPE，否则不起作用</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// content = 字符串</span><br><span class="line">.box:after&#123;content:"后缀"&#125;</span><br><span class="line">// content = url</span><br><span class="line">div:before&#123;</span><br><span class="line">    content: url("arrow.gif");</span><br><span class="line">&#125;</span><br><span class="line">// content = attr</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-before</span>=<span class="string">"把我现在上去"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">div:before&#123;</span><br><span class="line">    content: attr(data-before);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>content的内容可以直接使用 url() 引入图片</p></blockquote><div class="note default">::markder可以用于定义列表项标记的样式。</div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.item</span><span class="selector-pseudo">::marker</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span><span class="selector-pseudo">:green</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span>Item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span>Item 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span>Item 3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>该伪元素暂时只有safari支持，尝试的话请使用safari。可以用于该伪元素的属性也有限</strong></p><div class="note default">表示输入框内占位提示文字。可以定义其样式。[::placeholder]</div><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-pseudo">::placeholder</span> &#123;</span></span><br><span class="line">            color: blue;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span> =<span class="string">"testtesttest"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><div><style>::placeholder { color: blue;}</style> <input type="text" placeholder="testtesttest"></div><h2 id="伪元素速查表"><a href="#伪元素速查表" class="headerlink" title="伪元素速查表"></a>伪元素速查表</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Typographic Pseudo-elements */</span></span><br><span class="line"><span class="selector-pseudo">::first-line</span>            <span class="comment">/* 选取文字块首行字符 */</span></span><br><span class="line"><span class="selector-pseudo">::first-letter</span>          <span class="comment">/* 选取文字块首行首个字符 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Highlight Pseudo-elements */</span></span><br><span class="line"><span class="selector-pseudo">::selection</span>             <span class="comment">/* 选取文档中高亮(反白)的部分*/</span></span><br><span class="line"><span class="selector-pseudo">::inactive-selection</span>    <span class="comment">/* 选取非活动状态时文档中高亮(反白)的部分*/</span></span><br><span class="line"><span class="selector-pseudo">::spelling-error</span>        <span class="comment">/* 选取被 UA 标记为拼写错误的文本 */</span></span><br><span class="line"><span class="selector-pseudo">::grammar-error</span>         <span class="comment">/* 选取被 UA 标记为语法错误的文本 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Tree-Abiding Pseudo-elements */</span></span><br><span class="line"><span class="selector-pseudo">::before</span>                <span class="comment">/* 在选中元素中创建一个前置的子节点 */</span></span><br><span class="line"><span class="selector-pseudo">::after</span>                 <span class="comment">/* 在选中元素中创建一个后置的子节点 */</span></span><br><span class="line"><span class="selector-pseudo">::marker</span>                <span class="comment">/* 选取列表自动生成的项目标记符号 */</span></span><br><span class="line"><span class="selector-pseudo">::placeholder</span>           <span class="comment">/* 选取字段的占位符文本(提示信息) */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* WebVTT Format */</span></span><br><span class="line"><span class="selector-pseudo">::cue</span>                   <span class="comment">/* 匹配所选元素中 WebVTT 提示 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Fullscreen API */</span></span><br><span class="line"><span class="selector-pseudo">::backdrop</span>              <span class="comment">/* 匹配全屏模式下的背景 */</span></span><br></pre></td></tr></table></figure><h1 id="伪类"><a href="#伪类" class="headerlink" title="伪类"></a>伪类</h1><blockquote><p>伪类经常与伪元素混淆，伪元素的效果类似于通过添加一个实际的元素才能达到，而伪类的效果类似于通过添加一个实际的类来达到。实际上css3为了区分两者，已经明确规定了伪类用一个冒号来表示，而伪元素则用两个冒号来表示。</p></blockquote><h2 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h2><blockquote><p>关于锚点<a>，有常见的5个伪类，分别是:link,:hover,:active,:focus,:visited</a></p></blockquote><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span>&#123;<span class="attribute">background-color</span>:pink;&#125;<span class="comment">/*品红，未访问*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;<span class="attribute">background-color</span>:lightblue;&#125;<span class="comment">/*浅蓝，鼠标悬停*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:active</span>&#123;<span class="attribute">background-color</span>:lightgreen;&#125;<span class="comment">/*浅绿，正被点击*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:focus</span>&#123;<span class="attribute">background-color</span>:lightgrey;&#125;<span class="comment">/*浅灰，拥有焦点*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>&#123;<span class="attribute">color</span>:orange;&#125;<span class="comment">/*字体颜色为橙色，已被访问*/</span></span><br><span class="line"><span class="comment">/*[注意]visited伪类只能设置字体颜色、边框颜色、outline颜色的样式*/</span></span><br></pre></td></tr></table></figure><h2 id="伪类顺序"><a href="#伪类顺序" class="headerlink" title="伪类顺序"></a>伪类顺序</h2><blockquote><p>对于伪类顺序，有一个口诀是love-hate，代表着伪类的顺序是link、visited、focus、hover、active。但是否伪类的顺序只能如此呢？为什么是这个顺序呢？CSS层叠中有一条法则十分重要，就是后面覆盖前面，所以伪类的顺序是需要精心考虑的。</p></blockquote><ol><li>link和visited必须在最前面，且没有先后顺序，否则link或visited的效果将覆盖 hover active focus</li><li>hover、active、focus这三个伪类必须是focus、hover、active的顺序，因为在focus状态下，也需要触发hover和active，而要触发active一定要先触发hover，所以active要放在hover后面</li></ol><p>注意:link和visited称为静态伪类，只能应用于超链接</p><p>所以最终的顺序只有两种:link、visited、focus、hover、active或visited、link、focus、hover、active</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span>&#123;<span class="attribute">background-color</span>:pink;&#125;<span class="comment">/*品红，未访问*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>&#123;<span class="attribute">color</span>:orange;&#125;<span class="comment">/*字体颜色为橙色，已被访问*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:focus</span>&#123;<span class="attribute">background-color</span>:lightgrey;&#125;<span class="comment">/*浅灰，拥有焦点*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;<span class="attribute">background-color</span>:lightblue;&#125;<span class="comment">/*浅蓝，鼠标悬停*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:active</span>&#123;<span class="attribute">background-color</span>:lightgreen;&#125;<span class="comment">/*浅绿，正被点击*/</span></span><br></pre></td></tr></table></figure><div><style>#test:link{background-color:pink;}/*品红，未访问*/#test:visited{color:orange;}/*字体颜色为橙色，已被访问*/#test:focus{background-color:lightgrey;}/*浅灰，拥有焦点*/#test:hover{background-color:lightblue;}/*浅蓝，鼠标悬停*/#test:active{background-color:lightgreen;}/*浅绿，正被点击*/</style> <a id="test" href="#">测试链接伪类</a></div><h2 id="UI元素伪类"><a href="#UI元素伪类" class="headerlink" title="UI元素伪类"></a>UI元素伪类</h2><blockquote><p>UI元素伪类包括:enabled、:disabled、:checked三个，主要针对于HTML中的form元素，IE8-浏览器不支持</p></blockquote><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">:enabled</span>    可用状态</span><br><span class="line"><span class="selector-pseudo">:disabled</span>   不可用状态</span><br><span class="line"><span class="selector-pseudo">:checked</span>    选中状态</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:enabled</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">    <span class="attribute">background-color</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:disabled</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">background-color</span>: gray;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:checked</span>&#123;</span><br><span class="line">    <span class="attribute">outline</span>: <span class="number">2px</span> solid lightblue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;button onclick = "btn.disabled = false;"&gt;按钮可用&lt;/button&gt;</span><br><span class="line">&lt;button onclick = "btn.disabled = true;"&gt;按钮不可用&lt;/button&gt;</span><br><span class="line">&lt;input type="button" id="btn" value="按钮"&gt;</span><br><span class="line">&lt;label&gt;Male&lt;input type="radio" name="sex" /&gt;&lt;/label&gt;</span><br><span class="line">&lt;label&gt;Female&lt;input type="radio" name="sex"  /&gt;&lt;/label&gt;</span><br></pre></td></tr></table></figure><h2 id="结构伪类"><a href="#结构伪类" class="headerlink" title="结构伪类"></a>结构伪类</h2><blockquote><p>结构伪类可分为以下3种情况，IE8-浏览器不支持</p></blockquote><h3 id="【1】-nth-child-n-、-nth-last-child-n-、first-child、last-child、-only-child"><a href="#【1】-nth-child-n-、-nth-last-child-n-、first-child、last-child、-only-child" class="headerlink" title="【1】:nth-child(n)、:nth-last-child(n)、first-child、last-child、:only-child"></a>【1】:nth-child(n)、:nth-last-child(n)、first-child、last-child、:only-child</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:nth-child(n)</span>           选择父元素的第<span class="selector-tag">n</span>个子元素</span><br><span class="line"><span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:nth-last-child(n)</span>      选择父元素的倒数第<span class="selector-tag">n</span>个子元素</span><br><span class="line"><span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:first-child</span>            父元素的第一个子元素，与<span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:nth-child(1)</span>等同</span><br><span class="line"><span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:last-child</span>             父元素的最后一个子元素，与<span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:nth-last-child(1)</span>等同</span><br><span class="line"><span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:only-child</span>             选择父元素中只包含一个子元素</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:first-child</span>    　　 代表的并不是&lt;<span class="selector-tag">p</span>&gt;的第一个子元素，而是&lt;<span class="selector-tag">p</span>&gt;元素是某元素的第一个子元素</span><br><span class="line"><span class="selector-tag">p</span> &gt; <span class="selector-tag">i</span><span class="selector-pseudo">:first-child</span>    匹配所有&lt;<span class="selector-tag">p</span>&gt;元素中的第一个&lt;<span class="selector-tag">i</span>&gt;元素</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:first-child</span> <span class="selector-tag">i</span> 　　  匹配所有作为第一个子元素的&lt;<span class="selector-tag">p</span>&gt;元素中的所有&lt;<span class="selector-tag">i</span>&gt;元素</span><br></pre></td></tr></table></figure><p>[注]n可以是整数(从1开始)，也可以是公式，也可以是关键字(even、odd)</p><h3 id="【2】-nth-of-type-n-、-nth-last-of-type-n-、-first-of-type、-last-of-type、-only-of-type"><a href="#【2】-nth-of-type-n-、-nth-last-of-type-n-、-first-of-type、-last-of-type、-only-of-type" class="headerlink" title="【2】:nth-of-type(n)、:nth-last-of-type(n)、:first-of-type、:last-of-type、:only-of-type"></a>【2】:nth-of-type(n)、:nth-last-of-type(n)、:first-of-type、:last-of-type、:only-of-type</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:nth-of-type(n)</span>          选择父元素的具有指定类型的第<span class="selector-tag">n</span>个子元素</span><br><span class="line"><span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:nth-last-of-type(n)</span>     选择父元素的具有指定类型的倒数第<span class="selector-tag">n</span>个子元素</span><br><span class="line"><span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:first-of-type</span>           选择父元素中具有指定类型的第1个子元素，与<span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:nth-of-type(1)</span>相同</span><br><span class="line"><span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:last-of-type</span>         　  选择父元素中具有指定类型的最后1个子元素，与<span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:nth-last-of-type(1)</span>相同</span><br><span class="line"><span class="selector-tag">E</span> <span class="selector-tag">F</span><span class="selector-pseudo">:only-of-type</span>        　　 选择父元素中只包含一个同类型的子元素</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type(even)</span>&#123;<span class="attribute">color</span>: red;&#125; </span><br><span class="line"><span class="selector-class">.box</span> <span class="selector-tag">p</span><span class="selector-pseudo">:nth-last-of-type(3)</span>&#123;<span class="attribute">color</span>: green;&#125;</span><br><span class="line"><span class="selector-class">.box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:first-of-type</span>&#123;<span class="attribute">color</span>: blue;&#125;</span><br><span class="line"><span class="selector-class">.box</span> <span class="selector-tag">p</span><span class="selector-pseudo">:last-of-type</span>&#123;<span class="attribute">color</span>: yellow;&#125;</span><br><span class="line"><span class="selector-class">.box</span> <span class="selector-tag">div</span><span class="selector-pseudo">:only-of-type</span>&#123;<span class="attribute">color</span>: pink;&#125;</span><br></pre></td></tr></table></figure><h3 id="【3】-root、-not、-empty、-target"><a href="#【3】-root、-not、-empty、-target" class="headerlink" title="【3】:root、:not、:empty、:target"></a>【3】:root、:not、:empty、:target</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span>        　选择文档的根元素</span><br><span class="line"><span class="selector-pseudo">:not</span>         　选择除某个元素之外的所有元素</span><br><span class="line"><span class="selector-pseudo">:empty</span>         选择没有子元素的元素，而且该元素也不包含任何文本节点</span><br><span class="line"><span class="selector-pseudo">:target</span>     　 匹配锚点对应的目标元素</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[注意]</span><span class="selector-pseudo">:not</span>选择器常用于导航之间的竖线处理，如<span class="selector-tag">li</span><span class="selector-pseudo">:not(</span><span class="selector-pseudo">:last-of-type)</span></span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:root</span>&#123;<span class="attribute">color</span>:red;&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:not</span>&#123;<span class="attribute">background-color</span>: lightgrey;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:empty</span>&#123;<span class="attribute">height</span>:<span class="number">30px</span>;<span class="attribute">width</span>:<span class="number">30px</span>;<span class="attribute">background</span>:pink;&#125;</span><br><span class="line">:target&#123;color:blue;&#125; // 当点击页面上面的锚点时，锚点到的目标元素会采用这个样式</span><br></pre></td></tr></table></figure><h3 id="【其它】"><a href="#【其它】" class="headerlink" title="【其它】"></a>【其它】</h3><ol><li><p>:lang() 匹配某个语言，IE7-浏览器不支持</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:lang(en)</span> 匹配语言为"<span class="selector-tag">en</span>"的&lt;<span class="selector-tag">p</span>&gt;</span><br></pre></td></tr></table></figure></li><li><p>不仅可以使用单一伪类，也可以伪类结合使用</p></li></ol><p>顺序无关</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">:first-child</span>&#123;<span class="attribute">background-color</span>: lightgreen;&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:last-of-type</span><span class="selector-pseudo">:active</span>&#123;<span class="attribute">background-color</span>: lightblue;&#125;</span><br></pre></td></tr></table></figure><h2 id="伪类速查表"><a href="#伪类速查表" class="headerlink" title="伪类速查表"></a>伪类速查表</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Logical Combinations */</span></span><br><span class="line"><span class="selector-pseudo">:matches()</span> <span class="comment">/*:any()*/</span>   <span class="comment">/* 匹配 集合内指定 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:not()</span>                  <span class="comment">/* 排除 满足指定关系 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:has()</span>                  <span class="comment">/* 匹配 满足指定关系 的元素*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Linguistic Pseudo-classes */</span></span><br><span class="line"><span class="selector-pseudo">:dir()</span>                  <span class="comment">/* 匹配 设置dir(文字书写方向)属性 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:lang()</span>                 <span class="comment">/* 匹配 设置lang(定义元素语言)属性 的元素 */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Location Pseudo-classes */</span></span><br><span class="line"><span class="selector-pseudo">:any-link</span>               <span class="comment">/* 匹配 任意有链接锚点 的元素*/</span></span><br><span class="line"><span class="selector-pseudo">:link</span>                   <span class="comment">/* 匹配 未处于访问记录中 的链接 */</span></span><br><span class="line"><span class="selector-pseudo">:visited</span>                <span class="comment">/* 匹配 处于访问记录中 的链接 */</span></span><br><span class="line"><span class="selector-pseudo">:target</span>                 <span class="comment">/* 匹配 URL指向的锚点 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:scope</span>                  <span class="comment">/* 匹配 设置scoped属性的style标签 的作用域 */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* User Action Pseudo-classes */</span></span><br><span class="line"><span class="selector-pseudo">:hover</span>                  <span class="comment">/* 匹配 处于鼠标悬停状态 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:active</span>                 <span class="comment">/* 匹配 处于激活状态 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:focus</span>                  <span class="comment">/* 匹配 处于聚焦状态 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:focus-ring</span>             <span class="comment">/* 匹配 处于聚焦状态元素 的UA样式(聚焦轮廓) */</span></span><br><span class="line"><span class="selector-pseudo">:focus-within</span>           <span class="comment">/* 匹配 子节点处于聚焦状态 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:drop</span>                   <span class="comment">/* 匹配 处于拖拽状态 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:drop()</span>                 <span class="comment">/* 匹配 处于指定拖拽状态 的元素 */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Time-dimensional Pseudo-classes */</span></span><br><span class="line"><span class="selector-pseudo">:current</span>                <span class="comment">/* 匹配 处于当前状态 的定义了timeline属性的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:past</span>                   <span class="comment">/* 匹配 处于过去状态 的定义了timeline属性的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:future</span>                 <span class="comment">/* 匹配 处于将来状态 的定义了timeline属性的元素 */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Resource State Pseudos */</span></span><br><span class="line"><span class="selector-pseudo">:playing</span>                <span class="comment">/* 匹配 处于播放状态 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:paused</span>                 <span class="comment">/* 匹配 处于暂停状态 的元素 */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The Input Pseudo-classes */</span></span><br><span class="line"><span class="selector-pseudo">:enabled</span>                <span class="comment">/* 匹配 可以编辑 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:disabled</span>               <span class="comment">/* 匹配 禁止编辑 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:read-only</span>              <span class="comment">/* 匹配 内容只读 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:read-write</span>             <span class="comment">/* 匹配 内容可编辑 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:placeholder-shown</span>      <span class="comment">/* 匹配 显示字段占位符文本 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:default</span>                <span class="comment">/* 匹配 页面载入默认选中 的元素 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:checked</span>                <span class="comment">/* 匹配 选中状态 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:indeterminate</span>          <span class="comment">/* 匹配 模糊状态 的元素 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:valid</span>                  <span class="comment">/* 匹配 输入内容通过类型验证 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:invalid</span>                <span class="comment">/* 匹配 输入内容无法通过类型验证 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:in-range</span>               <span class="comment">/* 匹配 输入数值符合范围 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:out-of-range</span>           <span class="comment">/* 匹配 输入数值溢出范围 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:required</span>               <span class="comment">/* 匹配 设置必填属性 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:optional</span>               <span class="comment">/* 匹配 可选字段 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:user-invalid</span>           <span class="comment">/* 匹配 用户输入内容未通过验证 的元素 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Tree-Structural pseudo-classes */</span></span><br><span class="line"><span class="selector-pseudo">:root</span>                   <span class="comment">/* 匹配 文档树 的根元素*/</span></span><br><span class="line"><span class="selector-pseudo">:empty</span>                  <span class="comment">/* 匹配 无子节点 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:blank</span>                  <span class="comment">/* 匹配 仅包含空格或者换行符 的元素 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:nth-child(n)</span>           <span class="comment">/* 匹配 符合元素集合中指定位置 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:nth-last-child(n)</span>      <span class="comment">/* 反序匹配 符合元素集合内指定位置 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:first-child</span>            <span class="comment">/* 匹配 符合元素集合内首个 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:last-child</span>             <span class="comment">/* 匹配 符合元素集合内末尾 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:only-child</span>             <span class="comment">/* 匹配 无兄弟节点 的元素 */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:nth-of-type(n)</span>         <span class="comment">/* 匹配 符合元素集合中同类型指定位置 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:nth-last-of-type(n)</span>    <span class="comment">/* 反序匹配 符合元素集合中同类型指定位置 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:first-of-type</span>          <span class="comment">/* 匹配 每个在元素集合中初次出现 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:last-of-type</span>           <span class="comment">/* 匹配 每个在元素集合中末次出现 的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:only-of-type</span>           <span class="comment">/* 匹配 无同类兄弟节点 的元素*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Fullscreen API */</span></span><br><span class="line"><span class="selector-pseudo">:fullscreen</span>             <span class="comment">/* 匹配 全屏显示模式中 的元素 */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Page Selectors */</span></span><br><span class="line"><span class="selector-pseudo">:first</span>                  <span class="comment">/* 打印文档时首页的样式 */</span></span><br><span class="line"><span class="selector-pseudo">:left</span>                   <span class="comment">/* 打印文档时左侧的样式 */</span></span><br><span class="line"><span class="selector-pseudo">:right</span>                  <span class="comment">/* 打印文档时右侧的样式 */</span></span><br></pre></td></tr></table></figure><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">css伪类和伪元素</summary>
    
    
    
    <category term="css" scheme="http://www.zeze.info/categories/css/"/>
    
    <category term="前端" scheme="http://www.zeze.info/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="css" scheme="http://www.zeze.info/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>责任链模式</title>
    <link href="http://www.zeze.info/java/design/j4/"/>
    <id>http://www.zeze.info/java/design/j4/</id>
    <published>2020-06-11T10:14:48.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="业务场景"><a href="#业务场景" class="headerlink" title="业务场景"></a>业务场景</h1><blockquote><p>每个版本都是一点一点演化过去的。代码版本多，但是都很简单行数也不多</p></blockquote><ol><li>在论坛发布文章</li><li>后台要经过处理才可以发表或者存入数据库</li><li>每条链都需要有权限去判断还继不继续往下执行</li><li>servlet filter实现</li></ol><h2 id="代码版本v1"><a href="#代码版本v1" class="headerlink" title="代码版本v1"></a>代码版本v1</h2><p><a href="https://github.com/zhangzeli/design_patterns/tree/master/src/main/java/com/cor/v1" target="_blank" rel="external nofollow noopener noreferrer">代码版本v1</a></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Msg msg = <span class="keyword">new</span> Msg();</span><br><span class="line">        <span class="comment">//在论坛发帖</span></span><br><span class="line">        msg.setMsg(<span class="string">"大家好：&#125;&lt;script&gt; ,欢迎访问www.zeze.info 台湾 "</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//第一步网页脚本</span></span><br><span class="line">        String r = msg.getMsg();</span><br><span class="line">        r = r.replace(<span class="string">"&lt;"</span>,<span class="string">"&amp;lt;"</span>);</span><br><span class="line">        r = r.replace(<span class="string">"&gt;"</span>,<span class="string">"&amp;gt;"</span>);</span><br><span class="line">        msg.setMsg(r);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//第二步处理敏感词</span></span><br><span class="line">        r = r.replace(<span class="string">"台湾"</span>,<span class="string">"中国"</span>);</span><br><span class="line">        msg.setMsg(r);</span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Msg</span></span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    String msg;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Msg&#123;"</span> +</span><br><span class="line">                <span class="string">"msg='"</span> + msg + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代码版本说明"><a href="#代码版本说明" class="headerlink" title="代码版本说明"></a>代码版本说明</h2><blockquote><p>代码直接写在一起，如果要加入其它的处理逻辑必须修改源码，比如现在要加一个URL过滤的处理，所以现在抽象出Filter，和FilterChain。对应版本V2和v3</p></blockquote><h2 id="代码V2-v3"><a href="#代码V2-v3" class="headerlink" title="代码V2-v3"></a>代码V2-v3</h2><p><a href="https://github.com/zhangzeli/design_patterns/tree/master/src/main/java/com/cor/v2" target="_blank" rel="external nofollow noopener noreferrer">代码版本v2</a><br><a href="https://github.com/zhangzeli/design_patterns/tree/master/src/main/java/com/cor/v3" target="_blank" rel="external nofollow noopener noreferrer">代码版本v3</a></p><p>这里直接贴出代码V3</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cor.v3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Msg</span></span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    String msg;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Msg&#123;"</span> +</span><br><span class="line">                <span class="string">"msg='"</span> + msg + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doFilter</span><span class="params">( Msg msg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FilterChain</span></span>&#123;</span><br><span class="line">    List&lt; Filter&gt; filters = <span class="keyword">new</span>  ArrayList&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFilter</span><span class="params">(Filter filter)</span></span>&#123;</span><br><span class="line">        filters.add(filter);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteFilter</span><span class="params">(Filter filter)</span></span>&#123;</span><br><span class="line">        filters.remove(filter);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 链条处理完.这个方法名现在 故意这么取得后面就知道了</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(Msg msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> ( Filter f : filters)&#123;</span><br><span class="line">            f.doFilter(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTMLfilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">( Msg msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//第一步网页脚本</span></span><br><span class="line">        String r = msg.getMsg();</span><br><span class="line">        r = r.replace(<span class="string">"&lt;"</span>,<span class="string">"&amp;lt;"</span>);</span><br><span class="line">        r = r.replace(<span class="string">"&gt;"</span>,<span class="string">"&amp;gt;"</span>);</span><br><span class="line">        msg.setMsg(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SensitiveFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">( Msg msg)</span> </span>&#123;</span><br><span class="line">        String r = msg.getMsg();</span><br><span class="line">        <span class="comment">//第二步处理敏感词</span></span><br><span class="line">        r = r.replace(<span class="string">"台湾"</span>,<span class="string">"中国"</span>);</span><br><span class="line">        msg.setMsg(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Msg msg = <span class="keyword">new</span> Msg();</span><br><span class="line">        <span class="comment">//在论坛发帖</span></span><br><span class="line">        msg.setMsg(<span class="string">"大家好：&#125;&lt;script&gt; ,欢迎访问www.zeze.info 台湾 "</span>);</span><br><span class="line"></span><br><span class="line">        FilterChain filterChain = <span class="keyword">new</span> FilterChain();</span><br><span class="line"></span><br><span class="line">        filterChain.addFilter(<span class="keyword">new</span> HTMLfilter());</span><br><span class="line">        filterChain.addFilter(<span class="keyword">new</span> SensitiveFilter());</span><br><span class="line">        filterChain.doFilter(msg);</span><br><span class="line"></span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代码版本说明-1"><a href="#代码版本说明-1" class="headerlink" title="代码版本说明"></a>代码版本说明</h2><blockquote><p>此时处理链是可以配置，比如我要先处理<code>HTML</code>,或者先处理<code>Sensitive</code>,但是现在需求就是我这条链可以加入其它链，而且如果上一条链处理不通过 下面所以的链都不执行了</p></blockquote><h2 id="代码v4-v5"><a href="#代码v4-v5" class="headerlink" title="代码v4-v5"></a>代码v4-v5</h2><p><a href="https://github.com/zhangzeli/design_patterns/tree/master/src/main/java/com/cor/v4" target="_blank" rel="external nofollow noopener noreferrer">代码版本v4</a><br><a href="https://github.com/zhangzeli/design_patterns/tree/master/src/main/java/com/cor/v5" target="_blank" rel="external nofollow noopener noreferrer">代码版本v5</a></p><blockquote><p>这里直接贴出 V5,我改进的有两个地方，第一让FilterChain也去实现Filter。这样我在addFilter的时候也可以加FilterChain.还有一个小技巧，在addFilter的方法返回一个FilterChain这样可以在调用的时链式调用。将doFilter方法返回值改为Boolean。即可实现新的需求</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cor.v5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Msg</span></span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    String msg;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Msg&#123;"</span> +</span><br><span class="line">                <span class="string">"msg='"</span> + msg + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">doFilter</span><span class="params">(Msg msg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FilterChain</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    List&lt;Filter&gt; filters = <span class="keyword">new</span>  ArrayList&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterChain <span class="title">addFilter</span><span class="params">(Filter filter)</span></span>&#123;</span><br><span class="line">        filters.add(filter);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteFilter</span><span class="params">(Filter filter)</span></span>&#123;</span><br><span class="line">        filters.remove(filter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 链条处理完</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doFilter</span><span class="params">(Msg msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> ( Filter f : filters)&#123;</span><br><span class="line">            <span class="keyword">boolean</span> r = f.doFilter(msg);</span><br><span class="line">            <span class="keyword">if</span>(!r)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTMLfilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doFilter</span><span class="params">( Msg msg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//第一步网页脚本</span></span><br><span class="line">        String r = msg.getMsg();</span><br><span class="line">        r = r.replace(<span class="string">"&lt;"</span>,<span class="string">"&amp;lt;"</span>);</span><br><span class="line">        r = r.replace(<span class="string">"&gt;"</span>,<span class="string">"&amp;gt;"</span>);</span><br><span class="line">        msg.setMsg(r);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SensitiveFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doFilter</span><span class="params">( Msg msg)</span> </span>&#123;</span><br><span class="line">        String r = msg.getMsg();</span><br><span class="line">        <span class="comment">//第二步处理敏感词</span></span><br><span class="line">        r = r.replace(<span class="string">"台湾"</span>,<span class="string">"中国"</span>);</span><br><span class="line">        msg.setMsg(r);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">URLFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doFilter</span><span class="params">(Msg msg)</span> </span>&#123;</span><br><span class="line">        String r = msg.getMsg();</span><br><span class="line">        r = r.replace(<span class="string">"zeze.info"</span>,<span class="string">"^_^"</span>);</span><br><span class="line">        msg.setMsg(r);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SQLFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doFilter</span><span class="params">(Msg msg)</span> </span>&#123;</span><br><span class="line">        String r = msg.getMsg();</span><br><span class="line">        r = r.replace(<span class="string">"OR"</span>,<span class="string">""</span>);</span><br><span class="line">        r = r.replace(<span class="string">"select"</span>,<span class="string">""</span>);</span><br><span class="line">        msg.setMsg(r);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Msg msg = <span class="keyword">new</span> Msg();</span><br><span class="line">        <span class="comment">//在论坛发帖</span></span><br><span class="line">        msg.setMsg(<span class="string">"大家好：&#125;&lt;script&gt; ,欢迎访问www.zeze.info 台湾 OR 1=1 "</span>);</span><br><span class="line"></span><br><span class="line">        FilterChain filterChain = <span class="keyword">new</span> FilterChain();</span><br><span class="line"></span><br><span class="line">        filterChain.addFilter(<span class="keyword">new</span> HTMLfilter())</span><br><span class="line">                .addFilter(<span class="keyword">new</span> SensitiveFilter());</span><br><span class="line">        FilterChain filterChain2 = <span class="keyword">new</span> FilterChain();</span><br><span class="line">        filterChain2.addFilter(<span class="keyword">new</span> URLFilter());</span><br><span class="line">        filterChain2.addFilter(<span class="keyword">new</span> SQLFilter());</span><br><span class="line">        filterChain.addFilter(filterChain2);</span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="servlet-filter实现"><a href="#servlet-filter实现" class="headerlink" title="servlet filter实现"></a>servlet filter实现</h2><blockquote><p>先统一处理Request，然后在处理Response</p></blockquote><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/design/j4/20200611162114.png!www.zeze.info" alt="servlet filter"></p><p><a href="https://github.com/zhangzeli/design_patterns/tree/master/src/main/java/com/cor/v5" target="_blank" rel="external nofollow noopener noreferrer">代码版本v6</a></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">doFilter</span><span class="params">(Request request,Response response,FilterChain filterChain)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FilterChain</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    List&lt;Filter&gt; filters = <span class="keyword">new</span>  ArrayList&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterChain <span class="title">addFilter</span><span class="params">(Filter filter)</span></span>&#123;</span><br><span class="line">        filters.add(filter);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteFilter</span><span class="params">(Filter filter)</span></span>&#123;</span><br><span class="line">        filters.remove(filter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 链条处理完</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doFilter</span><span class="params">(Request request,Response response,FilterChain filterChain)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index==filters.size())&#123;<span class="keyword">return</span> <span class="keyword">true</span>;&#125;</span><br><span class="line">        Filter chain = filters.get(index);</span><br><span class="line">        index++;</span><br><span class="line">        chain.doFilter(request,response,filterChain);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span></span>&#123;</span><br><span class="line">    String data=<span class="string">"Request:"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Response</span></span>&#123;</span><br><span class="line">    String data=<span class="string">"Response:"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTMLfilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doFilter</span><span class="params">(Request request,Response response,FilterChain filterChain)</span> </span>&#123;</span><br><span class="line">        request.setData(request.getData()+<span class="string">"HTMLfilter--"</span>);</span><br><span class="line">        filterChain.doFilter(request, response, filterChain);</span><br><span class="line">        response.setData(response.getData()+<span class="string">"HTMLfilter--"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SensitiveFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doFilter</span><span class="params">(Request request,Response response,FilterChain filterChain)</span> </span>&#123;</span><br><span class="line">        request.setData(request.getData()+<span class="string">"SensitiveFilter--"</span>);</span><br><span class="line">        filterChain.doFilter(request, response, filterChain);</span><br><span class="line">        response.setData(response.getData()+<span class="string">"SensitiveFilter--"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Response response = <span class="keyword">new</span> Response();</span><br><span class="line">        Request request = <span class="keyword">new</span> Request();</span><br><span class="line"></span><br><span class="line">        FilterChain filterChain = <span class="keyword">new</span> FilterChain();</span><br><span class="line">        filterChain.addFilter(<span class="keyword">new</span> HTMLfilter()).addFilter(<span class="keyword">new</span> SensitiveFilter());</span><br><span class="line">        filterChain.doFilter(request,response,filterChain);</span><br><span class="line">        System.out.println(request.getData());</span><br><span class="line">        System.out.println(response.getData());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果对你有帮助，请转发，谢谢</p><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">设计模式 观察者模式</summary>
    
    
    
    <category term="设计模式" scheme="http://www.zeze.info/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="java" scheme="http://www.zeze.info/categories/java/"/>
    
    
    <category term="设计模式" scheme="http://www.zeze.info/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>观察者模式</title>
    <link href="http://www.zeze.info/java/design/j3/"/>
    <id>http://www.zeze.info/java/design/j3/</id>
    <published>2020-06-09T18:33:04.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="业务场景模拟"><a href="#业务场景模拟" class="headerlink" title="业务场景模拟"></a>业务场景模拟</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">小孩在睡觉是被观察者</span><br><span class="line"></span><br><span class="line">爸爸，妈妈，和宠物是观察者</span><br><span class="line"></span><br><span class="line">小孩状态：睡觉 和 刚睡醒之后可能哭闹（cry）</span><br></pre></td></tr></table></figure><h1 id="代码版本V1"><a href="#代码版本V1" class="headerlink" title="代码版本V1"></a>代码版本V1</h1><p><a href="https://github.com/zhangzeli/design_patterns/blob/master/src/main/java/com/observer/v1/Main.java" target="_blank" rel="external nofollow noopener noreferrer">Github地址</a></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.observer.v1;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> cry = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> Dad dad = <span class="keyword">new</span> Dad();</span><br><span class="line">    <span class="keyword">private</span> Mum mum = <span class="keyword">new</span> Mum();</span><br><span class="line">    <span class="keyword">private</span> Dog dog = <span class="keyword">new</span> Dog();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">wekeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cry = <span class="keyword">true</span>;</span><br><span class="line">        dad.feed();</span><br><span class="line">        dog.Wang();</span><br><span class="line">        mum.hug();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dad</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">feed</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"dad feeding ..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mum</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hug</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"mum hugging ..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Wang</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"dog wang ..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Child child = <span class="keyword">new</span> Child();</span><br><span class="line">        child.wekeup();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代码说明"><a href="#代码说明" class="headerlink" title="代码说明"></a>代码说明</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">这个版本代码比较简单，被观察者持有观察者引用,当业代码调用小孩的weakup时触发通知，此时爸爸，妈妈，宠物会作出不同的反应。</span><br></pre></td></tr></table></figure><h2 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">可见代码耦合度非常高，当新增一个观察者时必须通过修改源码才能实现，比如增加一个叔叔观察小孩，而且观察者的反应也不应该耦合到被观察者身上，比如狗见鸡跳墙也可能会叫</span><br></pre></td></tr></table></figure><h2 id="代码改进"><a href="#代码改进" class="headerlink" title="代码改进"></a>代码改进</h2><ol><li>定义Observer接口 里面有个方法叫 action 。抽象出观察者，方便扩展</li><li>被观察者定义一个集合用来存观察者</li><li>以下代码是在代码块里面初始化的观察者，实际上可以放在配置文件里面初始化观察者。这也新增观察者不会再需要修改源码了</li></ol><h1 id="代码版本V2"><a href="#代码版本V2" class="headerlink" title="代码版本V2"></a>代码版本V2</h1><p><a href="https://github.com/zhangzeli/design_patterns/blob/master/src/main/java/com/observer/v2/Main.java" target="_blank" rel="external nofollow noopener noreferrer">Github地址</a></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.observer.v2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> cry = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        observers.add(<span class="keyword">new</span> Dad());</span><br><span class="line">        observers.add(<span class="keyword">new</span> Mum());</span><br><span class="line">        observers.add(<span class="keyword">new</span> Dog());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">wekeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cry = <span class="keyword">true</span>;</span><br><span class="line">        observers.forEach(o-&gt;&#123;</span><br><span class="line">            o.action();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dad</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">feed</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"dad feeding ..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        feed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mum</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hug</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"mum hugging ..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        hug();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wang</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"dog wang ..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        wang();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Child child = <span class="keyword">new</span> Child();</span><br><span class="line">        child.wekeup();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="新需求"><a href="#新需求" class="headerlink" title="新需求"></a>新需求</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">对应观察者（爸爸，妈妈，宠物）来说只能观察小孩，我们现在需求，比如观察厨房里面的汤做好没。观察家里闹钟等等，如此我们需要将被观察者也进行抽象（定义一个Subject接口，被观察者去实现，现在指的是小孩，汤，水）。被观察者会发出不同的事件，比如闹钟响事件，汤做好了事件，小孩醒了事件，水烧开了事件，所以定义事件对象（Event）</span><br></pre></td></tr></table></figure><h2 id="代码版本V3"><a href="#代码版本V3" class="headerlink" title="代码版本V3"></a>代码版本V3</h2><p><a href="https://github.com/zhangzeli/design_patterns/blob/master/src/main/java/com/observer/v3/Main.java" target="_blank" rel="external nofollow noopener noreferrer">Github地址</a></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 不同的观察者根据事件类型不同，做不同的处理</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> event</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">action</span><span class="params">(Event event)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notifyObserver</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> cry = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">wekeup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cry = <span class="keyword">true</span>;</span><br><span class="line">        observers.forEach(o -&gt; &#123;</span><br><span class="line">            Event e = <span class="keyword">new</span> Event(System.currentTimeMillis(),<span class="string">"sleep"</span>,<span class="keyword">this</span>);</span><br><span class="line">            o.action(e);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observers.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        wekeup();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 事件对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 事件发生事件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> timestamp;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 事件名称，或者类型，可以定义枚举。咋这里为了掩饰方便</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 事件源对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Subject source;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Event</span><span class="params">(<span class="keyword">long</span> timestamp, String name, Subject source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.timestamp = timestamp;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.source = source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getTimestamp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> timestamp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Subject <span class="title">getSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dad</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">feed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"dad feeding ..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">(Event event)</span> </span>&#123;</span><br><span class="line">        feed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mum</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hug</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"mum hugging ..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">(Event event)</span> </span>&#123;</span><br><span class="line">        hug();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">wang</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"dog wang ..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">(Event event)</span> </span>&#123;</span><br><span class="line">        wang();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Subject subject = <span class="keyword">new</span> Child();</span><br><span class="line">        subject.addObserver(<span class="keyword">new</span> Dad());</span><br><span class="line">        subject.addObserver(<span class="keyword">new</span> Mum());</span><br><span class="line">        subject.addObserver(<span class="keyword">new</span> Dog());</span><br><span class="line">        subject.addObserver((e)-&gt;&#123;</span><br><span class="line">            System.out.println(e.getName());</span><br><span class="line">            System.out.println(e.getTimestamp());</span><br><span class="line">            System.out.println(e.getSource());</span><br><span class="line">        &#125;);</span><br><span class="line">        subject.notifyObserver();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>缺点：</p><ol><li><p>一个观察目标对象有很多直接和间接的观察者，将所有的观察者都通知到会很花时间。</p></li><li><p>如果在观察者和观察目标之间存在循环依赖，观察目标会触发他们之间循环调用，可能会死循环。</p></li></ol><p>使用场景：</p><ol><li><p>一个对象的改变将导致一个或多个其他对象也发生改变，而不知道具体改变了多少。也不知道改变了谁。</p></li><li><p>需要在系统中创建一个触发链，A对象的行为将影响B对象，B对象将影响C以此类推。创建触发链条机制。</p></li></ol><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">设计模式 观察者模式</summary>
    
    
    
    <category term="设计模式" scheme="http://www.zeze.info/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="java" scheme="http://www.zeze.info/categories/java/"/>
    
    
    <category term="设计模式" scheme="http://www.zeze.info/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>设计模式：访问者（Visitoe）模式</title>
    <link href="http://www.zeze.info/java/design/j2/"/>
    <id>http://www.zeze.info/java/design/j2/</id>
    <published>2020-05-22T15:44:52.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>什么叫做访问，如果大家学过数据结构，对于这点就很清晰了，遍历就是访问的一般形式，单独读取一个元素进行相应的处理也叫作访问，读取到想要查看的内容+对其进行处理就叫做访问，那么我们平常是怎么访问的，基本上就是直接拿着需要访问的地址（引用）来读写内存就可以了。</p><p>为什么还要有一个访问者模式呢，这就要放到OOP之中了，在面向对象编程的思想中，我们使用类来组织属性，以及对属性的操作，那么我们理所当然的将访问操作放到了类的内部，这样看起来没问题，但是当我们想要使用另一种遍历方式要怎么办呢，我们必须将这个类进行修改，这在设计模式中是大忌，在设计模式中就要保证，对扩展开放，对修改关闭的开闭原则。</p><p>因此，我们思考，可不可以将<strong>访问操作独立出来</strong>变成一个新的类，当我们需要增加访问操作的时候，直接增加新的类，原来的代码不需要任何的改变，如果可以这样做，那么我们的程序就是好的程序，因为可以扩展，符合开闭原则。而访问者模式就是实现这个的，使得使用不同的访问方式都可以对某些元素进行访问。</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/java/design/j2/20200522183840.png!www.zeze.info" alt="类图"></p><blockquote><p>涉及角色</p></blockquote><ul><li>Visitor 抽象访问者角色，为该对象结构中具体元素角色声明一个访问操作接口。该操作接口的名字和参数标识了发送访问请求给具体访问者的具体元素角色，这样访问者就可以通过该元素角色的特定接口直接访问它。</li><li>ConcreteVisitor (下文中ListVisitor和FileVisitor).具体访问者角色，实现Visitor声明的接口。</li><li>Element  定义一个接受访问操作(accept())，它以一个访问者(Visitor)作为参数。</li><li>ConcreteElement  (下文中Directory和File) 具体元素，实现了抽象元素(Element)所定义的接受操作接口。</li><li>ObjectStructure (下文中Entry) 结构对象角色，这是使用访问者模式必备的角色。它具备以下特性：能枚举它的元素；可以提供一个高层接口以允许访问者访问它的元素；如有需要，可以设计成一个复合对象或者一个聚集（如一个列表或无序集合）</li></ul><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><p><strong>Element 接口</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Element</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Entry 类</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">implements</span> <span class="title">Element</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">printList</span><span class="params">(String prefix)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">printList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        printList(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  Entry <span class="title">add</span><span class="params">(Entry entry)</span> <span class="keyword">throws</span> RuntimeException</span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  Iterator <span class="title">iterator</span><span class="params">()</span> <span class="keyword">throws</span> RuntimeException</span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getName()+<span class="string">"&lt;"</span>+getSize()+<span class="string">"&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>File 类：</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">File</span> <span class="keyword">extends</span> <span class="title">Entry</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">File</span><span class="params">(String name,<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name=name;</span><br><span class="line">        <span class="keyword">this</span>.size=size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printList</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        System.out.println(prefix+<span class="string">"/"</span>+<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//  System.out.println("开始访问文件:"+this);</span></span><br><span class="line">        visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">       <span class="comment">// System.out.println("结束访问文件:"+this);</span></span><br><span class="line">       <span class="comment">// System.out.println();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Directory类：</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Directory</span> <span class="keyword">extends</span> <span class="title">Entry</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String name;</span><br><span class="line">    ArrayList entrys=<span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Directory</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name=name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> size=<span class="number">0</span>;</span><br><span class="line">        Iterator it=entrys.iterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">            size+=((Entry)it.next()).getSize();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Entry <span class="title">add</span><span class="params">(Entry entry)</span> </span>&#123;</span><br><span class="line">        entrys.add(entry);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> entrys.iterator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printList</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        System.out.println(prefix+<span class="string">"/"</span>+<span class="keyword">this</span>);</span><br><span class="line">        Iterator it=entrys.iterator();</span><br><span class="line">        Entry entry;</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">            entry=(Entry)it.next();</span><br><span class="line">            entry.printList(prefix+<span class="string">"/"</span>+name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//  System.out.println("开始访问文件夹:"+this);</span></span><br><span class="line">        visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">     <span class="comment">//   System.out.println("结束访问文件夹:"+this);</span></span><br><span class="line">     <span class="comment">//   System.out.println();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Visitor 类：</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(File file)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Directory directory)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ListVisitor类：</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListVisitor</span> <span class="keyword">extends</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String currentDir = <span class="string">""</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        System.out.println(currentDir+<span class="string">"/"</span>+file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Directory directory)</span> </span>&#123;</span><br><span class="line">        System.out.println(currentDir+<span class="string">"/"</span>+directory);</span><br><span class="line">        String saveDir=currentDir;</span><br><span class="line">        currentDir+=(<span class="string">"/"</span>+directory.getName());</span><br><span class="line">        Iterator it=directory.iterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">            Entry entry=(Entry)it.next();</span><br><span class="line">            entry.accept(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        currentDir=saveDir;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>FileVisitor 类：</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileVisitor</span> <span class="keyword">extends</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String currentDir = <span class="string">""</span>;</span><br><span class="line">    String suffix;</span><br><span class="line">    ArrayList files=<span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FileVisitor</span><span class="params">(String suffix)</span></span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(file.getName().endsWith(suffix))&#123;</span><br><span class="line">         <span class="comment">// System.out.println(currentDir+"/"+file);</span></span><br><span class="line">            files.add(currentDir+<span class="string">"/"</span>+file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Directory directory)</span> </span>&#123;</span><br><span class="line">        String saveDir=currentDir;</span><br><span class="line">        currentDir+=(<span class="string">"/"</span>+directory.getName());</span><br><span class="line">        Iterator it=directory.iterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">            Entry entry=(Entry)it.next();</span><br><span class="line">            entry.accept(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        currentDir=saveDir;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Iterator <span class="title">getFiles</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> files.iterator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Client类</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.visitor.t1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Directory root=<span class="keyword">new</span> Directory(<span class="string">"根目录"</span>);</span><br><span class="line"></span><br><span class="line">        Directory life=<span class="keyword">new</span> Directory(<span class="string">"我的生活"</span>);</span><br><span class="line">        File eat=<span class="keyword">new</span> File(<span class="string">"吃火锅.txt"</span>,<span class="number">100</span>);</span><br><span class="line">        File sleep=<span class="keyword">new</span> File(<span class="string">"睡觉.html"</span>,<span class="number">100</span>);</span><br><span class="line">        File study=<span class="keyword">new</span> File(<span class="string">"学习.txt"</span>,<span class="number">100</span>);</span><br><span class="line">        life.add(eat);</span><br><span class="line">        life.add(sleep);</span><br><span class="line">        life.add(study);</span><br><span class="line"></span><br><span class="line">        Directory work=<span class="keyword">new</span> Directory(<span class="string">"我的工作"</span>);</span><br><span class="line">        File write=<span class="keyword">new</span> File(<span class="string">"写博客.doc"</span>,<span class="number">200</span>);</span><br><span class="line">        File paper=<span class="keyword">new</span> File(<span class="string">"写论文.html"</span>,<span class="number">200</span>);</span><br><span class="line">        File homework=<span class="keyword">new</span> File(<span class="string">"写家庭作业.docx"</span>,<span class="number">200</span>);</span><br><span class="line">        work.add(write);</span><br><span class="line">        work.add(paper);</span><br><span class="line">        work.add(homework);</span><br><span class="line"></span><br><span class="line">        Directory relax=<span class="keyword">new</span> Directory(<span class="string">"我的休闲"</span>);</span><br><span class="line">        File music=<span class="keyword">new</span> File(<span class="string">"听听音乐.js"</span>,<span class="number">200</span>);</span><br><span class="line">        File walk=<span class="keyword">new</span> File(<span class="string">"出去转转.psd"</span>,<span class="number">200</span>);</span><br><span class="line">        relax.add(music);</span><br><span class="line">        relax.add(walk);</span><br><span class="line"></span><br><span class="line">        Directory read=<span class="keyword">new</span> Directory(<span class="string">"我的阅读"</span>);</span><br><span class="line">        File book=<span class="keyword">new</span> File(<span class="string">"学习书籍.psd"</span>,<span class="number">200</span>);</span><br><span class="line">        File novel=<span class="keyword">new</span> File(<span class="string">"娱乐小说.txt"</span>,<span class="number">200</span>);</span><br><span class="line">        read.add(book);</span><br><span class="line">        read.add(novel);</span><br><span class="line"></span><br><span class="line">        root.add(life);</span><br><span class="line">        root.add(work);</span><br><span class="line">        root.add(relax);</span><br><span class="line">        root.add(read);</span><br><span class="line"></span><br><span class="line">        root.accept(<span class="keyword">new</span> ListVisitor());</span><br><span class="line">        System.out.println(<span class="string">"========================"</span>);</span><br><span class="line">        FileVisitor visitor=<span class="keyword">new</span> FileVisitor(<span class="string">".psd"</span>);</span><br><span class="line">        root.accept(visitor);</span><br><span class="line">        Iterator it = visitor.getFiles();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">            System.out.println(it.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>运行结果</p></blockquote><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/java/design/j2/20200522183310.png!www.zeze.info" alt="运行结果"></p><p>可以看到我们的运行结果第一个和使用Composite模式的结果一样，第二个是实现另一种方式的访问，只访问文件后缀为某一特定的内容的文件，结果也是正确的，并且为了说明我们的访问还可以保存下来访问的结果，我们使用了ArrayList自带的迭代器将保存到ArrayList中的结果输出出来，我们当然也可以直接在遍历的时候就输出出来，这个看我们的使用要求了。由此可以看到在保证数据结构（File和Directory）不发生变化的情况下（没有新增或者删除），可以非常方便增加新的一种访问方法，只需要新增加一个访问类即可，但是如果我们数据结构发生变化之后，就需要修改继承自Visitor类的所有类了，这也违背了开闭原则，因此我们应该认真考虑，到底我们的数据结构是定死的还是经常变化的。没有任何一种设计模式是十全十美的，总是有所取舍，有所利弊，根据实际情况来选择才是最好的设计方法。</p><p>这里要说明一下<strong>双重分发</strong>机制，我们来看一下最核心的遍历逻辑，结合组合模式的时候我们已经分析过的遍历方法，递归，大家觉得这次我们要怎么在数据结构外面进行遍历，肯定还是要使用递归了，可是数据结构中的数据在类的内部，怎么递归到内部呢，我们想到了间接递归，也就是双重分发。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printList</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        System.out.println(prefix+<span class="string">"/"</span>+<span class="keyword">this</span>);</span><br><span class="line">        Iterator it=entrys.iterator();</span><br><span class="line">        Entry entry;</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">            entry=(Entry)it.next();</span><br><span class="line">            entry.printList(prefix+<span class="string">"/"</span>+name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>上面的代码是在组合模式类的内部遍历的过程，可以明确的看到递归（直接递归）的使用。我们看一下访问者模式中的间接递归：</p><p><strong>Directory类中：</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//System.out.println("开始访问文件夹:"+this);</span></span><br><span class="line">        visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//System.out.println("结束访问文件夹:"+this);</span></span><br><span class="line">        <span class="comment">//System.out.println();</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>在ListVisitor中：</strong></p><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(<span class="built_in">File</span> file)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(currentDir+<span class="string">"/"</span>+file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Directory directory)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(currentDir+<span class="string">"/"</span>+directory);</span><br><span class="line">        <span class="keyword">String</span> saveDir=currentDir;</span><br><span class="line">        currentDir+=(<span class="string">"/"</span>+directory.getName());</span><br><span class="line">        Iterator it=directory.iterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">            Entry entry=(Entry)it.next();</span><br><span class="line">            entry.accept(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        currentDir=saveDir;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>我们看到了<code>entry.accept(this)</code>这句话，这句话是非常重要的，我们在Client中是这样用的：</p><blockquote><p>root.accept(new ListVisitor());</p></blockquote><p>在accept函数中调用visit，同样在visit中调用accept，这就是间接递归，或者叫做双重分发。产生的原因就是访问者需要和被访问者相互交流，才能一步步的得到想要的数据。我们可以考虑主持人采访一个明星，那么这个明星接受采访，把自己基本信息（能问的问题以及某些答案）告诉主持人，问主持人有问题吗？如果主持人有问题（还能向下问）要问那么就再次拿着新的问题问这个明星，这个明星再次将自己关于这方面的信息告诉主持人；如果没有问题（得到答案），主持人将信息总结之后说出来。就这样一直持续下去，直到主持人没问题问了，并且明星的信息也都被问到了，这样采访就结束了。由此可见，很多时候设计模式都是和生活密切相关的，生活中的常识有时候就是一些套路，而这种套路就是一种抽象的模式。</p><h1 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h1><ol><li><p>优点</p><p>符合单一职责原则<br>元素类可以通过接受不同的访问者来实现对不同操作的扩展。</p></li><li><p>缺点</p><p>具体元素对访问者公布细节，违背了迪米特法则。<br>违背了依赖倒置原则，访问者依赖的是具体元素，而不是抽象元素。</p></li></ol><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>  访问者模式是一个非常有意思的模式，因为自己需要得到数据就需要向被访者索取，如果能够一次索取成功，访问就结束了，如果还需要其他信息，则再次向被访问者索取，就这样知道拿到自己需要的所有数据。在本例中借用了组合模式中的数据结构，那是因为这种树形的结构很适合我们进行递归访问。访问者模式和迭代器模式都是在某种数据结构上进行处理，一种是对数据结构中的元素进行某种特定的处理，另一种是用某种方式遍历所有元素。在实际应用中，我们根据实际需要来考虑是不是需要双重分发机制。在本例中的访问者模式中用到了组合模式、委托（组合）、双重分发等原理，便于新增访问方式，不便于对数据结构的修改。</p><p><a href="https://github.com/zhangzeli/design_patterns/tree/master/src/main/java/com/visitor/t1" target="_blank" rel="external nofollow noopener noreferrer">代码地址</a></p><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">设计模式 访问者模式</summary>
    
    
    
    <category term="设计模式" scheme="http://www.zeze.info/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="java" scheme="http://www.zeze.info/categories/java/"/>
    
    
    <category term="设计模式" scheme="http://www.zeze.info/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>适配器模式一篇就够了</title>
    <link href="http://www.zeze.info/java/design/j1/"/>
    <id>http://www.zeze.info/java/design/j1/</id>
    <published>2020-05-22T14:51:20.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>很常用的结构型设计模式，用做两个不兼容的接口之间的桥梁，结合了两个独立接口的功能。</p><h1 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h1><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><div class="note default"> 中国标准电压是 220V，电器也是支持 220V的，代码实现使用电器的逻辑。</div><blockquote><p>创建电器类</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChinaDevice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用电器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> voltage 输入电压</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">use</span><span class="params">(<span class="keyword">int</span> voltage)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"输入电压"</span> + voltage + <span class="string">"V"</span>);</span><br><span class="line">        <span class="keyword">if</span> (voltage == <span class="number">220</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"中国电器正常运行"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"中国电器烧毁"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>创建电源类</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChinaPower</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ChinaDevice device)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 使用220V电压运行</span></span><br><span class="line">        device.use(<span class="number">220</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>使用电器：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeviceUnitTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建220V电源</span></span><br><span class="line">        ChinaPower chinaPower = <span class="keyword">new</span> ChinaPower();</span><br><span class="line">        <span class="comment">// 创建电器</span></span><br><span class="line">        ChinaDevice device = <span class="keyword">new</span> ChinaDevice();</span><br><span class="line">        <span class="comment">// 运行电器</span></span><br><span class="line">        chinaPower.run(device);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>开发完成，电器正常运行起来了。</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">输入电压220V</span><br><span class="line">中国电器正常运行</span><br></pre></td></tr></table></figure><h3 id="拓展需求"><a href="#拓展需求" class="headerlink" title="拓展需求"></a>拓展需求</h3><div class="note default"> 产品经理拿来一个美国电器，仅支持 110V 电压，要求也要正常运行。</div><blockquote><p>考虑到每个国家电器标准都不一样，需求必然会经常变更，这次我们抽离出一个接口：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Device</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用电器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> voltage 输入电压</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">use</span><span class="params">(<span class="keyword">int</span> voltage)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>创建美国电器类：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">USADevice</span> <span class="keyword">implements</span> <span class="title">Device</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">use</span><span class="params">(<span class="keyword">int</span> voltage)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"输入电压"</span> + voltage + <span class="string">"V"</span>);</span><br><span class="line">        <span class="keyword">if</span> (voltage == <span class="number">110</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"美国电器正常运行"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"美国电器烧毁"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>美国电器使用 220V 必然烧毁，那么应该如何解决呢？</p></blockquote><blockquote><p>很简单，创建一个美国电源类就可以了：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">USAPower</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Device device)</span> </span>&#123;</span><br><span class="line">        device.use(<span class="number">110</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note default"> 这种方式当然没有问题，但是随着国家的增多，电源类也会越来越多。从实际生活的角度看，我们也不可能拥有多个电压的电源，只能借助变压器（适配器）来解决该问题。</div><h3 id="引入适配器模式"><a href="#引入适配器模式" class="headerlink" title="引入适配器模式"></a>引入适配器模式</h3><blockquote><p>创建一个 220V 的适配器：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChinaAdapter</span> <span class="keyword">implements</span> <span class="title">Device</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> USADevice mUsaDevice;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认中国电器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChinaAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 适配美国电器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChinaAdapter</span><span class="params">(USADevice usaDevice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mUsaDevice = usaDevice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">use</span><span class="params">(<span class="keyword">int</span> voltage)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"输入电压"</span> + voltage + <span class="string">"V"</span>);</span><br><span class="line">        <span class="keyword">if</span> (mUsaDevice != <span class="keyword">null</span>) &#123;<span class="comment">// 适配美国电器</span></span><br><span class="line">            <span class="keyword">if</span> (voltage == <span class="number">110</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"美国电器正常运行"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"适配器工作...进行变压"</span>);</span><br><span class="line">                voltage = <span class="number">110</span>;</span><br><span class="line">                System.out.println(<span class="string">"美国电器在"</span> + voltage + <span class="string">"V正常运行"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">// 默认中国电器</span></span><br><span class="line">            <span class="keyword">if</span> (voltage == <span class="number">220</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"中国电器正常运行"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"中国电器烧毁"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>仔细对比<code>ChinaAdapter</code>和<code>ChinaDevice</code>，可以发现，这个适配器只是扩展了<code>ChinaDevice</code>，使其支持<code>USADevice</code>美国电器，本质上还是中国电器</p><p>[x] 无参构造 创建的是中国电器，在 use 方法中，仅支持 220V。<br>[x] 带参构造 创建的是美国电器，在 use 方法中，将 220V 转为 110V。</p><p>使用适配器：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeviceUnitTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建220V电源</span></span><br><span class="line">        ChinaPower chinaPower = <span class="keyword">new</span> ChinaPower();</span><br><span class="line">        <span class="comment">// 适配器</span></span><br><span class="line">        Device device = <span class="keyword">new</span> ChinaAdapter(<span class="keyword">new</span> USADevice());</span><br><span class="line">        chinaPower.run(device);</span><br><span class="line">        <span class="comment">// 默认构造，就是支持220V的中国电器</span></span><br><span class="line">        device = <span class="keyword">new</span> ChinaAdapter();</span><br><span class="line">        chinaPower.run(device);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><blockquote><p>在这种模式下，电源不需要知道是哪种电器，只要提供 220V 电压即可，具体操作的什么类，由适配器决定。</p></blockquote><p>适配器模式具有以下优势：</p><ol><li>可以让任何两个没有关联的类一起运行。</li><li>提高了类的复用。</li><li>灵活性好。</li></ol><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>[x] 意图：将一个类的接口转换成另外一个接口。适配器模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。<br>[x] 主要解决：常常要将一些”现存的对象”放到新的环境中，而新环境要求的接口是现对象不能满足的。<br>[x] 如何解决：继承类或实现接口（推荐）。<br>[x] 关键代码：适配器继承已有的对象，实现想要的目标接口。<br>[x] 缺点：过多地使用适配器，会使代码非常凌乱。比如，明明看到调用的是 A 接口，其实内部被适配成了 B 接口的实现，如果太多出现这种情况，无异于一场灾难。因此如果不是很有必要，可以不使用适配器，而是直接进行重构。<br>[x] 注意事项：适配器不是在详细设计时添加的，而是解决正在服役的项目的问题。</p><h1 id="博主主页"><a href="#博主主页" class="headerlink" title="博主主页"></a><strong><a href="http://www.zeze.info">博主主页</a></strong></h1><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">适配器模式</summary>
    
    
    
    <category term="设计模式" scheme="http://www.zeze.info/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="java" scheme="http://www.zeze.info/categories/java/"/>
    
    
    <category term="设计模式" scheme="http://www.zeze.info/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ES6-判断Js数据类型</title>
    <link href="http://www.zeze.info/javaScript/cacl/cacl3/"/>
    <id>http://www.zeze.info/javaScript/cacl/cacl3/</id>
    <published>2020-05-13T15:18:51.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Typeof的返回值"><a href="#Typeof的返回值" class="headerlink" title="Typeof的返回值"></a>Typeof的返回值</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="number">1</span>           ---&gt; <span class="string">'number'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">'hello'</span>     ---&gt; <span class="string">'string'</span></span><br><span class="line"><span class="keyword">typeof</span> alert       ---&gt; <span class="string">'function'</span></span><br><span class="line"><span class="keyword">typeof</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]     ---&gt; <span class="string">'object'</span></span><br><span class="line"><span class="keyword">typeof</span> &#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">2</span>&#125;   ---&gt; <span class="string">'object'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>        ---&gt; <span class="string">'object'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">NaN</span>         ---&gt; <span class="string">'number'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span>   ---&gt; <span class="string">'undefined'</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">Symbol</span>()    ---&gt; <span class="string">'symbol'</span></span><br></pre></td></tr></table></figure><blockquote><p>疑惑：typeof null返回’object’，typeof NaN竟然返回’number’（NaN有专门的方法检测—isNaN,那么我们可不可以有专门的方式检测null呢？比如isNull来判断null类型），NaN本意为Not A Number,这就无法理解。查了一下，这是好多年的坑了。</p></blockquote><h1 id="利用Object-prototype-toString"><a href="#利用Object-prototype-toString" class="headerlink" title="利用Object.prototype.toString"></a>利用Object.prototype.toString</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="string">"hello"</span>));<span class="comment">//[object String]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="number">123</span>));<span class="comment">//[object Number]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="literal">true</span>));<span class="comment">//[object Boolean]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="literal">undefined</span>));<span class="comment">//[object Undefined]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="literal">null</span>));<span class="comment">//[object Null]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(&#123;<span class="attr">name</span>: <span class="string">"jerry"</span>&#125;));<span class="comment">//[object Object]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;));<span class="comment">//[object Function]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call([]));<span class="comment">//[object Array]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="keyword">new</span> <span class="built_in">Date</span>));<span class="comment">//[object Date]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="regexp">/\d/</span>));<span class="comment">//[object RegExp]</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.call(<span class="keyword">new</span> foo()));<span class="comment">//[object Object]</span></span><br></pre></td></tr></table></figure><blockquote><p>问题解决了，但是返回值带[]看着太难受了。</p></blockquote><h1 id="自定义方式"><a href="#自定义方式" class="headerlink" title="自定义方式"></a>自定义方式</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//es5方式，返回布尔值</span></span><br><span class="line"><span class="keyword">const</span> isType = <span class="function"><span class="keyword">function</span>(<span class="params">type</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">`[object <span class="subst">$&#123;type&#125;</span>]`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//es6方式，返回布尔值</span></span><br><span class="line"><span class="keyword">const</span> isType1 = <span class="function"><span class="params">type</span> =&gt;</span> <span class="function"><span class="params">obj</span> =&gt;</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">`[object <span class="subst">$&#123;type&#125;</span>]`</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 正则匹配，返回真正的类型值</span></span><br><span class="line"><span class="keyword">const</span> isType2 = <span class="function"><span class="params">type</span> =&gt;</span>(<span class="regexp">/^\[object\s(.*)\]$/</span>.exec(<span class="built_in">Object</span>.prototype.toString.call(type)))[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用，先定义要检测的类型,传入Object.prototype.toString.call返回的值，如：Array，Number...</span></span><br><span class="line"><span class="keyword">const</span> isArray = isType(<span class="string">'Array'</span>);<span class="comment">// 注意首字母大写</span></span><br><span class="line"><span class="keyword">const</span> isSymbol = isType1(<span class="string">'Symbol'</span>);</span><br><span class="line">isArray([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) ;<span class="comment">// true</span></span><br><span class="line">isSymbol(<span class="built_in">Symbol</span>()); <span class="comment">// true</span></span><br><span class="line">isType2(<span class="literal">null</span>); <span class="comment">// 'Null'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************包装一下**************************/</span></span><br><span class="line"><span class="keyword">const</span> isType = <span class="function"><span class="keyword">function</span>(<span class="params">type</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj).includes(type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> types = [<span class="string">'String'</span>,<span class="string">'Object'</span>,<span class="string">'Array'</span>,<span class="string">'Null'</span>,<span class="string">'Undefined'</span>,<span class="string">'Boolean'</span>]</span><br><span class="line"><span class="keyword">let</span> fns = &#123;&#125;;</span><br><span class="line">types.forEach(<span class="function"><span class="params">type</span> =&gt;</span>&#123;</span><br><span class="line">    fns[<span class="string">'is'</span>+type] = isType(type)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">console</span>.info(fns.isString(a))<span class="comment">//函数柯里化</span></span><br></pre></td></tr></table></figure><p><strong><a href="http://www.zeze.info">博主主页</a></strong></p><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">ES6,判断js数据类型</summary>
    
    
    
    <category term="前端" scheme="http://www.zeze.info/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="js" scheme="http://www.zeze.info/categories/js/"/>
    
    
    <category term="JavaScript" scheme="http://www.zeze.info/tags/JavaScript/"/>
    
    <category term="es6" scheme="http://www.zeze.info/tags/es6/"/>
    
  </entry>
  
  <entry>
    <title>都说ThreadLocal被面试官问烂了，可为什么面试官还是喜欢继续问</title>
    <link href="http://www.zeze.info/java/concurrent/threadLocal/"/>
    <id>http://www.zeze.info/java/concurrent/threadLocal/</id>
    <published>2020-03-29T08:57:54.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>原创 泽泽</p><p><strong>面试官：</strong> 有如下场景：在多线程并发情况下，有一个共享变量，不同线程设置不同值后，各线程只想获取自己设置的值，如何实现？</p><p><strong>小小白：</strong> 使用ThreadLocal，通过ThreadLocal实例对象的set方法设置各线程自己的值，通过ThreadLocal实例对象的get方法获取各线程自己设置的值。</p><p><strong>面试官：</strong> 写一下简单的实现代码？</p><p><strong>小小白：</strong> 噼里啪啦写了如下代码。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> ThreadLocal threadLocal = <span class="keyword">new</span> ThreadLocal();</span><br><span class="line">    threadLocal.set(<span class="string">"hello"</span>);</span><br><span class="line">    System.out.println(<span class="string">"main thread:"</span> + threadLocal.get());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            threadLocal.set(<span class="string">"world"</span>);</span><br><span class="line">            System.out.println(<span class="string">"new Thread1:"</span> + threadLocal.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            threadLocal.set(<span class="string">"!!!"</span>);</span><br><span class="line">            System.out.println(<span class="string">"new Thread2:"</span> + threadLocal.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>面试官：</strong> ThreadLocal源码有看过吗？</p><p><strong>小小白：</strong> 看过。</p><p><strong>面试官：</strong> 那说一下ThreadLocal的实现原理？</p><p><strong>小小白：</strong> 从ThreadLocal的set方法的源码开始：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="keyword">null</span>)&#123;</span><br><span class="line">        map.set(<span class="keyword">this</span>, value);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        createMap(t, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>set方法的第一步是获取当前线程实例，然后通过getMap方法获取当前线程实例的<code>threadLocals</code>属性，<code>threadLocals</code>是<code>ThreadLocalMap</code>类型的变量，而<code>ThreadLocalMap</code>则是一个定制化的<code>HashMap</code>。</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ThreadLocal类中的getMap方法</span></span><br><span class="line"></span><br><span class="line"><span class="function">ThreadLocalMap <span class="title">getMap</span><span class="params">(Thread t)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> t.threadLocals;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Thread类中声明的threadLocals变量</span></span><br><span class="line">ThreadLocal.ThreadLocalMap threadLocals = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><blockquote><p>如果getMap方法获取的ThreadLocalMap类型变量map不等于null，则以当前ThreadLocal实例对象为key，传入的value值为value存到这个ThreadLocalMap中，需要注意的是在实际存储的时候，key使用的是ThreadLocal的弱引用。</p></blockquote><blockquote><p>如果getMap方法获取的ThreadLocalMap类型变量map等于null，则调用createMap方法创建一个ThreadLocalMap实例对象，并以当前ThreadLocal实例对象为key，传入的value值为value存到这个ThreadLocalMap中。</p></blockquote><blockquote><p>看到这里就会明白，使用ThreadLocal时，每个线程维护一个ThreadLocalMap映射表，映射表的key是ThreadLocal实例，并且使用的是ThreadLocal的弱引用 ，value是具体需要存储的Object。</p></blockquote><blockquote><p>紧接着进入ThreadLocal类的get方法，这个方法的第一步也是获取当前线程，通过getMap方法获取当前线程所维护的ThreadLocalMap实例，如果ThreadLocalMap对象实例不等于null，则以当前ThreadLocal对象实例为key从ThreadLocalMap中获取所需要的值。</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</span><br><span class="line">        ThreadLocalMap.Entry e = map.getEntry(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> (T)e.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>如果getMap方法获取到的ThreadLocalMap对象实例等于null，则调用setInitialValue方法初始化一个ThreadLocalMap，并以当前ThreadLocal实例对象为key，null值为value存到这个ThreadLocalMap中，同时返回null。</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> T <span class="title">setInitialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    T value = initialValue();</span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="keyword">null</span>)&#123;</span><br><span class="line">        map.set(<span class="keyword">this</span>, value);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        createMap(t, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> T <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ThreadLocalMap <span class="title">getMap</span><span class="params">(Thread t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createMap</span><span class="params">(Thread t, T firstValue)</span> </span>&#123;</span><br><span class="line">    t.threadLocals = <span class="keyword">new</span> ThreadLocalMap(<span class="keyword">this</span>, firstValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>面试官：</em>看来这部分很熟悉，那为什么Thread类中声明的threadLocals变量是map结构的？</p><p><em>小小白：</em>因为每个线程都可以关联很多个ThreadLocal变量。</p><p><em>面试官：</em>你知道ThreadLocal使用不当会发生内存泄露吗？</p><p><em>小小白：</em>知道。每一个Thread维护一个ThreadLocalMap映射表，映射表的key是ThreadLocal实例，并且使用的是ThreadLocal的弱引用 ，value是具体需要存储的Object。下面用一张图展示这些对象之间的引用关系，实心箭头表示强引用，空心箭头表示弱引用。</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/java/threadlocal/20200329091959.png!www.zeze.info" alt="threadlocal"></p><blockquote><p>从上图可以看出，如果ThreadLocal没有外部强引用，当发生垃圾回收时，这个ThreadLocal一定会被回收(弱引用的特点是不管当前内存空间足够与否，GC时都会被回收)，这样就会导致ThreadLocalMap中出现key为null的Entry，外部将不能获取这些key为null的Entry的value，并且如果当前线程一直存活，那么就会存在一条强引用链：Thread Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; value，导致value对应的Object一直无法被回收，产生内存泄露。查看源码会发现，ThreadLocal的get、set和remove方法都实现了对所有key为null的value的清除，但仍可能会发生内存泄露，因为可能使用了ThreadLocal的get或set方法后发生GC，此后不调用get、set或remove方法，为null的value就不会被清除。</p></blockquote><p>面试官：这个问题如何解决？</p><p><strong>小小白：</strong> 解决办法是每次使用完ThreadLocal都调用它的remove()方法清除数据，或者按照JDK建议将ThreadLocal变量定义成private static，这样就一直存在ThreadLocal的强引用，也就能保证任何时候都能通过ThreadLocal的弱引用访问到Entry的value值，进而清除掉。</p><p><strong>面试官：</strong> 就你最开始写的代码，现在又有新需求，想在子线程中获取主线程threadLocal中set方法设置的值，如何实现？</p><p><strong>小小白：</strong> 使用InheritableThreadLocal，ThreadLocal threadLocal = new InheritableThreadLocal()，这样在子线程中就可以通过get方法获取到主线程set方法设置的值了。</p><p><strong>面试官：</strong> InheritableThreadLocal的实现原理是什么？</p><p><strong>小小白：</strong> InheritableThreadLocal继承了ThreadLocal，并且重写了childValue、getMap和createMap方法，当在主线程中创建InheritableThreadLocal实例对象后，通过new Thread()方式创建子线程时，进入如下代码。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Thread</span><span class="params">(Runnable target)</span> </span>&#123;</span><br><span class="line">    init(<span class="keyword">null</span>, target, <span class="string">"Thread-"</span> + nextThreadNum(), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ThreadGroup g, Runnable target, String name,<span class="keyword">long</span> stackSize)</span> </span>&#123;</span><br><span class="line">    init(g, target, name, stackSize, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ThreadGroup g, Runnable target, String name,<span class="keyword">long</span> stackSize, AccessControlContext acc)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"name cannot be null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.name = name.toCharArray();</span><br><span class="line">    Thread parent = currentThread();</span><br><span class="line">    SecurityManager security = System.getSecurityManager();</span><br><span class="line">    <span class="keyword">if</span> (g == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (security != <span class="keyword">null</span>) &#123;</span><br><span class="line">            g = security.getThreadGroup();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (g == <span class="keyword">null</span>) &#123;</span><br><span class="line">            g = parent.getThreadGroup();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    g.checkAccess();</span><br><span class="line">    <span class="keyword">if</span> (security != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isCCLOverridden(getClass())) &#123;</span><br><span class="line">        security.checkPermission(SUBCLASS_IMPLEMENTATION_PERMISSION);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    g.addUnstarted();</span><br><span class="line">    <span class="keyword">this</span>.group = g;</span><br><span class="line">    <span class="keyword">this</span>.daemon = parent.isDaemon();</span><br><span class="line">    <span class="keyword">this</span>.priority = parent.getPriority();</span><br><span class="line">    <span class="keyword">if</span> (security == <span class="keyword">null</span> || isCCLOverridden(parent.getClass()))</span><br><span class="line">        <span class="keyword">this</span>.contextClassLoader = parent.getContextClassLoader();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">this</span>.contextClassLoader = parent.contextClassLoader;</span><br><span class="line">        <span class="keyword">this</span>.inheritedAccessControlContext =</span><br><span class="line">        acc != <span class="keyword">null</span> ? acc : AccessController.getContext();</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">        setPriority(priority);</span><br><span class="line">        <span class="comment">// 如果父线程的inheritableThreadLocals不为null</span></span><br><span class="line">    <span class="keyword">if</span> (parent.inheritableThreadLocals != <span class="keyword">null</span>)</span><br><span class="line">    <span class="comment">// 通过createInheritedMap方法将父线程中inheritableThreadLocals的值复制到子线程的inheritableThreadLocals中</span></span><br><span class="line">    <span class="keyword">this</span>.inheritableThreadLocals =ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);</span><br><span class="line">    <span class="comment">/* Stash the specified stack size in case the VM cares */</span></span><br><span class="line">    <span class="keyword">this</span>.stackSize = stackSize;</span><br><span class="line">    <span class="comment">/* Set thread ID */</span></span><br><span class="line">    tid = nextThreadID();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>当使用InheritableThreadLocal创建实例对象时，当前线程Thread对象中维护了一个inheritableThreadLocals变量，它也是ThreadLocalMap类型，在创建子线程的过程中，将主线程维护的inheritableThreadLocals变量的值复制到子线程维护的inheritableThreadLocals变量中，这样子线程就可以获取到主线程设置的值了。</p></blockquote><p><strong><a href="http://www.zeze.info">博主主页</a></strong></p><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://www.zeze.info/categories/java/"/>
    
    
  </entry>
  
  <entry>
    <title>24个ES6方法</title>
    <link href="http://www.zeze.info/javaScript/work/js1/"/>
    <id>http://www.zeze.info/javaScript/work/js1/</id>
    <published>2020-03-04T15:25:00.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="介绍25种很实用的ES6方法，来解决实际开发中的问题"><a href="#介绍25种很实用的ES6方法，来解决实际开发中的问题" class="headerlink" title="介绍25种很实用的ES6方法，来解决实际开发中的问题"></a>介绍25种很实用的ES6方法，来解决实际开发中的问题</h1><p>原创 @泽泽vlog 昨天</p><p>主要是介绍25种ES6方法，这些方法都挺实用的，用本本记好要考的，嘿嘿嘿。时不时翻出来看看</p><h1 id="1-如何隐藏所有指定的元素"><a href="#1-如何隐藏所有指定的元素" class="headerlink" title="1. 如何隐藏所有指定的元素"></a>1. 如何隐藏所有指定的元素</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> hide = <span class="function">(<span class="params">el</span>)=&gt;</span></span><br><span class="line">  [...el].forEach(<span class="function"><span class="params">e</span>=&gt;</span>e.style.display = <span class="string">'none'</span>)</span><br><span class="line">hide(<span class="built_in">document</span>.querySelectorAll(<span class="string">'img'</span>))</span><br></pre></td></tr></table></figure><h1 id="2-如何检查元素是否具有指定的类"><a href="#2-如何检查元素是否具有指定的类" class="headerlink" title="2. 如何检查元素是否具有指定的类"></a>2. 如何检查元素是否具有指定的类</h1><p>在页面DOM里的每个节点上都有一个classList对象，程序员可以使用里面的方法新增、删除、修改节点上的CSS类。使用classList，程序员还可以用它来判断某个节点是否被赋予了某个CSS类</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> hasClass = <span class="function">(<span class="params">el,className</span>)=&gt;</span>el.classList.contains(className)</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">hasClass(<span class="built_in">document</span>.querySelector(<span class="string">'div.s_form_wrapper '</span>),<span class="string">'soutu-env-nomac'</span>)</span><br></pre></td></tr></table></figure><h1 id="3-如何切换一个元素的类"><a href="#3-如何切换一个元素的类" class="headerlink" title="3. 如何切换一个元素的类"></a>3. 如何切换一个元素的类</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> toggleClass =<span class="function">(<span class="params">el,className</span>)=&gt;</span>el.classList.toggle(className)</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例 移除div具有`s_form_wrapper`的类</span></span><br><span class="line">toggleClass( <span class="built_in">document</span>.querySelector(<span class="string">'div.s_form_wrapper '</span>),<span class="string">'s_form_wrapper'</span>)</span><br></pre></td></tr></table></figure><h1 id="4-如何获取当前页面的滚动位置"><a href="#4-如何获取当前页面的滚动位置" class="headerlink" title="4. 如何获取当前页面的滚动位置"></a>4. 如何获取当前页面的滚动位置</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getScrollPosition =<span class="function">(<span class="params">el=<span class="built_in">window</span></span>)=&gt;</span>(&#123;</span><br><span class="line">    x:el.pageXOffset !==<span class="literal">undefined</span> ? el.pageXOffset:el.scrollLeft,</span><br><span class="line">    y:el.pageYOffset !==<span class="literal">undefined</span> ? el.pageYOffset:el.scrollTop</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">getScrollPosition() <span class="comment">//&#123;x: 0, y: 600&#125;</span></span><br></pre></td></tr></table></figure><h1 id="5-如何平滑滚动到页面顶部"><a href="#5-如何平滑滚动到页面顶部" class="headerlink" title="5. 如何平滑滚动到页面顶部"></a>5. 如何平滑滚动到页面顶部</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> scrollToTop=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> c = <span class="built_in">document</span>.documentElement.scrollTop || <span class="built_in">document</span>.body.scrollTop</span><br><span class="line">    <span class="keyword">if</span>(c &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">window</span>.requestAnimationFrame(scrollToTop)</span><br><span class="line">        <span class="built_in">window</span>.scrollTo(<span class="number">0</span>,c-c/<span class="number">8</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">scrollToTop()</span><br></pre></td></tr></table></figure><p><code>requestAnimationFrame()</code>不需要设置时间间隔，是由系统的时间间隔定义的。大多数浏览器的刷新频率是60Hz(每秒钟反复绘制60次)，循环间隔是1000/60，约等于16.7ms。大多数浏览器会对反复挥着这个操作加以限制，不能超过60HZ，即使人为设置超过了该值，效果也不会改善。<code>requestAnimationFrame()</code>保证了最佳的绘制效率。<br>当页面被隐藏或者最小化时，<code>setInterval()</code>仍在后台继续执行，这种动画刷新是完全没有意义的，对cpu也是极大的浪费；<br>当页面被隐藏或者最小化时，<code>requestAnimationFramel()</code>中页面的渲染会被系统暂停，当页面再次激活后，继续从上次停止地方继续绘制；</p><h1 id="6-如何检查指定的元素在视口中是否可见"><a href="#6-如何检查指定的元素在视口中是否可见" class="headerlink" title="6. 如何检查指定的元素在视口中是否可见"></a>6. 如何检查指定的元素在视口中是否可见</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> elmentIsVisibleInViewport = <span class="function">(<span class="params">el,partiallyVisible=<span class="literal">false</span></span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;top,left,bottom,right &#125; = el.getBoundingClientRect();</span><br><span class="line">    <span class="keyword">const</span> &#123; innerHeight ,innerWidth &#125; = <span class="built_in">window</span>;</span><br><span class="line">    <span class="keyword">return</span> partiallyVisible</span><br><span class="line">    ?((top &gt; <span class="number">0</span> &amp;&amp; top &lt; innerHeight ) ||( bottom &gt; <span class="number">0</span> &amp;&amp; bottom &lt; innerHeight )) &amp;&amp;</span><br><span class="line">    ((left &gt; <span class="number">0</span> &amp;&amp; left &lt; innerWidth ) || (right &gt; <span class="number">0</span> &amp;&amp; right &lt; innerWidth ))</span><br><span class="line">    : top &gt;= <span class="number">0</span> &amp;&amp; left &gt;=<span class="number">0</span> &amp;&amp; bottom &lt;= innerHeight &amp;&amp; right &lt;= innerWidth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">elmentIsVisibleInViewport(el);<span class="comment">//需要左右可见</span></span><br><span class="line">elmentIsVisibleInViewport(el,<span class="literal">true</span>);<span class="comment">//需要全屏(上下左右)可见</span></span><br></pre></td></tr></table></figure><h1 id="7-如何检查父元素是否包含子元素"><a href="#7-如何检查父元素是否包含子元素" class="headerlink" title="7. 如何检查父元素是否包含子元素"></a>7. 如何检查父元素是否包含子元素</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> elementContains =<span class="function">(<span class="params">parent,child</span>)=&gt;</span>parent !== child &amp;&amp; parent.contains(child);</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">elementContains(<span class="built_in">document</span>.querySelector(<span class="string">'head'</span>),<span class="built_in">document</span>.querySelector(<span class="string">'title'</span>)</span><br><span class="line"><span class="comment">//true</span></span><br><span class="line">elementContains(<span class="built_in">document</span>.querySelector(<span class="string">'body'</span>),<span class="built_in">document</span>.querySelector(<span class="string">'body'</span>)</span><br><span class="line"><span class="comment">//false</span></span><br></pre></td></tr></table></figure><h1 id="8-如何获取元素中的所有图像？"><a href="#8-如何获取元素中的所有图像？" class="headerlink" title="8. 如何获取元素中的所有图像？"></a>8. 如何获取元素中的所有图像？</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getImages = <span class="function">(<span class="params">el,includeDuplicates = <span class="literal">false</span></span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> images = [...el.getElementByTagName(<span class="string">'img'</span>)].map(<span class="function"><span class="params">img</span> =&gt;</span> img.getAttribute(<span class="string">'src'</span>));</span><br><span class="line">    <span class="keyword">return</span> includeDuplicates?images:[...new <span class="built_in">Set</span>(images)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例  includeDuplicates 为 true 表示需要重复元素</span></span><br><span class="line">getImages(<span class="built_in">document</span>,<span class="literal">true</span>)</span><br><span class="line">getImages(<span class="built_in">document</span>,<span class="literal">false</span>)</span><br></pre></td></tr></table></figure><h1 id="9-如何确定设备是移动设备还是台式机-笔记本电脑"><a href="#9-如何确定设备是移动设备还是台式机-笔记本电脑" class="headerlink" title="9. 如何确定设备是移动设备还是台式机/笔记本电脑"></a>9. 如何确定设备是移动设备还是台式机/笔记本电脑</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> detectDeviceType = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/Android|webOS|iPhone|iPad|BlackBerry|IEMobile|Opera Mini/i</span></span><br><span class="line">    .test(navigator.userAgent)?<span class="string">'Mobile'</span>:<span class="string">'Desktop'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">detectDeviceType();</span><br></pre></td></tr></table></figure><h1 id="10-获取当前url"><a href="#10-获取当前url" class="headerlink" title="10. 获取当前url"></a>10. 获取当前url</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> currentURL =<span class="function"><span class="params">()</span> =&gt;</span>&#123;<span class="built_in">window</span>.location.href&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">currentURL();<span class="comment">//www.zeze.info</span></span><br></pre></td></tr></table></figure><h1 id="11-验证url的格式合法性"><a href="#11-验证url的格式合法性" class="headerlink" title="11. 验证url的格式合法性"></a>11. 验证url的格式合法性</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isURL=<span class="function">(<span class="params">str_url</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> reg = <span class="regexp">/(?:(https?|ftp|file):)?\/\/[-A-Za-z0-9+&amp;@#/%?=~_|!:,.;]+[-A-Za-z0-9+&amp;@#/%=~_|]/</span>;</span><br><span class="line">    <span class="keyword">let</span> re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(reg);</span><br><span class="line">    <span class="keyword">return</span> re.test(str_url);</span><br><span class="line">&#125;</span><br><span class="line">isURL(<span class="string">'http://www.zeze.info'</span>)</span><br></pre></td></tr></table></figure><h1 id="12-如何创建一个包含当前URL参数的对象"><a href="#12-如何创建一个包含当前URL参数的对象" class="headerlink" title="12. 如何创建一个包含当前URL参数的对象"></a>12. 如何创建一个包含当前URL参数的对象</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getURLParameters = <span class="function"><span class="params">url</span> =&gt;</span>(url.match(<span class="regexp">/([^?=&amp;]+)(=([^&amp;]*))/g</span>) || []).reduce(</span><br><span class="line">    (accumulator,currentValue) =&gt; ((accumulator[currentValue.slice(<span class="number">0</span>,v.indexOf(<span class="string">'='</span>))] = currentValue.slice(currentValue.indexOf(<span class="string">'='</span>)+<span class="number">1</span>)),accumulator)</span><br><span class="line">    ,&#123;&#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">getURLParameters(<span class="string">'http://www.zeze.info/index?a=1&amp;b=2'</span>) <span class="comment">//&#123;a:1,b:2&#125;</span></span><br><span class="line">getURLParameters(<span class="string">'http://www.zeze.info'</span>) <span class="comment">//&#123;&#125;</span></span><br></pre></td></tr></table></figure><h1 id="13-如何将一组表单元素转化为对象"><a href="#13-如何将一组表单元素转化为对象" class="headerlink" title="13. 如何将一组表单元素转化为对象"></a>13. 如何将一组表单元素转化为对象</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> formToObject = <span class="function"><span class="params">form</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">Array</span>.from(<span class="keyword">new</span> FormData(form)).reduce(</span><br><span class="line">        (acc,[key,value])=&gt;(&#123;</span><br><span class="line">            ...acc,</span><br><span class="line">            [key]:value</span><br><span class="line">        &#125;),</span><br><span class="line">        &#123;&#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">formToObject(<span class="built_in">document</span>.querySelector(<span class="string">'#from'</span>))</span><br><span class="line"><span class="comment">//&#123;email:'test@email.com',name:'www.zeze.info'&#125;</span></span><br></pre></td></tr></table></figure><h1 id="14-如何从对象检索给定选择器指示的一组属性"><a href="#14-如何从对象检索给定选择器指示的一组属性" class="headerlink" title="14. 如何从对象检索给定选择器指示的一组属性"></a>14. 如何从对象检索给定选择器指示的一组属性</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> =(from,...selectos)=&gt;</span><br><span class="line">    [...selectos].map(s=&gt;</span><br><span class="line">        s</span><br><span class="line">        .replace(/\[([^\[\]]*)\]/g,'.$1.')</span><br><span class="line">        .split('.')</span><br><span class="line">        .filter(t=&gt; t !=='')</span><br><span class="line">        .reduce((prev,cur)=&gt;prev &amp;&amp; prev[cur],from)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">const obj = &#123; selector:&#123;<span class="attr">to</span>:&#123;<span class="attr">val</span>:<span class="string">'val to select'</span> &#125; &#125;, <span class="attr">target</span>:[<span class="number">1</span>,<span class="number">2</span>,&#123;<span class="attr">a</span>:<span class="string">'test'</span>&#125;] &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line"><span class="keyword">get</span>(obj,'selector.to.val','target[0]','target[2].a')</span><br><span class="line">// ["val to select", 1, "test"]</span><br></pre></td></tr></table></figure><h1 id="15-如何在等待指定时间后调用提供的函数"><a href="#15-如何在等待指定时间后调用提供的函数" class="headerlink" title="15. 如何在等待指定时间后调用提供的函数"></a>15. 如何在等待指定时间后调用提供的函数</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> delay =<span class="function">(<span class="params">fn,wait,...args</span>)=&gt;</span>setTimeout(fn,wait,...args)</span><br><span class="line"></span><br><span class="line">delay(</span><br><span class="line">    (test)=&gt;<span class="built_in">console</span>.info(test),</span><br><span class="line">    <span class="number">1000</span>,</span><br><span class="line">    <span class="string">'later'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="16-如何在给定元素上触发特定事件且能选择地传递自定义数据"><a href="#16-如何在给定元素上触发特定事件且能选择地传递自定义数据" class="headerlink" title="16. 如何在给定元素上触发特定事件且能选择地传递自定义数据"></a>16. 如何在给定元素上触发特定事件且能选择地传递自定义数据</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 创建一个事件对象，名字为newEvent，类型为build */</span></span><br><span class="line"><span class="keyword">var</span> newEvent = <span class="keyword">new</span> Event(<span class="string">'build'</span>, &#123; <span class="attr">bubbles</span>:<span class="literal">true</span>,<span class="attr">cancelable</span>:<span class="literal">true</span>,<span class="attr">composed</span>:<span class="literal">true</span> &#125;);</span><br><span class="line">    </span><br><span class="line"><span class="comment">/* 给这个事件对象创建一个属性并赋值 */</span></span><br><span class="line">newEvent.name = <span class="string">"新的事件！"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 将自定义事件绑定在document对象上，这里绑定的事件要和我们创建的事件类型相同，不然无法触发 */</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"build"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">"你触发了自定义事件！"</span> + newEvent.name);</span><br><span class="line">&#125;,<span class="literal">false</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">/* 触发自定义事件 */</span></span><br><span class="line"><span class="built_in">document</span>.dispatchEvent(newEvent);</span><br></pre></td></tr></table></figure><p>启动文档的时候因为”document.dispatchEvent(newEvent)”的关系，会先触发一次事件：</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/js/25ES6/1.png!www.zeze.info" alt="事件对象"></p><p>之后你每执行一次”document.dispatchEvent(newEvent)”都会触发这个事件：</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/js/25ES6/1.gif!www.zeze.info" alt="事件对象"></p><p>接下来我们看看Event()这个方法的语法</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">event = <span class="keyword">new</span> Event(typeArg, eventInit);</span><br></pre></td></tr></table></figure><p>typeArg：指定事件类型，传递一个字符串。这里的事件类型指的是像点击事件（click）、提交事件（submit）、加载事件（load）等等。<br>eventInit：可选，传递EventInit类型的字典。实际上这个EventInit类型的字典也就是我们使用InitEvent()时需要传递的参数，以键值对的形式传递，不过它可以多选一个参数：<br>bubbles：事件是否支持冒泡，传递一个boolean类型的参数，默认值为false。<br>cancelable：是否可取消事件的默认行为，传递一个boolean类型的参数，默认值为false。<br>composed：事件是否会触发shadow DOM（阴影DOM）根节点之外的事件监听器，传递一个boolean类型的参数，默认值为false。（关于shadow DOM可以去看<a href="https://www.cnblogs.com/coco1s/p/5711795.html" target="_blank" rel="external nofollow noopener noreferrer">ChokCoco前辈的这篇文章</a>，这里就不详说了，可能我会根据自己的理解也写一个关于shadow DOM的笔记）这个参数是InitEvent()中没有的新参数。</p><p>我们先通过下面的例子了解一下如何使用CustomEvent()去创建一个事件对象（这里先不使用事件相关值detail）;</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/* 创建一个事件对象，名字为newEvent，类型为build */</span></span><br><span class="line"><span class="keyword">var</span> newEvent = <span class="keyword">new</span> CustomEvent(<span class="string">'build'</span>, &#123; <span class="attr">bubbles</span>:<span class="literal">true</span>,<span class="attr">cancelable</span>:<span class="literal">true</span>,<span class="attr">composed</span>:<span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 给这个事件对象创建一个属性并赋值，这里绑定的事件要和我们创建的事件类型相同，不然无法触发 */</span></span><br><span class="line">newEvent.name = <span class="string">"新的事件！"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 将自定义事件绑定在document对象上 */</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"build"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">"你触发了使用CustomEvent创建的自定义事件！"</span> + newEvent.name);</span><br><span class="line">&#125;,<span class="literal">false</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">/* 触发自定义事件 */</span></span><br><span class="line"><span class="built_in">document</span>.dispatchEvent(newEvent);</span><br></pre></td></tr></table></figure><div class="note default"> 然后我们来看CustomEvent()的语法：</div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">event = <span class="keyword">new</span> CustomEvent(typeArg, customEventInit);</span><br></pre></td></tr></table></figure>typeArg：指定事件类型，传递一个字符串。这里的事件类型指的是像点击事件（click）、提交事件（submit）、加载事件（load）等等。customEventInit：可选。传递一个CustomEventInit字典。实际上这个字典就是我们使用initCustomEvent()时需要的参数，这个参数就是事件相关值（detail）：detail：可选，默认值为null，类型为any（也就是说可以传递任意类型的参数）。这个值就是和事件相关联的值。在展示使用detail作为第二个参数的例子前，要先注意一件事：CustomEventInit字典也可以接受EventInit字典的参数，就像一开始的例子一样，我传递了EventInit字典的bubbles、cancelable、composed。<div class="note default"> 下面将展示使用detail参数的例子，使用到detail的部分我会加粗处理（为了看着方便，这回就不传递EventInit字典中的参数了）：</div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">/* 创建一个事件对象，名字为newEvent，类型为build */</span></span><br><span class="line"><span class="keyword">var</span> newEvent = <span class="keyword">new</span> CustomEvent(<span class="string">'build'</span>,&#123; </span><br><span class="line">    detail: &#123;</span><br><span class="line">        dog:<span class="string">"wo"</span>,<span class="attr">cat</span>:<span class="string">"mio"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 将自定义事件绑定在document对象上 */</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"build"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">" event.detail.dog:"</span> + event.detail.dog</span><br><span class="line">        + <span class="string">"\n event.detail.cat:"</span> + event.detail.cat );</span><br><span class="line">&#125;,<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 触发自定义事件 */</span></span><br><span class="line"><span class="built_in">document</span>.dispatchEvent(newEvent);</span><br></pre></td></tr></table></figure><h1 id="17-如何从元素中移除事件监听器"><a href="#17-如何从元素中移除事件监听器" class="headerlink" title="17. 如何从元素中移除事件监听器"></a>17. 如何从元素中移除事件监听器</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span>  off =</span><br><span class="line">    (el,evt,fn,opts=<span class="literal">false</span>) =&gt; el.removeEventListener(evt,fn,opts);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fn =<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'!'</span>)</span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>,fn)</span><br><span class="line">off(<span class="built_in">document</span>.body,<span class="string">'click'</span>,fn)</span><br></pre></td></tr></table></figure><h1 id="18-如何获得给定毫秒数的可读格式"><a href="#18-如何获得给定毫秒数的可读格式" class="headerlink" title="18. 如何获得给定毫秒数的可读格式"></a>18. 如何获得给定毫秒数的可读格式</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span>  formatDuration = <span class="function"><span class="params">ms</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ms&lt;<span class="number">0</span>) ms = -ms;</span><br><span class="line">    <span class="keyword">const</span> time =&#123;</span><br><span class="line">        day: <span class="built_in">Math</span>.floor(ms/<span class="number">86400000</span>),</span><br><span class="line">        hour:<span class="built_in">Math</span>.floor(ms/<span class="number">3600000</span>) % <span class="number">24</span>,</span><br><span class="line">        minute: <span class="built_in">Math</span>.floor(ms/<span class="number">60000</span>) % <span class="number">60</span>,</span><br><span class="line">        second: <span class="built_in">Math</span>.floor(ms/<span class="number">1000</span>) % <span class="number">60</span>,</span><br><span class="line">        millisecond: <span class="built_in">Math</span>.floor(ms) % <span class="number">1000</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.entries(time)</span><br><span class="line">    .filter(<span class="function"><span class="params">val</span> =&gt;</span> val[<span class="number">1</span>] !== <span class="number">0</span>)</span><br><span class="line">    .map(<span class="function">(<span class="params">[key,val]</span>)=&gt;</span><span class="string">`<span class="subst">$&#123;val&#125;</span> <span class="subst">$&#123;key&#125;</span><span class="subst">$&#123;val !== <span class="number">1</span> ? <span class="string">'s'</span>:<span class="string">''</span>&#125;</span>`</span>)</span><br><span class="line">    .join(<span class="string">','</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">formatDuration(<span class="number">1001</span>);</span><br><span class="line"><span class="comment">//"1 second,1 millisecond"</span></span><br><span class="line">formatDuration(<span class="number">3432505574</span>);</span><br><span class="line"><span class="comment">//"39 days,17 hours,28 minutes,25 seconds,574 milliseconds"</span></span><br></pre></td></tr></table></figure><h1 id="19-如何获得两个日期之间的差异（以天为单位）"><a href="#19-如何获得两个日期之间的差异（以天为单位）" class="headerlink" title="19. 如何获得两个日期之间的差异（以天为单位）"></a>19. 如何获得两个日期之间的差异（以天为单位）</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getDaysDiffBetweenDates = <span class="function">(<span class="params">dateInitial,dateFinal</span>)=&gt;</span></span><br><span class="line">    (dateFinal - dateInitial) / (<span class="number">1000</span> * <span class="number">3600</span> *<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">getDaysDiffBetweenDates(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-01'</span>),<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2020-03-03'</span>))</span><br></pre></td></tr></table></figure><h1 id="20-如何向传递的URL发出GET请求"><a href="#20-如何向传递的URL发出GET请求" class="headerlink" title="20. 如何向传递的URL发出GET请求"></a>20. 如何向传递的URL发出GET请求</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> httpGet = <span class="function">(<span class="params">url,callback,err = <span class="built_in">console</span>.error</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    request.open(<span class="string">'GET'</span>,url,<span class="literal">true</span>);</span><br><span class="line">    request.onload = <span class="function"><span class="params">()</span> =&gt;</span>callback(request.responseText);</span><br><span class="line">    request.onerror = <span class="function"><span class="params">()</span> =&gt;</span> err(request);</span><br><span class="line">    request.send();</span><br><span class="line">&#125;</span><br><span class="line">httpGet(</span><br><span class="line">    <span class="string">'https://jsonplaceholder.typicode.com/posts/1'</span>,</span><br><span class="line">    <span class="built_in">console</span>.log</span><br><span class="line">)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  "userId": 1,</span></span><br><span class="line"><span class="comment">  "id": 1,</span></span><br><span class="line"><span class="comment">  "title": "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",</span></span><br><span class="line"><span class="comment">  "body": "quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h1 id="21-如何对传递的URL发出POST请求"><a href="#21-如何对传递的URL发出POST请求" class="headerlink" title="21. 如何对传递的URL发出POST请求"></a>21. 如何对传递的URL发出POST请求</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> httpPost = <span class="function">(<span class="params">url,data,callback,err = <span class="built_in">console</span>.error</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    request.open(<span class="string">'POST'</span>,url,<span class="literal">true</span>);</span><br><span class="line">    request.setRequestHeader(<span class="string">'Content-type'</span>,<span class="string">'application/json; charset=utf-8'</span>);</span><br><span class="line">    request.onload = <span class="function"><span class="params">()</span> =&gt;</span>callback(request.responseText);</span><br><span class="line">    request.onerror = <span class="function"><span class="params">()</span> =&gt;</span> err(request);</span><br><span class="line">    request.send(data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> postData=&#123;</span><br><span class="line">    userId:<span class="number">1</span>,</span><br><span class="line">    title:<span class="string">'Foo'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> data =<span class="built_in">JSON</span>.stringify(postData)</span><br><span class="line">httpPost(</span><br><span class="line">    <span class="string">'https://jsonplaceholder.typicode.com/posts'</span>,</span><br><span class="line">    data,</span><br><span class="line">    <span class="built_in">console</span>.log</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="22-如何为指定选择器创建具有指定范围，步长和持续时间的计数器"><a href="#22-如何为指定选择器创建具有指定范围，步长和持续时间的计数器" class="headerlink" title="22. 如何为指定选择器创建具有指定范围，步长和持续时间的计数器"></a>22. 如何为指定选择器创建具有指定范围，步长和持续时间的计数器</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> counter = <span class="function">(<span class="params">selector,start,end,step=<span class="number">1</span>,duration</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> current = start;</span><br><span class="line">    _step = (end-start) * step &lt; <span class="number">0</span>?-step : step</span><br><span class="line">    timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        current += _step;</span><br><span class="line">        <span class="built_in">document</span>.querySelector(selector).innerHTML = current;</span><br><span class="line">        <span class="keyword">if</span> (current &gt;= end) &#123;</span><br><span class="line">            <span class="built_in">document</span>.querySelector(selector).innerHTML = end ;</span><br><span class="line">            clearInterval(timer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="built_in">Math</span>.abs(<span class="built_in">Math</span>.floor(duration/(end-start))));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line">counter(<span class="string">'#myId'</span>,<span class="number">1</span>,<span class="number">1000</span>,<span class="number">5</span>,<span class="number">20000</span>);</span><br></pre></td></tr></table></figure><h1 id="23-如何将字符串复制到剪贴板"><a href="#23-如何将字符串复制到剪贴板" class="headerlink" title="23. 如何将字符串复制到剪贴板"></a>23. 如何将字符串复制到剪贴板</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> copyToClipboard = <span class="function"><span class="params">str</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'textarea'</span>);</span><br><span class="line">    el.value = str;</span><br><span class="line">    el.setAttribute(<span class="string">'readonly'</span>,<span class="string">''</span>);</span><br><span class="line">    el.style.position=<span class="string">'absolute'</span>;</span><br><span class="line">    el.style.left = <span class="string">'-9999px'</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(el);</span><br><span class="line">    <span class="keyword">const</span> selected =<span class="built_in">document</span>.getSelection().rangeCount &gt;<span class="number">0</span>?<span class="built_in">document</span>.getSelection().getRangeAt(<span class="number">0</span>):<span class="literal">false</span>;</span><br><span class="line">    el.select();</span><br><span class="line">    <span class="built_in">document</span>.execCommand(<span class="string">'copy'</span>);</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(el)</span><br><span class="line">    <span class="keyword">if</span>(selected)&#123;</span><br><span class="line">        <span class="built_in">document</span>.getSelection().removeAllRanges();</span><br><span class="line">        <span class="built_in">document</span>.getSelection().addRange(selected);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">copyToClipboard(<span class="string">'www.zeze.info'</span>)</span><br></pre></td></tr></table></figure><h1 id="24-如何确定页面的浏览器选项卡是否聚焦"><a href="#24-如何确定页面的浏览器选项卡是否聚焦" class="headerlink" title="24. 如何确定页面的浏览器选项卡是否聚焦"></a>24. 如何确定页面的浏览器选项卡是否聚焦</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isBrowserTabFocused= <span class="function"><span class="params">()</span>=&gt;</span> !<span class="built_in">document</span>.hidden; </span><br><span class="line">isBrowserTabFocused();</span><br></pre></td></tr></table></figure><h1 id="25-如何创建目录（如果不存在）"><a href="#25-如何创建目录（如果不存在）" class="headerlink" title="25. 如何创建目录（如果不存在）"></a>25. 如何创建目录（如果不存在）</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs =<span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> createDirIfNotExists = <span class="function"><span class="params">dir</span> =&gt;</span>(!fs.existsSync(dir)?fs.mkdirSync(dir):<span class="literal">undefined</span>);</span><br><span class="line">createDirIfNotExists(<span class="string">'test'</span>);</span><br></pre></td></tr></table></figure><p>这里面的方法大都挺实用，可以解决很多开发过程问题，大家就好好利用起来吧。</p><p><strong><a href="http://www.zeze.info">博主主页</a></strong></p><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">很实用的24个ES6方法，用来解决实际开发的问提。</summary>
    
    
    
    <category term="javaScript" scheme="http://www.zeze.info/categories/javaScript/"/>
    
    <category term="es6" scheme="http://www.zeze.info/categories/es6/"/>
    
    
  </entry>
  
  <entry>
    <title>你本可以少写些 If-Else</title>
    <link href="http://www.zeze.info/javaScript/oop/if-else/"/>
    <id>http://www.zeze.info/javaScript/oop/if-else/</id>
    <published>2020-01-06T17:30:40.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote><p>在JavaScript开发中，条件判断语句的使用频率是极高的，而对于条件判断简单易读的if else应该都是大家的首选。可是代码写的久了，我们总是希望自己的代码看着能更为简洁规范（逼格更高），那么今天我们就由浅到深介绍几种实用小技巧，帮大家减少代码中的if else。说在开头，本文并未有消灭或歧视 if else的意思，if else的好用都知道，这里只是在某些特定场景为大家额外提供一种思路罢了，如何使用还请自行抉择，那么本文开始。</p></blockquote><h1 id="短路求值"><a href="#短路求值" class="headerlink" title="短路求值"></a>短路求值</h1><blockquote><p>在函数定义时，常有若函数调用未提供参数则使用默认值的情景，当然我们可以使用if else来解决这个问题：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!name)&#123;</span><br><span class="line">        name = <span class="string">'听风是风'</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">&#125;;</span><br><span class="line">fn();<span class="comment">//听风是风</span></span><br><span class="line">fn(<span class="string">'行星飞行'</span>);<span class="comment">//行星飞行</span></span><br></pre></td></tr></table></figure><blockquote><p>有没有更优雅的做法呢？当然，我们可以使用短路求值，像这样：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">function <span class="title">fn</span><span class="params">(name)</span> </span>&#123;</span><br><span class="line">    name = name || <span class="string">'听风是风'</span>;</span><br><span class="line">    console.log(name);</span><br><span class="line">&#125;;</span><br><span class="line">fn();<span class="comment">//听风是风</span></span><br><span class="line">fn(<span class="string">'行星飞行'</span>);<span class="comment">//行星飞行</span></span><br></pre></td></tr></table></figure><blockquote><p>我们简单复习下 ||或 和 &amp;&amp;与 的概念，||表示两者任意一个为真便为真，&amp;&amp;表示两者都为真才是真，任意一个为假就是假。</p></blockquote><blockquote><p>为什么这个特定能用在变量赋值呢？其实这是利用了 || 前者为真后者不判断，&amp;&amp;前者为假后者不判断的特点，来看个例子(<a href="../cacl/cacl1">查看详情</a>)：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">function <span class="title">fn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    console.log(<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">true</span> || fn(); <span class="comment">//不执行</span></span><br><span class="line"><span class="keyword">false</span> &amp;&amp; fn(); <span class="comment">//不执行</span></span><br><span class="line"><span class="keyword">false</span> || fn(); <span class="comment">//1</span></span><br><span class="line"><span class="keyword">true</span> &amp;&amp; fn() <span class="comment">//1</span></span><br></pre></td></tr></table></figure><blockquote><p>所以上面的短路求值中，当name有值时后面的默认值就被忽略了不判断，而name无值时便会判断后者取到默认值。</p></blockquote><blockquote><p>短路求值除了用在变量赋值外，还能用于函数调用，比如在下方例子为假时才调用某个方法：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">let name = <span class="keyword">false</span>;</span><br><span class="line"><span class="function">function <span class="title">fn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    console.log(<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//if</span></span><br><span class="line"><span class="keyword">if</span> (!name) &#123;</span><br><span class="line">    fn();<span class="comment">//1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//短路</span></span><br><span class="line">!name &amp;&amp; fn();<span class="comment">//1</span></span><br></pre></td></tr></table></figure><blockquote><p>对于函数形参短路赋值其实有个缺点，假设我的参数就是0，false或者null，因为短路的特性会被认为假，这样我们无法拿到想要的值，更佳的做法是使用ES6的形参默认值，像这样：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">    param = param || <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(param);</span><br><span class="line">&#125;;</span><br><span class="line">fn(<span class="number">0</span>); <span class="comment">//1</span></span><br><span class="line">fn(<span class="literal">null</span>); <span class="comment">//1</span></span><br><span class="line">fn(<span class="literal">false</span>); <span class="comment">//1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用形参默认值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params">param = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(param);</span><br><span class="line">&#125;;</span><br><span class="line">fn1(); <span class="comment">//1</span></span><br><span class="line">fn1(<span class="number">0</span>); <span class="comment">//0</span></span><br><span class="line">fn1(<span class="literal">null</span>); <span class="comment">//null</span></span><br><span class="line">fn1(<span class="literal">false</span>); <span class="comment">//false</span></span><br></pre></td></tr></table></figure><h1 id="三元运算符"><a href="#三元运算符" class="headerlink" title="三元运算符"></a>三元运算符</h1><blockquote><p>三元运算符我想大家都不会陌生，在开发中三元运算的使用场景其实非常多，比如我希望为条件为 true时变量为1，反之为0，通过三元运算符我们可以这样做：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> blo = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">let</span> num;</span><br><span class="line"><span class="keyword">if</span> (blo) &#123;</span><br><span class="line">    num = <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    num = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(num);<span class="comment">//1</span></span><br><span class="line"><span class="comment">//三元运算符</span></span><br><span class="line">blo =<span class="literal">false</span>;</span><br><span class="line">blo ? num = <span class="number">1</span> : num = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">console</span>.log(num);<span class="comment">//0</span></span><br></pre></td></tr></table></figure><blockquote><p>比如我们希望条件为true时调用函数fn，为false时什么也不做，使用三元看起来也会更加舒服：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> blo = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//if</span></span><br><span class="line"><span class="keyword">if</span> (blo) &#123;</span><br><span class="line">    fn(); <span class="comment">//1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//三元</span></span><br><span class="line">blo ? fn() : <span class="literal">null</span>;<span class="comment">//1</span></span><br></pre></td></tr></table></figure><blockquote><p>在开发中函数常常需要 return 一份数据回去，有时候根据条件不同我们可能要分别对应返回不同的数据，三元也能解决这个问题：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> flo = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (flo) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> f = fn(); <span class="comment">//1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fn1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> flo = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//三元</span></span><br><span class="line">    <span class="keyword">return</span> flo ? <span class="number">1</span> : <span class="number">2</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> f1 = fn1();<span class="comment">//1</span></span><br></pre></td></tr></table></figure><blockquote><p>三元结合return的操作非常适合我们递归处理时做收尾工作，如果满足条件继续递归，不满足跳出递归，比如我们要求正整数N到0之间所有整数之和，可以这么写：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    result += n</span><br><span class="line">    <span class="keyword">return</span> n&gt;=<span class="number">2</span> ? add(n<span class="number">-1</span>) : result;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> num = add(<span class="number">10</span>);<span class="comment">//55</span></span><br></pre></td></tr></table></figure><blockquote><p>怎么样？看着是不是特别简洁舒服。需要注意的是，三元运算符的表达式只能是单语句，否则无法使用，比如下方例子中由于执行语句超过了2句，这就无法使用三元运算符改写了：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">let i = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">//执行语句超过2句</span></span><br><span class="line">    console.log(<span class="number">1</span>);</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="switch-case"><a href="#switch-case" class="headerlink" title="switch case"></a>switch case</h1><blockquote><p>短路求值与三元运算符固然好用，但其实有一个遗憾，它们都只能解决非A即B的条件判断，凡是条件判断超过两种就显得十分无力了。那难道我们只能使用 else if 吗，其实可以使用switch case。</p></blockquote><blockquote><p>例如A情况我们希望A情况输出a，B情况输出b，C情况输出c，其它情况输出d，用 else if 与switch case分别是这样：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'B'</span>;</span><br><span class="line"><span class="comment">//if else if</span></span><br><span class="line"><span class="keyword">if</span> (name === <span class="string">'A'</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (name === <span class="string">'B'</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'b'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (name === <span class="string">'C'</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'c'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'d'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//switch case</span></span><br><span class="line"><span class="keyword">switch</span> (name) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'A'</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'a'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'B'</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'b'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'C'</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'c'</span>);</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'d'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>那么我们希望A或B情况输出1，C情况输出2，其它情况输出3呢，switch case其实也能做到：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'B'</span>;</span><br><span class="line"><span class="comment">//if else if</span></span><br><span class="line"><span class="keyword">if</span> (name === <span class="string">'A'</span> || name === <span class="string">'B'</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (name === <span class="string">'C'</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//switch case</span></span><br><span class="line"><span class="keyword">switch</span> (name) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'A'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'B'</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'C'</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>当然我想大多数人还是会觉得switch case写起来贼麻烦，尽管它的可读性确实比 else if 更高，没关系，就算作为了解也没有坏处。</p></blockquote><h1 id="对象配置-配置数据与业务逻辑分离"><a href="#对象配置-配置数据与业务逻辑分离" class="headerlink" title="对象配置(配置数据与业务逻辑分离)"></a>对象配置(配置数据与业务逻辑分离)</h1><blockquote><p>条件超过三种，else if 写起来不太优雅，switch case又觉得麻烦，有没有更棒的做法呢？我在实际开发遇到过这样一个情景，我需要根据用户不同的操作类型对同一份数据进行不同加工，比如新增，修改，删除等。那么我用else if是这么做的：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//删除操作</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//新增</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//更新</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">operateType</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (operateType === <span class="string">'del'</span>) &#123;</span><br><span class="line">        del()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operateType === <span class="string">'add'</span>) &#123;</span><br><span class="line">        add()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operateType === <span class="string">'update'</span>) &#123;</span><br><span class="line">        update()</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">process(<span class="string">'del'</span>);<span class="comment">//删除</span></span><br></pre></td></tr></table></figure><blockquote><p>一种很棒的做法就是通过对象配置，将你的操作类型作为key，具体操作的函数作为value，像这样：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//删除操作</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//新增</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//更新</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> typeFn = &#123;</span><br><span class="line">    <span class="string">'del'</span>: del,</span><br><span class="line">    <span class="string">'add'</span>: add,</span><br><span class="line">    <span class="string">'update'</span>: update</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">operateType</span>) </span>&#123;</span><br><span class="line">    typeFn[operateType]();</span><br><span class="line">&#125;;</span><br><span class="line">process(<span class="string">'del'</span>); <span class="comment">//删除</span></span><br></pre></td></tr></table></figure><blockquote><p>怎么样，有没有眼前一亮呢？我们将需求升级，现在除了判断操作type类型外，还得额外附加一个状态类型，else if是这样，这里简单描述下：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">operateType, status</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (operateType === <span class="string">'del'</span> &amp;&amp; status === <span class="number">1</span>) &#123;</span><br><span class="line">        del()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operateType === <span class="string">'add'</span>&amp;&amp; status === <span class="number">2</span>) &#123;</span><br><span class="line">        add()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operateType === <span class="string">'update'</span>&amp;&amp; status === <span class="number">3</span>) &#123;</span><br><span class="line">        update()</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>不太优雅，通过对象配置做法，我们其实只用将参数简单配置就OK了，像这样是不是更清爽呢：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> typeFn = &#123;</span><br><span class="line">    <span class="string">'del_1'</span>: del,</span><br><span class="line">    <span class="string">'add_2'</span>: add,</span><br><span class="line">    <span class="string">'update_3'</span>: update</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">operateType,status</span>) </span>&#123;</span><br><span class="line">    typeFn[<span class="string">`<span class="subst">$&#123;operateType&#125;</span>_<span class="subst">$&#123;status&#125;</span>`</span>]();</span><br><span class="line">&#125;;</span><br><span class="line">process(<span class="string">'del'</span>,<span class="number">1</span>); <span class="comment">//删除</span></span><br></pre></td></tr></table></figure><blockquote><p>什么，对象配置的调用方式语义化不太明显？那各位可曾对ES6的map数据结构有了解呢，如果你觉得这样的调用不太实在，我们再改改，将调用条件与函数配置成map数据，像这样：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> typeFn = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">    [<span class="string">'del_1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*do something*/</span> &#125;],</span><br><span class="line">    [<span class="string">'add_2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*do something*/</span> &#125;],</span><br><span class="line">    [<span class="string">'update_3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*do something*/</span> &#125;],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">operateType, status</span>) </span>&#123;</span><br><span class="line">    typeFn.get(<span class="string">`<span class="subst">$&#123;operateType&#125;</span>_<span class="subst">$&#123;status&#125;</span>`</span>)();</span><br><span class="line">&#125;;</span><br><span class="line">process(<span class="string">'del'</span>, <span class="number">1</span>); <span class="comment">//删除</span></span><br></pre></td></tr></table></figure><blockquote><p>我们通过map数据的get方法去数据中找到方法执行，这下可读性总强一点了吧，诸君可否满意呢？</p></blockquote><h1 id="数组配置-配置数据与业务逻辑分离"><a href="#数组配置-配置数据与业务逻辑分离" class="headerlink" title="数组配置(配置数据与业务逻辑分离)"></a>数组配置(配置数据与业务逻辑分离)</h1><blockquote><p>在处理条件判断时，我们常会遇到条件与对应结果全部已知的情况，比如我们要根据用户的经验设置等级头衔，[0,100)–萌新，[100,200)–骑士，[200,300)–英雄，[300-无限大]–传说，那么用else if怎么写已经没有悬念了：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">youAreMyHero</span>(<span class="params">experience</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (experience &lt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'萌新'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (experience &lt; <span class="number">200</span> &amp;&amp; experience &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'骑士'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (experience &lt; <span class="number">300</span> &amp;&amp; experience &gt;= <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'英雄'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (experience &gt;= <span class="number">300</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'传说'</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> level = youAreMyHero(<span class="number">351</span>); <span class="comment">//传说</span></span><br></pre></td></tr></table></figure><blockquote><p>对于这种条件与结果已知的情况，我们其实可以通过数组配置的形式将条件结果抽离出来，像这样：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">youAreMyHero</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> experience = [<span class="number">300</span>, <span class="number">200</span>, <span class="number">100</span>];</span><br><span class="line">    <span class="keyword">let</span> level = [<span class="string">'传说'</span>, <span class="string">'英雄'</span>, <span class="string">'骑士'</span>, <span class="string">'萌新'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; experience.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (param &gt;= experience[i]) &#123;</span><br><span class="line">            <span class="keyword">return</span> level[i];</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> level[level.length - <span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> level = youAreMyHero(<span class="number">250</span>); <span class="comment">//英雄</span></span><br></pre></td></tr></table></figure><blockquote><p>这么做的好处就是便于管理条件与执行结果，如果后面新增了等级判断，我们不用去修改业务逻辑中的 else if 语句长度，只用单纯维护我们抽离的数据即可。</p></blockquote><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>那么到这里，我们大致介绍了五种可取代if else的方式，我们知道短路运算符除了短路求值，还能用于函数调用；三元运算符也不仅仅是处理变量赋值，在return场景结合三元用起来居然如此舒适。<br>在文章后半段，我们还了解了对象配置，利用map数据结构，以及数据实行来解决特殊场景。我并不推荐为了追求高逼格而牺牲代码可读性，但我更希望在你以后的代码中不仅仅只有if else，那么到这里本文结束。<br><strong><a href="http://www.zeze.info">博主主页</a></strong></p><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">你本可以少写些 if-else</summary>
    
    
    
    <category term="设计模式" scheme="http://www.zeze.info/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="js" scheme="http://www.zeze.info/categories/js/"/>
    
    
    <category term="设计模式" scheme="http://www.zeze.info/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="js" scheme="http://www.zeze.info/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>六大设计原则</title>
    <link href="http://www.zeze.info/java/design6/"/>
    <id>http://www.zeze.info/java/design6/</id>
    <published>2020-01-06T16:58:47.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p> 原则，故名思议则是本质的意思。所谓擒贼先擒王，研究设计模式自然要先了解设计原则，所有的模式都是在这些原则的基础之上发展起来的，有的是侧重一个，有的是多个都有所涉及。看完设计模式之后，我感觉到每个模式都有这些原则的影子，还渗透着面向对象的三大属性，也觉得这些原则也都有相通之处，，正是有了他们才使我们由代码工人转为艺术家。下面我来点评一下六大原则，望各位拍砖：</p><h1 id="单一职责原则（Single-Responsibility-Principle，简称SRP）"><a href="#单一职责原则（Single-Responsibility-Principle，简称SRP）" class="headerlink" title="单一职责原则（Single Responsibility Principle，简称SRP）"></a>单一职责原则（Single Responsibility Principle，简称SRP）</h1><blockquote><p>单一职责原则，就一个类而言，应该仅有一个引起它变化的原因。如果一个类承担的职责过多，就等于把这些职责耦合在一起，一个职责的变化可能会消弱或者一直这个类完成其他职责的能力。这种耦合会导致脆弱的设计，当变化发生时，设计会遭受到意想不到的破坏。而软件设计真正要做的许多内容，就是发现职责，并把这些职责相互分离。</p></blockquote><p>一句话点评：高内聚低耦合的绝佳体现，不要乱拉关系，独善其身挺好。</p><h1 id="开放–封闭原则（The-Open-Closed-Principle简称OCP）"><a href="#开放–封闭原则（The-Open-Closed-Principle简称OCP）" class="headerlink" title="开放–封闭原则（The Open-Closed Principle简称OCP）"></a>开放–封闭原则（The Open-Closed Principle简称OCP）</h1><blockquote><p>开放–封闭原则，是说软件实体（类、模块、函数等等）应该可以扩展，但是不可以修改。即对于扩展是开放的，对于更改是封闭的。 我们不可能做到未卜先知，在设计的时候尽可能让一个类足够好，设计好了就不要去修改了；不能完全封闭的情况下，当发生变化时，我们就创建抽象来隔离以后发生的同类变化。</p></blockquote><p>一句话点评：开放扩展，封闭更改，开合有度是一门艺术。</p><h1 id="依赖倒转原则（Dependence-Inversion-Principle-）"><a href="#依赖倒转原则（Dependence-Inversion-Principle-）" class="headerlink" title="依赖倒转原则（Dependence Inversion Principle ）"></a>依赖倒转原则（Dependence Inversion Principle ）</h1><blockquote><p>依赖倒转原则，指高层模块不应该依赖低层模块，两个都应该依赖抽象；抽象不应该依赖细节，细节应该依赖抽象。说白了就是要针对接口编程，不要对实现编程。举个例子：计算机硬件中，如果内存坏了，那么只需要换一个内存条就可以了，而不需要去换一个主板，在这里内存是一个接口类，只要符合他的规格要求就行，无论是那一根。</p></blockquote><p>一句话点评：搞建筑时要做设计师，而不是砖瓦工，抽象的蓝图要靠具体的材料一点点实现。</p><h1 id="里氏代换原则（Liskov-Substitution-Principle，简称LSP）"><a href="#里氏代换原则（Liskov-Substitution-Principle，简称LSP）" class="headerlink" title="里氏代换原则（Liskov Substitution Principle，简称LSP）"></a>里氏代换原则（Liskov Substitution Principle，简称LSP）</h1><blockquote><p>里氏代换原则，子类型必须能够替换掉他们的父类型。在软件里面，把父类都替换成其子类，程序的行为不会发生变化。正是由于子类型的可替换性才使得使用父类型的模块在无需修改的情况下就可以扩展。</p></blockquote><p>一句话点评：长辈给了你继承的权利就一定要做赡养的义务，把长辈的职责都要承担起来。</p><h1 id="迪米特法则（Law-of-Demeter）"><a href="#迪米特法则（Law-of-Demeter）" class="headerlink" title="迪米特法则（Law of Demeter）"></a>迪米特法则（Law of Demeter）</h1><blockquote><p>迪米特法则，如果两个类不必彼此直接通信，那么这两个类就不应当发生直接的相互作用。如果其中一个类需要调用另一个类的某一个方法时，可以通过第三者转发这个调用。类之间的耦合越弱，就越有利于复用，一个处在弱耦合的类被修改，不会对有关系的类造成波及。 主要是强调了类之间的松耦合。</p></blockquote><p>一句话点评：不要和陌生人说话，若两国交战要尽量避免正面冲突，多派使者协商调度</p><h1 id="合成-聚合复用原则（Composition-Aggregation-Principle-，简称CARP）"><a href="#合成-聚合复用原则（Composition-Aggregation-Principle-，简称CARP）" class="headerlink" title="合成/聚合复用原则（Composition/Aggregation Principle]，简称CARP）"></a>合成/聚合复用原则（Composition/Aggregation Principle]，简称CARP）</h1><blockquote><p>合成聚合复用原则，尽量使用合成/聚合，尽量不使用类继承。合成聚合是“has  a”的关系，而继承是“is  a”的关系。由于继承是一中强耦合的结构，父类变，子类必变。所以不是“is  a”关系，我们一般不要用继承。优先使用合成聚合复用原则，有助于保持每个类的封装，降低继承的层次。</p></blockquote><p>一句话点评：尽量使用对象组合，而不是继承来达到复用的目的。</p><p><strong><a href="http://www.zeze.info">博主主页</a></strong></p><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">六大设计原则</summary>
    
    
    
    <category term="设计模式" scheme="http://www.zeze.info/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="http://www.zeze.info/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Java如何消除太多的if Else判断？</title>
    <link href="http://www.zeze.info/java/if-else/"/>
    <id>http://www.zeze.info/java/if-else/</id>
    <published>2020-01-06T16:30:09.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><blockquote><p>if判断语句是很多编程语言的重要组成部分。但是，若我们最终编写了大量嵌套的if语句，这将使得我们的代码更加复杂和难以维护。</p></blockquote><h2 id="让我们看看能否使用别的方式来做呢。"><a href="#让我们看看能否使用别的方式来做呢。" class="headerlink" title="让我们看看能否使用别的方式来做呢。"></a>让我们看看能否使用别的方式来做呢。</h2><blockquote><p>设计模式是为了更好的代码重用性，可读性，可靠性，可维护性，它有六大原则</p></blockquote><ol><li>单一职责原则（Single Responsibility Principle，简称SRP）:该原则是针对类来说的，即一个类应该只负责一项职责.</li><li>开放–封闭原则（The Open-Closed Principle简称OCP）:是说软件实体（类、模块、函数等等）应该可以扩展，但是不可以修改。</li><li>依赖倒转原则（Dependence Inversion Principle :针对接口编程，不要对实现编程</li><li>里氏代换原则（Liskov Substitution Principle，简称LSP）:里氏代换原则，子类型必须能够替换掉他们的父类型</li><li>迪米特法则（Law of Demeter）:如果两个类不必彼此直接通信，那么这两个类就不应当发生直接的相互作用</li><li>合成/聚合复用原则（Composition/Aggregation Principle]，简称CARP）:尽量使用合成/聚合，尽量不使用类继承。合成聚合是“has  a”的关系，而继承是“is  a”的关系。</li></ol><h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="if-else"><a href="#if-else" class="headerlink" title="if..else"></a>if..else</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, String operator)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"add"</span>.equals(operator)) &#123;</span><br><span class="line">        result = a + b;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"multiply"</span>.equals(operator)) &#123;</span><br><span class="line">        result = a * b;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"divide"</span>.equals(operator)) &#123;</span><br><span class="line">        result = a / b;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"subtract"</span>.equals(operator)) &#123;</span><br><span class="line">        result = a - b;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"modulo"</span>.equals(operator)) &#123;</span><br><span class="line">        result = a % b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="case-switch"><a href="#case-switch" class="headerlink" title="case-switch"></a>case-switch</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculateUsingSwitch</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, String operator)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (operator) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"add"</span>:</span><br><span class="line">        result = a + b;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"multiply"</span>:</span><br><span class="line">        result = a * b;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"divide"</span>:</span><br><span class="line">        result = a / b;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"subtract"</span>:</span><br><span class="line">        result = a - b;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"modulo"</span>:</span><br><span class="line">        result = a % b;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        result = Integer.MIN_VALUE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="重构"><a href="#重构" class="headerlink" title="重构"></a>重构</h1><h2 id="工厂方式重构"><a href="#工厂方式重构" class="headerlink" title="工厂方式重构"></a>工厂方式重构</h2><blockquote><p>抽象层Operation.java</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Operation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>加法实现Addition.java：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Addition</span> <span class="keyword">implements</span> <span class="title">Operation</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>减法实现Subtraction.java</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Subtraction</span> <span class="keyword">implements</span> <span class="title">Operation</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>乘法实现Multiplication.java</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Multiplication</span> <span class="keyword">implements</span> <span class="title">Operation</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a*b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>除法实现Division.java</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Division</span> <span class="keyword">implements</span> <span class="title">Operation</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a / b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>求余实现Modulo.java</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Modulo</span> <span class="keyword">implements</span> <span class="title">Operation</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a % b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>工厂类OperatorFactory.java</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperatorFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Map&lt;String, Operation&gt; operationMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        operationMap.put(<span class="string">"add"</span>, <span class="keyword">new</span> Addition());</span><br><span class="line">        operationMap.put(<span class="string">"divide"</span>, <span class="keyword">new</span> Division());</span><br><span class="line">        operationMap.put(<span class="string">"multiply"</span>, <span class="keyword">new</span> Multiplication());</span><br><span class="line">        operationMap.put(<span class="string">"subtract"</span>, <span class="keyword">new</span> Subtraction());</span><br><span class="line">        operationMap.put(<span class="string">"modulo"</span>, <span class="keyword">new</span> Modulo());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Optional&lt;Operation&gt; <span class="title">getOperation</span><span class="params">(String operation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(operationMap.get(operation));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>使用示例</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculateUsingFactory</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, String operator)</span> </span>&#123;</span><br><span class="line">    Operation targetOperation = OperatorFactory</span><br><span class="line">      .getOperation(operator)</span><br><span class="line">      .orElseThrow(() -&gt; <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Invalid Operator"</span>));</span><br><span class="line">    <span class="keyword">return</span> targetOperation.apply(a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="枚举方式重构"><a href="#枚举方式重构" class="headerlink" title="枚举方式重构"></a>枚举方式重构</h2><blockquote><p>枚举实现Operator.java</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Operator &#123;</span><br><span class="line">    ADD &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a + b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MULTIPLY &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a * b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    SUBTRACT &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a - b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    DIVIDE &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a / b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MODULO &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a % b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>封装Operator到Calculator.java</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, Operator operator)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> operator.apply(a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>使用示例</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenCalculateUsingEnumOperator_thenReturnCorrectResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Calculator calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">    <span class="keyword">int</span> result = calculator.calculate(<span class="number">3</span>, <span class="number">4</span>, Operator.valueOf(<span class="string">"ADD"</span>));</span><br><span class="line">    assertEquals(<span class="number">7</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><blockquote><p>抽象的接口</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    <span class="function">Integer <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>实现类（这里只写加法实现，其他的就不写了节省篇幅）</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> b;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AddCommand</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.a = a;</span><br><span class="line">        <span class="keyword">this</span>.b = b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>包装</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(Command command)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> command.execute();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>测试demo</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenCalculateUsingCommand_thenReturnCorrectResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Calculator calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">    <span class="keyword">int</span> result = calculator.calculate(<span class="keyword">new</span> AddCommand(<span class="number">3</span>, <span class="number">7</span>));</span><br><span class="line">    assertEquals(<span class="number">10</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="规则引擎重构"><a href="#规则引擎重构" class="headerlink" title="规则引擎重构"></a>规则引擎重构</h2><blockquote><p>抽象规则</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Rule</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">evaluate</span><span class="params">(Expression expression)</span></span>;</span><br><span class="line">    <span class="function">Result <span class="title">getResult</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>实现规则AddRule.java（这里只写加法实现，其他的就不写了节省篇幅）</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddRule</span> <span class="keyword">implements</span> <span class="title">Rule</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> result;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">evaluate</span><span class="params">(Expression expression)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> evalResult = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (expression.getOperator() == Operator.ADD) &#123;</span><br><span class="line">            <span class="keyword">this</span>.result = expression.getX() + expression.getY();</span><br><span class="line">            evalResult = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> evalResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>其中：返回结果</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Result</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>表达式</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Expression</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer x;</span><br><span class="line">    <span class="keyword">private</span> Integer y;</span><br><span class="line">    <span class="keyword">private</span> Operator operator;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Expression</span><span class="params">(Integer x, Integer y, Operator operator)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.x = x;</span><br><span class="line">            <span class="keyword">this</span>.y = y;</span><br><span class="line">            <span class="keyword">this</span>.operator = operator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getX</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getY</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Operator <span class="title">getOperator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> operator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>规则引擎RuleEngine.java</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RuleEngine</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Rule&gt; rules = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        rules.add(<span class="keyword">new</span> AddRule());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">process</span><span class="params">(Expression expression)</span> </span>&#123;</span><br><span class="line">        Rule rule = rules.stream()</span><br><span class="line">            .filter(r -&gt; r.evaluate(expression))</span><br><span class="line">            .findFirst()</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Expression does not matches any Rule"</span>));</span><br><span class="line">        <span class="keyword">return</span> rule.getResult();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>测试demo</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenNumbersGivenToRuleEngine_thenReturnCorrectResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Expression expression = <span class="keyword">new</span> Expression(<span class="number">5</span>, <span class="number">5</span>, Operator.ADD);</span><br><span class="line">    RuleEngine engine = <span class="keyword">new</span> RuleEngine();</span><br><span class="line">    Result result = engine.process(expression);</span><br><span class="line">    assertNotNull(result);</span><br><span class="line">    assertEquals(<span class="number">10</span>, result.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><table><thead><tr><th align="left">重构方式</th><th align="left">SRP</th><th align="left">OCP</th><th align="left">DIP</th><th align="left">LSP</th><th align="left">LD</th><th align="left">CARP</th></tr></thead><tbody><tr><td align="left">IF/ELSE</td><td align="left">N</td><td align="left">N</td><td align="left">N</td><td align="left">N</td><td align="left">N</td><td align="left">N</td></tr><tr><td align="left">工厂方法</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td></tr><tr><td align="left">枚举方法</td><td align="left">N</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td></tr><tr><td align="left">命令模式</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td></tr><tr><td align="left">规则引擎</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td><td align="left">Y</td></tr></tbody></table><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><blockquote><p>为了更好的代码重用性，可读性，可靠性，可维护性，我们会尝试将IF/ELSE或者case-switch进行改造，使用工厂方法，枚举方法，命令模式，规则引擎方式不同方法进行尝试，最后使用设计模式的六大原则对代码进行评估。</p></blockquote><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="./design6">六大设计原则</a></p><p><strong><a href="http://www.zeze.info">博主主页</a></strong></p><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">Java如何消除太多的if else判断？</summary>
    
    
    
    <category term="设计模式" scheme="http://www.zeze.info/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="java" scheme="http://www.zeze.info/categories/java/"/>
    
    
    <category term="设计模式" scheme="http://www.zeze.info/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="java" scheme="http://www.zeze.info/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>IIFE(即时调用函数表达式)</title>
    <link href="http://www.zeze.info/javaScript/module/1/"/>
    <id>http://www.zeze.info/javaScript/module/1/</id>
    <published>2019-12-30T17:50:26.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><blockquote><p>函数跟随一对圆括号()表示函数调用</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//函数声明语句写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">test();</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数表达式写法</span></span><br><span class="line"><span class="keyword">var</span> test = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">test();</span><br></pre></td></tr></table></figure><p>　　但有时需要在定义函数之后，立即调用该函数。这种函数就叫做立即执行函数，全称为立即调用的函数表达式IIFE(Imdiately Invoked Function Expression)<br>　　[注意]javascript引擎规定，如果function关键字出现在行首，一律解释成函数声明语句</p><ol><li><p>函数声明语句需要一个函数名，由于没有函数名，所以报错</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//SyntaxError: Unexpected token (</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br></pre></td></tr></table></figure></li><li><p>函数声明语句后面加上一对圆括号，只是函数声明语句与分组操作符的组合而已。由于分组操作符不能为空，所以报错</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//SyntaxError: Unexpected token )</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//等价于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">();<span class="comment">//SyntaxError: Unexpected token )</span></span><br></pre></td></tr></table></figure></li><li><p>函数声明语句加上一对有值的圆括号，也仅仅是函数声明语句与不报错的分组操作符的组合而已</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//等价于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>所以，解决方法就是不要让function出现在行首，让引擎将其理解成一个表达式</p></li></ol><p>最常用的两种办法</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;()); </span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;)();</span><br></pre></td></tr></table></figure><p>其他写法</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="number">10</span>; &#125;();</span><br><span class="line"><span class="literal">true</span> &amp;&amp; <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;();</span><br><span class="line"><span class="number">0</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;();</span><br><span class="line"></span><br><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;();</span><br><span class="line">~<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;();</span><br><span class="line">-<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;();</span><br><span class="line">+<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;;</span><br><span class="line"><span class="keyword">new</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;();</span><br></pre></td></tr></table></figure><h1 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h1><blockquote><p>对于IIFE来说，通过作用域链来查找变量与普通函数有一些不同的地方</p></blockquote><h2 id="with"><a href="#with" class="headerlink" title="with"></a>with</h2><blockquote><p>with语句中的IIFE会先在with语句中查找，然后再向上查找。在下列代码中，标准浏览器下f()函数和IIFE都返回’bar’，但IE10-浏览器中的f()函数返回’abc’</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="string">"abc"</span>;</span><br><span class="line"><span class="keyword">with</span>(&#123;</span><br><span class="line">    foo:<span class="string">"bar"</span></span><br><span class="line">&#125;)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(foo);</span><br><span class="line">    &#125;;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(foo);</span><br><span class="line">    &#125;)();</span><br><span class="line">    f();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a>try-catch</h2><blockquote><p>在下列代码中，标准浏览器下f()函数和IIFE都返回’error’，但IE10-浏览器中的f()函数返回’10’</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">    &#125;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">    &#125;)();</span><br><span class="line">    f();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="具名函数表达式"><a href="#具名函数表达式" class="headerlink" title="具名函数表达式"></a>具名函数表达式</h2><blockquote><p>在下列代码中，标准浏览器下a()函数返回1，而IIFE返回a函数代码；但IE8-浏览器中，二者都返回1</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    a = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;;</span><br><span class="line">a();</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    a = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h1 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h1><blockquote><p>IIFE一般用于构造私有变量，避免全局空间污染</p></blockquote><p>接下来用一个需求实现来更直观地说明IIFE的用途。假设有一个需求，每次调用函数，都返回加1的一个数字(数字初始值为0)</p><h2 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h2><blockquote><p>一般情况下，我们会使用全局变量来保存该数字状态</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ++a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add());<span class="comment">//1</span></span><br><span class="line"><span class="built_in">console</span>.log(add());<span class="comment">//2</span></span><br></pre></td></tr></table></figure><h2 id="自定义属性"><a href="#自定义属性" class="headerlink" title="自定义属性"></a>自定义属性</h2><blockquote><p>但上面的方法中，变量a实际上只和add函数相关，却声明为全局变量，不太合适。</p></blockquote><p>将变量a更改为函数的自定义属性更为恰当</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ++add.count;</span><br><span class="line">&#125;</span><br><span class="line">add.count = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">console</span>.log(add());<span class="comment">//1</span></span><br><span class="line"><span class="built_in">console</span>.log(add());<span class="comment">//2</span></span><br></pre></td></tr></table></figure><h2 id="IIFE"><a href="#IIFE" class="headerlink" title="IIFE"></a>IIFE</h2><blockquote><p>其实这样做，还是有问题。有些代码可能会无意中将add.count重置</p></blockquote><p>使用IIFE把计数器变量保存为私有变量更安全，同时也可以减少对全局空间的污染</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> add = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++counter; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="built_in">console</span>.log(add())<span class="comment">//1</span></span><br><span class="line"><span class="built_in">console</span>.log(add())<span class="comment">//2</span></span><br></pre></td></tr></table></figure><h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><blockquote><p>执行如下代码会报错，提示此时的a是undefined</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a());<span class="comment">//报错</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>这是因为没有加分号，浏览器将上面代码解释成如下所示</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a());<span class="comment">//报错</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>如果加上分号，就不会出错了</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a());<span class="comment">//1</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p><strong><a href="http://www.zeze.info">博主主页</a></strong></p><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">IIFE(即时调用函数表达式)</summary>
    
    
    
    <category term="前端" scheme="http://www.zeze.info/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="js" scheme="http://www.zeze.info/categories/js/"/>
    
    
    <category term="JavaScript" scheme="http://www.zeze.info/tags/JavaScript/"/>
    
    <category term="闭包" scheme="http://www.zeze.info/tags/%E9%97%AD%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>Javascript运算符——条件、逗号、赋值、()和void运算符</title>
    <link href="http://www.zeze.info/javaScript/cacl/cacl2/"/>
    <id>http://www.zeze.info/javaScript/cacl/cacl2/</id>
    <published>2019-12-30T16:54:33.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="条件运算符"><a href="#条件运算符" class="headerlink" title="条件运算符"></a>条件运算符</h1><blockquote><p>条件运算符是javascript中唯一的一个三元运算符(三个操作数)，有时直接称做三元运算符。通常这个运算符写成?:，当然在代码中往往不会这么简写，因为这个运算符拥有三个操作数，第一个操作数在?之前，第二个操作数在?和:之间，第三个操作数在:之后</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">variable = boolean_expression ? true_value : false_value;</span><br></pre></td></tr></table></figure><blockquote><p>本质上，这就是基于对boolean_expression求值的结果，决定给变量variable赋什么值。如果求值结果是true，则给变量variable赋值true_value；如果求值结果是false，则给变量variable赋值false_value</p></blockquote><blockquote><p>条件运算符的操作数可以是任意类型，第一个操作数当成布尔值，如果它是真值，那么将计算第二个操作数，并返回其计算结果。否则，如果第一个操作数是假值，那么将计算第三个操作数，并返回其计算结果。第二个和第三个操作数总是会计算其中之一，不可能两者同时执行</p></blockquote><blockquote><p>其实使用if语句也会带来同样的效果，’?:’运算符只是提供了一种简写形式。下面是一个’?:’的典型应用场景，判断一个变量是否有定义(并拥有一个有意义的真值)，如果有定义则使用它，如果无定义则使用一个默认值:</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">greeting = <span class="string">'hello '</span> + (username ? username : <span class="string">'there'</span>);</span><br></pre></td></tr></table></figure><blockquote><p>这和下面使用if语句的代码是等价的，但显然上面的代码更加简洁:</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">greeting = <span class="string">'hello '</span>;</span><br><span class="line"><span class="keyword">if</span>(username)</span><br><span class="line">    greeting += username;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    greeting += <span class="string">'there'</span>;</span><br></pre></td></tr></table></figure><blockquote><p>三元条件表达式与<code>if...else</code>语句具有同样表达效果，但是两者有一个重大差别，<code>if...else</code>是语句，没有返回值；三元条件表达式是表达式，具有返回值。所以，在需要返回值的场合，只能使用三元条件表达式，而不能使用<code>if...else</code></p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="literal">true</span> ? <span class="string">'T'</span> : <span class="string">'F'</span>);</span><br></pre></td></tr></table></figure><blockquote><p>上面代码中，console.log()方法的参数必须是一个表达式，这时就只能使用三元条件表达式</p></blockquote><h1 id="逗号运算符"><a href="#逗号运算符" class="headerlink" title="逗号运算符"></a>逗号运算符</h1><blockquote><p>逗号运算符是二元运算符，它的操作数可以是任意类型。它首先计算左操作数，然后计算右操作数，最后返回右操作数的值，用逗号运算符可以在一条语句中执行多个运算</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">i = <span class="number">0</span>,j = <span class="number">1</span>,k = <span class="number">2</span>;</span><br><span class="line"><span class="comment">//计算结果是2，它和下面的代码基本等价</span></span><br><span class="line">i =<span class="number">0</span>; j = <span class="number">1</span>; k = <span class="number">2</span>;</span><br></pre></td></tr></table></figure><blockquote><p>逗号运算符常用于声明多个变量</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> iNum1 = <span class="number">1</span>, iNum = <span class="number">2</span>, iNum3 = <span class="number">3</span>;</span><br></pre></td></tr></table></figure><blockquote><p>逗号运算符最常用的场景是在for循环中，这个for循环通常具有多个循环变量：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//for循环中的第一个逗号是var语句的一部分</span></span><br><span class="line"><span class="comment">//第二个逗号是逗号运算符</span></span><br><span class="line"><span class="comment">//它将两个表达式(i++和j--)放在一条语句中</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>, j=<span class="number">10</span>;i&lt;j;i++,j--)&#123;<span class="built_in">console</span>.log(i+j);&#125;</span><br></pre></td></tr></table></figure><blockquote><p>逗号运算符还可以用于赋值，在用于赋值时，逗号运算符总是返回表达式中的最后一项</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> num = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line"><span class="built_in">console</span>.log(num);<span class="comment">//5</span></span><br></pre></td></tr></table></figure><p>　　[注意]去掉括号会报错</p><h1 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h1><blockquote><p>简单的赋值操作符由等号’=’表示，作用是把等号右边的值赋予等号左边的变量或属性</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">i = o;</span><br><span class="line">o.x = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><blockquote><p>‘=’运算符希望它的左操作数是一个左值：一个变量或者对象属性(或数组元素)。它的右操作数可以是任意类型的任意值。赋值表达式的值就是右操作数的值</p></blockquote><blockquote><p>尽管赋值表达式通常非常简单，但有时仍会看到一些复杂表达式包含赋值表达式的情况。例如，可以将赋值和关系操作符放在一个表达式中，就像这样：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(a=b) == <span class="number">0</span></span><br></pre></td></tr></table></figure><blockquote><p>如果这样做的话，应该清楚知道’=’和’==’运算符之间的区别。’=’具有非常低的优先级，通常在一个较长的表达式中用到了一条赋值语句的值时的时候，需要补充圆括号以保证正确的运算顺序</p></blockquote><blockquote><p>赋值操作符的结合性是从右到左，也就是说，如果一个表达式中出现了多个赋值运算符，运算顺序是从右到左。因此，可以通过如下方式来对多个变量赋值：</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">i = j = k = <span class="number">0</span>;<span class="comment">//把三个变量初始化为0</span></span><br></pre></td></tr></table></figure><blockquote><p>javascript还提供11个复合的赋值运算符，这些复合的赋值运算符，都是先进行指定运算，然后将得到的值返回给左边的变量</p></blockquote><p>　　[注意]设计这些操作符的目的是简化赋值操作，使用它们并不会带来任何性能的提升</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">total += sales_tax;</span><br><span class="line"><span class="comment">//等价于</span></span><br><span class="line">total = total + sales_tax;</span><br></pre></td></tr></table></figure><table><thead><tr><th align="center">运算符</th><th align="center">示例</th><th align="center">等价于</th></tr></thead><tbody><tr><td align="center">+=</td><td align="center">a+=b</td><td align="center">a=a+b</td></tr><tr><td align="center">-=</td><td align="center">a-=b</td><td align="center">a=a-b</td></tr><tr><td align="center">*=</td><td align="center">a*=b</td><td align="center">a=a*b</td></tr><tr><td align="center">/=</td><td align="center">a/=b</td><td align="center">a=a/b</td></tr><tr><td align="center">%=</td><td align="center">a%=b</td><td align="center">a=a%b</td></tr><tr><td align="center">&lt;&lt;=</td><td align="center">a&lt;&lt;=b</td><td align="center">a=a&lt;&lt;b</td></tr><tr><td align="center">&gt;&gt;=</td><td align="center">a&gt;&gt;=b</td><td align="center">a=a&gt;&gt;b</td></tr><tr><td align="center">&gt;&gt;&gt;=</td><td align="center">a&gt;&gt;&gt;=b</td><td align="center">a=a&gt;&gt;&gt;b</td></tr><tr><td align="center">&amp;=</td><td align="center">a&amp;=b</td><td align="center">a=a&amp;b</td></tr><tr><td align="center"></td><td align="center">=</td><td align="center">a</td></tr><tr><td align="center">^=</td><td align="center">a^=b</td><td align="center">a=a^b</td></tr></tbody></table><blockquote><p>在大多数情况下，表达式为:</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">a op= b</span><br></pre></td></tr></table></figure><blockquote><p>这里op代表一个运算符，这个表达式和下面的表达式等价</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">a = a op b</span><br></pre></td></tr></table></figure><blockquote><p>在第一行中，表达式a计算了一次，在第二行中，表达式a计算了两次，只有在a包含具有副作用的表达式(比如函数调用和赋值操作)的时候，两者才不等价</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">data[i++]*=<span class="number">2</span>;</span><br><span class="line">data[i++] = data[i++]*<span class="number">2</span>;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],i=<span class="number">0</span>;</span><br><span class="line">data[++i]+=<span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(data);<span class="comment">//[0,11,2]</span></span><br><span class="line"><span class="keyword">var</span> data = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],i=<span class="number">0</span>;</span><br><span class="line">data[++i]= data[++i] + <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(data);<span class="comment">//[0,12,2]</span></span><br></pre></td></tr></table></figure><h1 id="圆括号运算符"><a href="#圆括号运算符" class="headerlink" title="圆括号运算符"></a>圆括号运算符</h1><blockquote><p>圆括号运算符也叫分组运算符，它有两种用法：如果表达式放在圆括号中，作用是求值；如果跟在函数后面，作用是调用函数</p></blockquote><blockquote><p>把表达式放在圆括号之中，将返回表达式的值</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log((<span class="number">1</span>));  <span class="comment">//1</span></span><br><span class="line"><span class="built_in">console</span>.log((<span class="string">'a'</span>)); <span class="comment">//'a'</span></span><br><span class="line"><span class="built_in">console</span>.log((<span class="number">1</span>+<span class="number">2</span>)); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><blockquote><p>把对象放在圆括号之中，则会返回对象的值，即对象本身</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;<span class="attr">p</span>:<span class="number">1</span>&#125;;</span><br><span class="line"><span class="built_in">console</span>.log((o));<span class="comment">// Object &#123;p: 1&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>将函数放在圆括号中，会返回函数本身。如果圆括号紧跟在函数的后面，就表示调用函数，即对函数求值</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line"><span class="built_in">console</span>.log((f));<span class="comment">// function f()&#123;return 1;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(f()); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>　　[注意]圆括号运算符不能为空，否则会报错</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">();<span class="comment">//SyntaxError: Unexpected token )</span></span><br></pre></td></tr></table></figure><blockquote><p>由于圆括号的作用是求值，如果将语句放在圆括号之中，就会报错，因为语句没有返回值</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">var</span> a = <span class="number">1</span>);<span class="comment">// SyntaxError: Unexpected token var</span></span><br><span class="line"><span class="built_in">console</span>.log((<span class="keyword">var</span> a = <span class="number">1</span>));<span class="comment">// SyntaxError: Unexpected token var</span></span><br></pre></td></tr></table></figure><h1 id="void运算符"><a href="#void运算符" class="headerlink" title="void运算符"></a>void运算符</h1><blockquote><p>void是一元运算符，它出现在操作数之前，操作数可以是任意类型，操作数会照常计算，但忽略计算结果并返回undefined。由于void会忽略操作数的值，因此在操作数具有副作用的时候使用void来让程序更具语义</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">void</span> <span class="number">0</span>); <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">void</span>(<span class="number">0</span>)); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><h2 id="【作用一】替代undefined"><a href="#【作用一】替代undefined" class="headerlink" title="【作用一】替代undefined"></a>【作用一】替代undefined</h2><blockquote><p>由于undefined并不是一个关键字，其在IE8-浏览器中会被重写，在高版本函数作用域中也会被重写；所以可以用void 0 来替换undefined</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="literal">undefined</span> = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">undefined</span>);<span class="comment">//IE8-浏览器下为10，高版本浏览器下为undefined</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">t</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="literal">undefined</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="literal">undefined</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(t());<span class="comment">//所有浏览器下都是10</span></span><br></pre></td></tr></table></figure><h2 id="【作用二】客户端URL"><a href="#【作用二】客户端URL" class="headerlink" title="【作用二】客户端URL"></a>【作用二】客户端URL</h2><blockquote><p>这个运算符最常用在客户端URL——javascript:URL中，在URL中可以写带有副作用的表达式，而void则让浏览器不必显示这个表达式的计算结果。例如，经常在HTML代码中的<a>标签里使用void运算符</a></p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">"javascript:void window.open();"</span>&gt;打开一个新窗口&lt;<span class="regexp">/a&gt;</span></span><br></pre></td></tr></table></figure><h2 id="【作用三】阻止默认事件"><a href="#【作用三】阻止默认事件" class="headerlink" title="【作用三】阻止默认事件"></a>【作用三】阻止默认事件</h2><blockquote><p>阻止默认事件的方式是给事件置返回值false</p></blockquote><p>``js<br>//一般写法<br><a href="http://example.com" target="_blank" rel="external nofollow noopener noreferrer" onclick="f();return false;">文字</a></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&gt;使用void运算符可以取代上面写法</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(f())"</span>&gt;</span>文字<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong><a href="http://www.zeze.info">博主主页</a></strong></p><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">javascript运算符——条件、逗号、赋值、()和void运算符</summary>
    
    
    
    <category term="前端" scheme="http://www.zeze.info/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="js" scheme="http://www.zeze.info/categories/js/"/>
    
    
    <category term="JavaScript" scheme="http://www.zeze.info/tags/JavaScript/"/>
    
    <category term="js运算符" scheme="http://www.zeze.info/tags/js%E8%BF%90%E7%AE%97%E7%AC%A6/"/>
    
  </entry>
  
  <entry>
    <title>Java高并发编程四-线程的常用方法</title>
    <link href="http://www.zeze.info/java/concurrent/j3/"/>
    <id>http://www.zeze.info/java/concurrent/j3/</id>
    <published>2019-12-30T11:19:10.000Z</published>
    <updated>2021-08-10T01:23:42.998Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="做个笔记-java线程常用的方法-过一遍留点印象"><a href="#做个笔记-java线程常用的方法-过一遍留点印象" class="headerlink" title="做个笔记,java线程常用的方法,过一遍留点印象"></a>做个笔记,java线程常用的方法,过一遍留点印象</h1><table><thead><tr><th align="left">编号</th><th align="center">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">1</td><td align="center">public void start()</td><td align="left">使该线程开始执行；Java 虚拟机调用该线程的 run 方法。</td></tr><tr><td align="left">2</td><td align="center">public void run()</td><td align="left">如果该线程是使用独立的 Runnable 运行对象构造的，则调用该 Runnable 对象的 run 方法；否则，该方法不执行任何操作并返回。</td></tr><tr><td align="left">3</td><td align="center">public final void setName(String name)</td><td align="left">改变线程名称，使之与参数 name 相同。</td></tr><tr><td align="left">4</td><td align="center">public final void setPriority(int priority)</td><td align="left">更改线程的优先级。</td></tr><tr><td align="left">5</td><td align="center">public final void setDaemon(boolean on)</td><td align="left">将该线程标记为守护线程或用户线程。</td></tr><tr><td align="left">6</td><td align="center">public final void join(long millisec)</td><td align="left">等待该线程终止的时间最长为 millis 毫秒。</td></tr><tr><td align="left">7</td><td align="center">public void interrupt()</td><td align="left">中断线程。</td></tr><tr><td align="left">8</td><td align="center">public final boolean isAlive()</td><td align="left">测试线程是否处于活动状态。</td></tr><tr><td align="left">9</td><td align="center">public static void yield()</td><td align="left">暂停当前正在执行的线程对象，并执行其他线程。</td></tr><tr><td align="left">10</td><td align="center">public static void sleep(long millisec)</td><td align="left">在指定的毫秒数内让当前正在执行的线程休眠（暂停执行），此操作受到系统计时器和调度程序精度和准确性的影响。</td></tr><tr><td align="left">11</td><td align="center">public static Thread currentThread()</td><td align="left">返回对当前正在执行的线程对象的引用。</td></tr></tbody></table><h1 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h1><h2 id="currentThread-方法可以返回代码段正在被哪个线程调用的信息。"><a href="#currentThread-方法可以返回代码段正在被哪个线程调用的信息。" class="headerlink" title="currentThread()方法可以返回代码段正在被哪个线程调用的信息。"></a>currentThread()方法可以返回代码段正在被哪个线程调用的信息。</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Run1</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;                 </span><br><span class="line">    System.out.println(Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="sleep-方法"><a href="#sleep-方法" class="headerlink" title="sleep()方法"></a>sleep()方法</h2><blockquote><p>方法sleep()的作用是在指定的毫秒数内让当前“正在执行的线程”休眠（暂停执行）。这个“正在执行的线程”是指this.currentThread()返回的线程。</p></blockquote><p>sleep方法有两个重载版本：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">sleep(<span class="keyword">long</span> millis)     <span class="comment">//参数为毫秒</span></span><br><span class="line">sleep(<span class="keyword">long</span> millis,<span class="keyword">int</span> nanoseconds)    <span class="comment">//第一参数为毫秒，第二个参数为纳秒</span></span><br></pre></td></tr></table></figure><blockquote><p>sleep相当于让线程睡眠，交出CPU，让CPU去执行其他的任务。但是有一点要非常注意，<code>sleep方法不会释放锁</code>，也就是说如果当前线程持有对某个对象的锁，则即使调用sleep方法，其他线程也无法访问这个对象。看下面这个例子就清楚了：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> Object object = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException  </span>&#123;</span><br><span class="line">        Test test = <span class="keyword">new</span> Test();</span><br><span class="line">        MyThread thread1 = test.<span class="keyword">new</span> MyThread();</span><br><span class="line">        MyThread thread2 = test.<span class="keyword">new</span> MyThread();</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (object) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                System.out.println(<span class="string">"i:"</span>+i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"线程"</span>+Thread.currentThread().getName()+<span class="string">"进入睡眠状态"</span>);</span><br><span class="line">                    Thread.currentThread().sleep(<span class="number">10000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"线程"</span>+Thread.currentThread().getName()+<span class="string">"睡眠结束"</span>);</span><br><span class="line">                i++;</span><br><span class="line">                System.out.println(<span class="string">"i:"</span>+i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/java/concurrent/20191230112613.png!www.zeze.info" alt="线程"></p><blockquote><p>从上面输出结果可以看出，当Thread-0进入睡眠状态之后，Thread-1并没有去执行具体的任务。只有当Thread-0执行完之后，此时Thread-0释放了对象锁，Thread-1才开始执行。</p></blockquote><blockquote><p>注意，如果调用了sleep方法，必须捕获<code>InterruptedException</code>异常或者将该异常向上层抛出。当线程睡眠时间满后，不一定会立即得到执行，因为此时可能CPU正在执行其他的任务。所以说调用sleep方法相当于让线程进入阻塞状态。</p></blockquote><h2 id="yield-方法"><a href="#yield-方法" class="headerlink" title="yield()方法"></a>yield()方法</h2><blockquote><p>调用yield方法会让当前线程交出CPU权限，让CPU去执行其他的线程。它跟sleep方法类似，同样不会释放锁。但是yield不能控制具体的交出CPU的时间，另外，yield方法只能让拥有相同优先级的线程有获取CPU执行时间的机会。</p></blockquote><blockquote><p>注意，调用yield方法并不会让线程进入阻塞状态，而是让线程重回就绪状态，它只需要等待重新获取CPU执行时间，这一点是和sleep方法不一样的。代码：</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span>  <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> beginTime=System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">50000000</span>;i++)&#123;</span><br><span class="line">            count=count+(i+<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//Thread.yield();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> endTime=System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"用时："</span>+(endTime-beginTime)+<span class="string">" 毫秒！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Run</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyThread t= <span class="keyword">new</span> MyThread();</span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用时：3 毫秒！</span></span><br><span class="line"><span class="comment">//如果将 Thread.yield();的注释去掉，执行结果如下：</span></span><br><span class="line">用时：<span class="number">16080</span> 毫秒！</span><br></pre></td></tr></table></figure><h1 id="对象方法"><a href="#对象方法" class="headerlink" title="对象方法"></a>对象方法</h1><h2 id="start-方法"><a href="#start-方法" class="headerlink" title="start()方法"></a>start()方法</h2><blockquote><p>start()用来启动一个线程，当调用start方法后，系统才会开启一个新的线程来执行用户定义的子任务，在这个过程中，会为相应的线程分配需要的资源。</p></blockquote><h2 id="run-方法"><a href="#run-方法" class="headerlink" title="run()方法"></a>run()方法</h2><blockquote><p>run()方法是不需要用户来调用的，当通过start方法启动一个线程之后，当线程获得了CPU执行时间，便进入run方法体去执行具体的任务。注意，继承Thread类必须重写run方法，在run方法中定义具体要执行的任务。</p></blockquote><h2 id="getId"><a href="#getId" class="headerlink" title="getId()"></a>getId()</h2><blockquote><p>getId()的作用是取得线程的唯一标识</p></blockquote><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        Thread t= Thread.currentThread();</span><br><span class="line">        System.out.<span class="built_in">println</span>(t.getName()+<span class="string">" "</span>+t.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//main 1</span></span><br></pre></td></tr></table></figure><h2 id="isAlive-方法"><a href="#isAlive-方法" class="headerlink" title="isAlive()方法"></a>isAlive()方法</h2><blockquote><p>方法isAlive()的功能是判断当前线程是否处于活动状态</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span>  <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"run="</span>+<span class="keyword">this</span>.isAlive());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        MyThread myThread=<span class="keyword">new</span> MyThread();</span><br><span class="line">        System.out.println(<span class="string">"begin =="</span>+myThread.isAlive());</span><br><span class="line">        myThread.start();</span><br><span class="line">        System.out.println(<span class="string">"end =="</span>+myThread.isAlive());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//begin ==false</span></span><br><span class="line"><span class="comment">//run=true</span></span><br><span class="line"><span class="comment">//end ==false</span></span><br></pre></td></tr></table></figure><blockquote><p>方法isAlive()的作用是测试线程是否偶处于活动状态。什么是活动状态呢？活动状态就是线程已经启动且尚未终止。线程处于正在运行或准备开始运行的状态，就认为线程是“存活”的。</p></blockquote><p><strong>有个需要注意的地方</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(<span class="string">"end =="</span>+myThread.isAlive());</span><br></pre></td></tr></table></figure><p>虽然上面的实例中打印的值是true,但此值是不确定的。打印true值是因为myThread线程还未执行完毕，所以输出true。如果代码改成下面这样，加了个sleep休眠：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    MyThread myThread=<span class="keyword">new</span> MyThread();</span><br><span class="line">    System.out.println(<span class="string">"begin =="</span>+myThread.isAlive());</span><br><span class="line">    myThread.start();</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    System.out.println(<span class="string">"end =="</span>+myThread.isAlive());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>则上述代码运行的结果输出为false,因为mythread对象已经在1秒之内执行完毕。</p></blockquote><h2 id="join-方法"><a href="#join-方法" class="headerlink" title="join()方法"></a>join()方法</h2><blockquote><p>在很多情况下，主线程创建并启动了线程，如果子线程中药进行大量耗时运算，主线程往往将早于子线程结束之前结束。这时，如果主线程想等待子线程执行完成之后再结束，比如子线程处理一个数据，主线程要取得这个数据中的值，就要用到join()方法了。方法join()的作用是等待线程对象销毁。</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread4</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Thread4</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(getName() + <span class="string">"  "</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 启动子进程</span></span><br><span class="line">        <span class="keyword">new</span> Thread4(<span class="string">"new thread"</span>).start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">5</span>) &#123;</span><br><span class="line">                Thread4 th = <span class="keyword">new</span> Thread4(<span class="string">"joined thread"</span>);</span><br><span class="line">                th.start();</span><br><span class="line">                th.join();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"  "</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">由上可以看出main主线程等待joined thread线程先执行完了才结束的。如果把th.join()这行注释掉，运行结果如下：</span></span><br><span class="line"><span class="comment">main  0</span></span><br><span class="line"><span class="comment">main  1</span></span><br><span class="line"><span class="comment">main  2</span></span><br><span class="line"><span class="comment">main  3</span></span><br><span class="line"><span class="comment">main  4</span></span><br><span class="line"><span class="comment">new thread  0</span></span><br><span class="line"><span class="comment">new thread  1</span></span><br><span class="line"><span class="comment">new thread  2</span></span><br><span class="line"><span class="comment">new thread  3</span></span><br><span class="line"><span class="comment">new thread  4</span></span><br><span class="line"><span class="comment">joined thread  0</span></span><br><span class="line"><span class="comment">joined thread  1</span></span><br><span class="line"><span class="comment">joined thread  2</span></span><br><span class="line"><span class="comment">joined thread  3</span></span><br><span class="line"><span class="comment">joined thread  4</span></span><br><span class="line"><span class="comment">main  5</span></span><br><span class="line"><span class="comment">main  6</span></span><br><span class="line"><span class="comment">main  7</span></span><br><span class="line"><span class="comment">main  8</span></span><br><span class="line"><span class="comment">main  9</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="getName和setName"><a href="#getName和setName" class="headerlink" title="getName和setName"></a>getName和setName</h2><p>用来得到或者设置线程名称。</p><h2 id="getPriority和setPriority"><a href="#getPriority和setPriority" class="headerlink" title="getPriority和setPriority"></a>getPriority和setPriority</h2><p>用来获取和设置线程优先级。此方法不常用,这种方式不可靠</p><h2 id="setDaemon和isDaemon"><a href="#setDaemon和isDaemon" class="headerlink" title="setDaemon和isDaemon"></a>setDaemon和isDaemon</h2><p>用来设置线程是否成为守护线程和判断线程是否是守护线程。</p><p>守护线程和用户线程的区别在于：守护线程依赖于创建它的线程，而用户线程则不依赖。举个简单的例子：如果在main线程中创建了一个守护线程，当main方法运行完毕之后，守护线程也会随着消亡。而用户线程则不会，用户线程会一直运行直到其运行完毕。在JVM中，像垃圾收集器线程就是守护线程。</p><h1 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h1><h2 id="线程和进程有什么区别？"><a href="#线程和进程有什么区别？" class="headerlink" title="线程和进程有什么区别？"></a>线程和进程有什么区别？</h2><blockquote><p>答：一个进程是一个独立(self contained)的运行环境，它可以被看作一个程序或者一个应用。而线程是在进程中执行的一个任务。线程是进程的子集，一个进程可以有很多线程，每条线程并行执行不同的任务。不同的进程使用不同的内存空间，而所有的线程共享一片相同的内存空间。别把它和栈内存搞混，每个线程都拥有单独的栈内存用来存储本地数据。</p></blockquote><h2 id="如何在Java中实现线程？"><a href="#如何在Java中实现线程？" class="headerlink" title="如何在Java中实现线程？"></a>如何在Java中实现线程？</h2><p>答：创建线程有两种方式：</p><ol><li>继承 Thread 类，扩展线程。</li><li>实现 Runnable 接口。</li><li>Callable接口</li></ol><h2 id="启动一个线程是调用run-还是start-方法？"><a href="#启动一个线程是调用run-还是start-方法？" class="headerlink" title="启动一个线程是调用run()还是start()方法？"></a>启动一个线程是调用run()还是start()方法？</h2><p>答：启动一个线程是调用start()方法，使线程所代表的虚拟处理机处于可运行状态，这意味着它可以由JVM 调度并执行，这并不意味着线程就会立即运行。run()方法是线程启动后要进行回调（callback）的方法</p><h2 id="Thread类的sleep-方法和对象的wait-方法都可以让线程暂停执行，它们有什么区别"><a href="#Thread类的sleep-方法和对象的wait-方法都可以让线程暂停执行，它们有什么区别" class="headerlink" title="Thread类的sleep()方法和对象的wait()方法都可以让线程暂停执行，它们有什么区别?"></a>Thread类的sleep()方法和对象的wait()方法都可以让线程暂停执行，它们有什么区别?</h2><blockquote><p>sleep()方法（休眠）是线程类（Thread）的静态方法，调用此方法会让当前线程暂停执行指定的时间，<code>将执行机会（CPU）让给其他线程，但是对象的锁依然保持</code>，因此休眠时间结束后会自动恢复。wait()是Object类的方法，调用对象的wait()方法导致当前线程<code>放弃对象的锁</code>（线程暂停执行），进入对象的等待池（wait pool），只有调用对象的notify()方法（或notifyAll()方法）时才能唤醒等待池中的线程进入等锁池（lock pool），如果线程重新获得对象的锁就可以进入就绪状态。</p></blockquote><h2 id="线程的sleep-方法和yield-方法有什么区别？"><a href="#线程的sleep-方法和yield-方法有什么区别？" class="headerlink" title="线程的sleep()方法和yield()方法有什么区别？"></a>线程的sleep()方法和yield()方法有什么区别？</h2><ol><li>sleep()方法给其他线程运行机会时不考虑线程的优先级，因此会给低优先级的线程以运行的机会；yield()方法只会给相同优先级或更高优先级的线程以运行的机会；</li><li>线程执行sleep()方法后转入阻塞（blocked）状态，而执行yield()方法后转入就绪（ready）状态；</li><li>sleep()方法声明抛出InterruptedException，而yield()方法没有声明任何异常；</li><li>sleep()方法比yield()方法（跟操作系统CPU调度相关）具有更好的可移植性。</li></ol><h2 id="请说出与线程同步以及线程调度相关的方法。"><a href="#请说出与线程同步以及线程调度相关的方法。" class="headerlink" title="请说出与线程同步以及线程调度相关的方法。"></a>请说出与线程同步以及线程调度相关的方法。</h2><ul><li>wait()：使一个线程处于等待（阻塞）状态，并且释放所持有的对象的锁；</li><li>sleep()：使一个正在运行的线程处于睡眠状态，是一个静态方法，调用此方法要处理InterruptedException异常；</li><li>notify()：唤醒一个处于等待状态的线程，当然在调用此方法的时候，并不能确切的唤醒某一个等待状态的线程，而是由JVM确定唤醒哪个线程，而且与优先级无关；</li><li>notityAll()：唤醒所有处于等待状态的线程，该方法并不是将对象的锁给所有线程，而是让它们竞争，只有获得锁的线程才能进入就绪状态；</li></ul><h1 id="小伙伴一起加油吧"><a href="#小伙伴一起加油吧" class="headerlink" title="小伙伴一起加油吧"></a>小伙伴一起加油吧</h1><p><strong><a href="http://www.zeze.info">博主主页</a></strong></p><p><strong>可以加博主微信一起交流：<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://img.zeze.info/img/about/wx.jpg!www.zeze.info" alt="twobixiaoxin"></strong></p>]]></content>
    
    
    <summary type="html">Java高并发编程四-线程的常用方法</summary>
    
    
    
    <category term="java" scheme="http://www.zeze.info/categories/java/"/>
    
    
    <category term="java" scheme="http://www.zeze.info/tags/java/"/>
    
    <category term="java高并发编程" scheme="http://www.zeze.info/tags/java%E9%AB%98%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
</feed>
